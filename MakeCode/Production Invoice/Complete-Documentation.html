<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Invoice - ×ª×™×¢×•×“ ××§×™×£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px;
            text-align: center;
            position: relative;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header .version {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .toc {
            background: #f8f9fa;
            padding: 30px 40px;
            border-bottom: 3px solid #667eea;
        }

        .toc h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .toc ul {
            list-style: none;
            margin: 0;
        }

        .toc li {
            margin: 10px 0;
        }

        .toc a {
            color: #764ba2;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
            display: block;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .toc a:hover {
            background: #667eea;
            color: white;
            transform: translateX(-10px);
        }

        .content {
            padding: 40px;
        }

        section {
            margin: 40px 0;
            scroll-margin-top: 20px;
        }

        h2 {
            color: #667eea;
            border-bottom: 4px solid #667eea;
            padding-bottom: 15px;
            margin: 40px 0 25px 0;
            font-size: 2.2em;
        }

        h3 {
            color: #764ba2;
            margin: 30px 0 15px 0;
            font-size: 1.7em;
            border-right: 5px solid #764ba2;
            padding-right: 15px;
        }

        h4 {
            color: #667eea;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        .field-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-right: 6px solid #667eea;
        }

        .field-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            margin: -25px -25px 20px -25px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .field-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .meta-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-right: 3px solid #667eea;
        }

        .meta-label {
            font-weight: bold;
            color: #764ba2;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .meta-value {
            color: #333;
            font-size: 1.1em;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            font-size: 0.95em;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        .info-box {
            background: #e3f2fd;
            border-right: 6px solid #2196F3;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }

        .warning-box {
            background: #fff3cd;
            border-right: 6px solid #ffc107;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }

        .success-box {
            background: #d4edda;
            border-right: 6px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }

        .example-box {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: bold;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 10px 0;
        }

        .highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 0 5px;
        }

        .badge-ocr {
            background: #28a745;
            color: white;
        }

        .badge-template {
            background: #17a2b8;
            color: white;
        }

        .badge-calculated {
            background: #ffc107;
            color: #333;
        }

        .badge-search {
            background: #dc3545;
            color: white;
        }

        footer {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .collapsible {
            background: #667eea;
            color: white;
            cursor: pointer;
            padding: 15px;
            width: 100%;
            border: none;
            text-align: right;
            outline: none;
            font-size: 1.2em;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
            transition: all 0.3s;
        }

        .collapsible:hover {
            background: #764ba2;
        }

        .collapsible:after {
            content: '\002B';
            color: white;
            font-weight: bold;
            float: left;
            margin-left: 5px;
        }

        .collapsible.active:after {
            content: "\2212";
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #f8f9fa;
            border-radius: 0 0 8px 8px;
        }

        .collapsible-content-inner {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ­ Production Invoice</h1>
            <p class="version">v1.7.1 - ×ª×™×¢×•×“ ××§×™×£ ×•××œ×</p>
            <p>××¡××š ×××•×—×“ ×¢× ×“×¨×™×œ ×“××•×Ÿ ×œ×›×œ ×”×¤×¨×˜×™×</p>
        </header>

        <div class="toc">
            <h2>ğŸ“‘ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×</h2>
            <ul>
                <li><a href="#overview">1. ×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
                <li><a href="#invoice-types">2. ×¡×•×’×™ ×—×©×‘×•× ×™×•×ª</a></li>
                <li><a href="#fields">3. ×¤×™×¨×•×˜ ×©×“×•×ª (×“×¨×™×œ ×“××•×Ÿ ××œ×)</a></li>
                <li><a href="#items">4. ×¤×™×¨×•×˜ ×¤×¨×™×˜×™× (PINVOICEITEMS_SUBFORM)</a></li>
                <li><a href="#validation">5. ×‘×§×¨×•×ª ×•××™××•×ª (validation)</a></li>
                <li><a href="#metadata">6. ××˜×-×“××˜×” (metadata)</a></li>
                <li><a href="#field-mapping">7. ××™×¤×•×™ ×©×“×•×ª (field_mapping)</a></li>
                <li><a href="#flow">8. ×ª×”×œ×™×š ×¢×™×‘×•×“ (Flow)</a></li>
                <li><a href="#examples">9. ×“×•×’×××•×ª ××œ××•×ª</a></li>
            </ul>
        </div>

        <div class="content">
            <!-- Section 1: Overview -->
            <section id="overview">
                <h2>1ï¸âƒ£ ×¡×§×™×¨×” ×›×œ×œ×™×ª</h2>

                <div class="info-box">
                    <h3>ğŸ¯ ××˜×¨×ª ×”××•×“×•×œ</h3>
                    <p>Production Invoice ×”×•× ×”×©×œ×‘ ×”××—×¨×•×Ÿ ×‘×ª×”×œ×™×š ×¢×™×‘×•×“ ×”×—×©×‘×•× ×™×•×ª. ×”××•×“×•×œ ××§×‘×œ ×ª×‘× ×™×ª ×××•×—×“×ª ×-Processing Invoice ×•××™×™×¦×¨ JSON ×¡×•×¤×™ ××•×›×Ÿ ×œ×©×œ×™×—×” ×œ-Priority ERP.</p>
                </div>

                <h3>ğŸ“¥ ×§×œ×˜</h3>
                <table>
                    <tr>
                        <th>×©×“×”</th>
                        <th>×ª×™××•×¨</th>
                        <th>×¡×•×’</th>
                        <th>×—×•×‘×”</th>
                    </tr>
                    <tr>
                        <td><strong>learned_config</strong></td>
                        <td>×ª×‘× ×™×ª ×××•×—×“×ª ×¢× all_templates</td>
                        <td>Object/String</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>AZURE_RESULT</strong></td>
                        <td>× ×ª×•× ×™ OCR ×-Azure</td>
                        <td>Object/String</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>AZURE_TEXT_CLEAN</strong></td>
                        <td>×˜×§×¡×˜ × ×§×™ ××”×—×©×‘×•× ×™×ª</td>
                        <td>String</td>
                        <td>âŒ</td>
                    </tr>
                    <tr>
                        <td><strong>vehicles</strong></td>
                        <td>×¨×©×™××ª ×¨×›×‘×™× ×¢× ××™×¤×•×™ ×—×©×‘×•× ×•×ª</td>
                        <td>String (JSON array)</td>
                        <td>âŒ</td>
                    </tr>
                    <tr>
                        <td><strong>docs_list</strong></td>
                        <td>×¨×©×™××ª ×ª×¢×•×“×•×ª ×–××™× ×•×ª</td>
                        <td>String (JSON array)</td>
                        <td>âŒ</td>
                    </tr>
                    <tr>
                        <td><strong>import_files</strong></td>
                        <td>×§×‘×¦×™ ×™×‘×•×</td>
                        <td>Object/String</td>
                        <td>âŒ</td>
                    </tr>
                </table>

                <h3>ğŸ“¤ ×¤×œ×˜</h3>
                <div class="code-block">
{
  "status": "success",
  "supplier_identification": {
    "supplier_code": "5014",
    "supplier_name": "×˜×›×•××˜×¨",
    "identification_method": "vendor_tax_id",
    "confidence": "high"
  },
  "invoice_data": {
    "PINVOICES": [{ ... }]
  },
  "validation": { ... },
  "learning_analysis": { ... },
  "execution_report": { ... },
  "metadata": { ... }
}
                </div>
            </section>

            <!-- Section 2: Invoice Types -->
            <section id="invoice-types">
                <h2>2ï¸âƒ£ ×¡×•×’×™ ×—×©×‘×•× ×™×•×ª</h2>

                <button class="collapsible">ğŸš— ×—×©×‘×•× ×™×•×ª ×¨×›×‘×™× (Vehicles)</button>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <h4>×–×™×”×•×™</h4>
                        <ul>
                            <li><strong>structure.has_vehicles = true</strong></li>
                            <li>processing_scenario.all_templates[].check_vehicles = true</li>
                        </ul>

                        <h4>×œ×•×’×™×§×” ××™×•×—×“×ª</h4>
                        <ul>
                            <li><strong>PDES:</strong> ×ª×™××•×¨ ××•×¦×¨×™× ×××™×ª×™×™× ××”-OCR Items (×œ× ×©× ×—×©×‘×•×Ÿ)</li>
                            <li><strong>DETAILS:</strong> null (×œ× ×ª×™××•×¨ ×›×œ×œ×™)</li>
                            <li><strong>PRICE:</strong> SubTotal (×œ×¤× ×™ ××¢×) ××—×•×œ×§ ×œ××¡×¤×¨ ×¨×›×‘×™×</li>
                            <li><strong>ACCNAME:</strong> ×××•×¤×” ××”-vehicles input ×œ×¤×™ ××¡×¤×¨ ×¨×›×‘</li>
                        </ul>

                        <h4>×—×™×¤×•×© ××¡×¤×¨×™ ×¨×›×‘×™×</h4>
                        <ol>
                            <li>UnidentifiedNumbers (×¢× label "×¨×›×‘")</li>
                            <li>VehicleNumbers</li>
                            <li>Items[].Description (fallback)</li>
                            <li>AZURE_TEXT_CLEAN (fallback ××—×¨×•×Ÿ)</li>
                        </ol>

                        <div class="example-box">
                            <h4>×“×•×’××”</h4>
                            <div class="code-block">
{
  "PARTNAME": "car",
  "PDES": "×©×œ×˜ ×¨××¤×” ××œ×—×•×˜×™ GALILO+ ××›×¡×” ×¡×•×œ×¨ ××™×¡×•×–×•",
  "ACCNAME": "66910",
  "PRICE": 1150,
  "TQUANT": 1
}
                            </div>
                        </div>
                    </div>
                </div>

                <button class="collapsible">ğŸ“„ ×—×©×‘×•× ×™×•×ª ×¢× ×ª×¢×•×“×•×ª (Documents)</button>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <h4>×–×™×”×•×™</h4>
                        <ul>
                            <li><strong>structure.has_doc = true</strong></li>
                            <li>processing_scenario.all_templates[].check_docs = true</li>
                        </ul>

                        <h4>×œ×•×’×™×§×” ××™×•×—×“×ª</h4>
                        <ul>
                            <li>×—×™×¤×•×© ×ª×¢×•×“×•×ª ×‘-UnidentifiedNumbers</li>
                            <li>×”×ª×××” ××•×œ docs_list (BOOKNUM â†’ DOCNO)</li>
                            <li>×× × ××¦××• ×ª×¢×•×“×•×ª: <strong>×œ× ×™×•×¦×¨ PINVOICEITEMS_SUBFORM</strong></li>
                            <li>×ª×¢×•×“×” ×™×—×™×“×”: DOCNO ×‘×©×“×” ×¨×’×™×œ</li>
                            <li>××¡×¤×¨ ×ª×¢×•×“×•×ª: PIVDOC_SUBFORM</li>
                        </ul>

                        <div class="example-box">
                            <h4>×“×•×’××” - ×ª×¢×•×“×” ×™×—×™×“×”</h4>
                            <div class="code-block">
{
  "BOOKNUM": "25403318",
  "DOCNO": "25023118",
  "ORDNAME": "2501002992"
}
                            </div>
                        </div>
                    </div>
                </div>

                <button class="collapsible">ğŸ“¦ ×—×©×‘×•× ×™×•×ª ×¢× ×™×‘×•× (Import)</button>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <h4>×–×™×”×•×™</h4>
                        <ul>
                            <li><strong>structure.has_import = true</strong></li>
                            <li>processing_scenario.all_templates[].check_import = true</li>
                        </ul>

                        <h4>×œ×•×’×™×§×” ××™×•×—×“×ª</h4>
                        <ul>
                            <li>×—×™×¤×•×© IMPFNUM ×‘-import_files</li>
                            <li>IMPFNUM ××•×¡×£ ×œ×—×©×‘×•× ×™×ª</li>
                            <li>×™×•×¦×¨ PINVOICEITEMS_SUBFORM ×¨×’×™×œ</li>
                        </ul>
                    </div>
                </div>

                <button class="collapsible">ğŸ“ ×—×©×‘×•× ×™×•×ª ×¨×’×™×œ×•×ª (Regular)</button>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <h4>×–×™×”×•×™</h4>
                        <ul>
                            <li>has_vehicles = false</li>
                            <li>has_doc = false</li>
                            <li>has_import = false</li>
                        </ul>

                        <h4>×œ×•×’×™×§×”</h4>
                        <ul>
                            <li>×™×•×¦×¨ PINVOICEITEMS_SUBFORM ××”-OCR Items</li>
                            <li>×× ××™×Ÿ items ×‘-OCR: ×œ×•×§×— ××”×ª×‘× ×™×ª</li>
                            <li>DETAILS ××”×ª×‘× ×™×ª ××• ××”-OCR</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 3: Fields Drill-Down -->
            <section id="fields">
                <h2>3ï¸âƒ£ ×¤×™×¨×•×˜ ×©×“×•×ª - ×“×¨×™×œ ×“××•×Ÿ ××œ×</h2>

                <div class="field-card">
                    <div class="field-header">
                        SUPNAME - ×§×•×“ ×¡×¤×§
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-template">Template</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×—×•×‘×”</div>
                            <div class="meta-value">âœ… ×›×Ÿ</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×¡×•×’</div>
                            <div class="meta-value">String</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">××•×¨×š ××§×¡×™××œ×™</div>
                            <div class="meta-value">10 ×ª×•×•×™×</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×§×‘×œ×ª ×¢×¨×š</h4>
                    <ol>
                        <li>template.SUPNAME</li>
                        <li>config.supplier_config.supplier_code</li>
                        <li>learnedConfig.supplier_id</li>
                        <li>learnedConfig.llm_prompt.supplier_code</li>
                        <li>learnedConfig.technical_config.supplier_code</li>
                    </ol>

                    <div class="example-box">
                        <strong>×“×•×’××”:</strong> "5014"
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        CODE - ××˜×‘×¢
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-template">Template</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×—×•×‘×”</div>
                            <div class="meta-value">âœ… ×›×Ÿ</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×¢×¨×š ×‘×¨×™×¨×ª ××—×“×œ</div>
                            <div class="meta-value">"×©\"×—"</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×§×‘×œ×ª ×¢×¨×š</h4>
                    <div class="code-block">
CODE: template.CODE || "×©\"×—"
                    </div>

                    <div class="example-box">
                        <strong>×“×•×’××”:</strong> "×©\"×—", "USD", "EUR"
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        DEBIT - ×¡×•×’ ×–×™×›×•×™/×—×™×•×‘
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-calculated">Calculated</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×¢×¨×›×™× ××¤×©×¨×™×™×</div>
                            <div class="meta-value">"D" (×—×™×•×‘) / "C" (×–×™×›×•×™)</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×–×™×”×•×™</h4>
                    <ul>
                        <li>×‘×•×“×§ InvoiceId ×”×× ××›×™×œ "×–×™×›×•×™" ××• "credit"</li>
                        <li>×‘×•×“×§ InvoiceTotal_amount - ×× ×©×œ×™×œ×™ = ×–×™×›×•×™</li>
                        <li>×‘×¨×™×¨×ª ××—×“×œ: structure.debit_type</li>
                    </ul>

                    <div class="code-block">
DEBIT: structure.debit_type || "D"
                    </div>

                    <div class="example-box">
                        <strong>×“×•×’××”:</strong> "D" (×¨×•×‘ ×”×—×©×‘×•× ×™×•×ª)
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        IVDATE - ×ª××¨×™×š ×—×©×‘×•× ×™×ª
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-ocr">OCR</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×©×“×” OCR</div>
                            <div class="meta-value">InvoiceDate</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×¤×•×¨××˜</div>
                            <div class="meta-value">DD/MM/YY</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×”××¨×”</h4>
                    <div class="code-block">
// OCR: "2025-07-08" â†’ "08/07/25"
function searchIvdate(ocrFields) {
    const rawDate = ocrFields.InvoiceDate || "";
    // ×”××¨×” ×œ×¤×•×¨××˜ DD/MM/YY
    return formatDateToPriority(rawDate);
}
                    </div>

                    <div class="example-box">
                        <strong>OCR:</strong> "2025-07-08"<br>
                        <strong>Priority:</strong> "08/07/25"
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        BOOKNUM - ××¡×¤×¨ ×—×©×‘×•× ×™×ª
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-ocr">OCR</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×©×“×” OCR</div>
                            <div class="meta-value">InvoiceId</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">× ×™×§×•×™</div>
                            <div class="meta-value">âœ… ×›×Ÿ</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª × ×™×§×•×™</h4>
                    <div class="code-block">
function searchBooknum(ocrFields, patterns) {
    const original = ocrFields.InvoiceId || "";
    let booknum = String(original);

    // ×”×¡×¨ "SI" ××”×ª×—×œ×”
    booknum = booknum.replace(/^SI/i, '');

    // ×§×— ×¨×§ ××¡×¤×¨×™× ×•××§×¤×™× ××”×ª×—×œ×”
    const match = booknum.match(/^[\d\-\/]+/);
    if (match) {
        booknum = match[0];
    }

    // ×”×¡×¨ ××§×¤×™× ×•-slashes ××”×¡×•×£
    booknum = booknum.replace(/[\-\/]+$/, '');

    return booknum;
}
                    </div>

                    <div class="example-box">
                        <strong>OCR:</strong> "286015 NS"<br>
                        <strong>Priority:</strong> "286015"
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        DETAILS - ×¤×¨×˜×™× × ×•×¡×¤×™×
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-ocr">OCR</span> / <span class="badge badge-template">Template</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×—×•×‘×”</div>
                            <div class="meta-value">âŒ ×œ×</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×§×‘×œ×ª ×¢×¨×š</h4>
                    <div class="code-block">
// ×‘×¨×›×‘×™×: ×ª××™×“ null
if (searchResults.vehicles && searchResults.vehicles.length > 0) {
    invoice.DETAILS = null;
}

// ×‘×—×©×‘×•× ×™×•×ª ×¨×’×™×œ×•×ª:
// - ×× ×™×© InvoiceDescription ×‘-OCR: ×œ×•×§×— ××•×ª×•
// - ××—×¨×ª: ×©×•×¨×” ×©×œ×™×©×™×ª ××”-AZURE_TEXT
// - ××¡× ×Ÿ "×¢×‘×•×“×”" ×›×œ×œ×™×ª

// ××¨×›×‘×™× ×¢× ×§×™×œ×•××˜×¨××–' (legacy):
// DETAILS = "×˜×™×¤×•×œ-103577"
                    </div>

                    <div class="warning-box">
                        <strong>âš ï¸ ×—×©×•×‘:</strong> ×‘×¨×›×‘×™× - DETAILS = null (×œ× ×ª×™××•×¨ ×›×œ×œ×™)
                    </div>

                    <div class="example-box">
                        <strong>×¨×›×‘×™×:</strong> null<br>
                        <strong>×¨×’×™×œ×”:</strong> "×’×©×¨ ×”×¢×¥ 20"
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        ORDNAME - ××¡×¤×¨ ×”×–×× ×”
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-ocr">OCR</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×©×“×” OCR</div>
                            <div class="meta-value">PurchaseOrder</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×—×•×‘×”</div>
                            <div class="meta-value">âŒ ×œ×</div>
                        </div>
                    </div>

                    <div class="example-box">
                        <strong>×“×•×’××”:</strong> "2501002992"
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        DOCNO - ××¡×¤×¨ ×ª×¢×•×“×”
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-search">Documents Search</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×ª×œ×•×™ ×‘</div>
                            <div class="meta-value">structure.has_doc = true</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×—×™×¤×•×©</h4>
                    <ol>
                        <li>×—×™×¤×•×© ××¡×¤×¨×™× ×‘-UnidentifiedNumbers</li>
                        <li>×”×ª×××” ××•×œ docs_list (BOOKNUM â†’ DOCNO)</li>
                        <li>Fallback: ×—×™×¤×•×© ×‘-AZURE_TEXT</li>
                    </ol>

                    <div class="example-box">
                        <strong>×ª×¢×•×“×” ×™×—×™×“×”:</strong><br>
                        DOCNO = "25023118" (×©×“×” ×¨×’×™×œ)<br><br>
                        <strong>××¡×¤×¨ ×ª×¢×•×“×•×ª:</strong><br>
                        PIVDOC_SUBFORM = [<br>
                        &nbsp;&nbsp;{ DOCNO: "25023118", BOOKNUM: "25403318" },<br>
                        &nbsp;&nbsp;{ DOCNO: "25023119", BOOKNUM: "25403319" }<br>
                        ]
                    </div>
                </div>

                <div class="field-card">
                    <div class="field-header">
                        IMPFNUM - ××¡×¤×¨ ×§×•×‘×¥ ×™×‘×•×
                    </div>
                    <div class="field-meta">
                        <div class="meta-item">
                            <div class="meta-label">××§×•×¨</div>
                            <div class="meta-value"><span class="badge badge-search">Import Files Search</span></div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">×ª×œ×•×™ ×‘</div>
                            <div class="meta-value">structure.has_import = true</div>
                        </div>
                    </div>

                    <h4>×œ×•×’×™×§×ª ×—×™×¤×•×©</h4>
                    <ul>
                        <li>××—×¤×© ×‘-import_files.IMPFILES</li>
                        <li>××ª××™× ×œ×¤×™ ×ª××¨×™×š ××• ××¡×¤×¨ ×—×©×‘×•× ×™×ª</li>
                    </ul>
                </div>
            </section>

            <!-- Section 4: Items -->
            <section id="items">
                <h2>4ï¸âƒ£ ×¤×™×¨×•×˜ ×¤×¨×™×˜×™× (PINVOICEITEMS_SUBFORM)</h2>

                <div class="info-box">
                    <h3>×§×‘×œ×ª ×”×—×œ×˜×”: ××ª×™ ×™×•×¦×¨ ×¤×¨×™×˜×™×?</h3>
                    <div class="code-block">
const needItems = !structure.has_doc ||
                  !searchResults.documents ||
                  searchResults.documents.length === 0;

if (needItems) {
    // ×™×•×¦×¨ ×¤×¨×™×˜×™×
}
                    </div>
                    <p><strong>×›×œ×•××¨:</strong> ×× ×™×© ×ª×¢×•×“×•×ª ×•× ××¦××• - ×œ× ×™×•×¦×¨ ×¤×¨×™×˜×™×!</p>
                </div>

                <h3>×©×“×•×ª ×‘×¤×¨×™×˜</h3>

                <table>
                    <tr>
                        <th>×©×“×”</th>
                        <th>××§×•×¨ (×¨×›×‘×™×)</th>
                        <th>××§×•×¨ (×¨×’×™×œ)</th>
                        <th>×—×•×‘×”</th>
                    </tr>
                    <tr>
                        <td><strong>PARTNAME</strong></td>
                        <td>"car"</td>
                        <td>"car" / Items[].PartName</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>PDES</strong></td>
                        <td>×ª×™××•×¨×™ ××•×¦×¨×™× ×-Items<br>(×××•×™×Ÿ ×œ×¤×™ ×¡×›×•×)</td>
                        <td>Items[].Description</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>TQUANT</strong></td>
                        <td>1</td>
                        <td>Items[].Quantity</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>TUNITNAME</strong></td>
                        <td>"×™×—'"</td>
                        <td>Items[].Unit || "×™×—'"</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>PRICE</strong></td>
                        <td>SubTotal / vehicle_count</td>
                        <td>Items[].Amount</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>VATFLAG</strong></td>
                        <td>mapping.vat_pattern.VATFLAG</td>
                        <td>template.VATFLAG || "Y"</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>ACCNAME</strong></td>
                        <td>mapping.accname (×-vehicles)</td>
                        <td>template.ACCNAME</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td><strong>SPECIALVATFLAG</strong></td>
                        <td>mapping.vat_pattern.SPECIALVATFLAG</td>
                        <td>template.SPECIALVATFLAG</td>
                        <td>âŒ</td>
                    </tr>
                    <tr>
                        <td><strong>BUDCODE</strong></td>
                        <td>mapping.budcode || default</td>
                        <td>template.BUDCODE</td>
                        <td>âŒ</td>
                    </tr>
                </table>

                <h3>×œ×•×’×™×§×ª PDES ×‘×¨×›×‘×™× (v1.7.1)</h3>
                <div class="code-block">
// ×××™×™×Ÿ Items ×œ×¤×™ Amount (×”×’×‘×•×” ×‘×™×•×ª×¨ ×¨××©×•×Ÿ)
const sortedItems = [...ocrItems].sort((a, b) => {
    const amountA = parseFloat(a.Amount_amount || a.Amount || 0);
    const amountB = parseFloat(b.Amount_amount || b.Amount || 0);
    return amountB - amountA;
});

// ××¡× ×Ÿ ×ª×™××•×¨×™× ×›×œ×œ×™×™×
const excludeTerms = ['×¢×‘×•×“×”', 'work', 'labor'];
const productDescriptions = [];

for (const item of sortedItems) {
    const desc = item.Description_content || item.Description || '';
    const isGeneric = excludeTerms.some(term => desc.trim() === term);

    if (desc && !isGeneric && productDescriptions.length < 3) {
        productDescriptions.push(desc.trim());
    }
}

// ×©×™×œ×•×‘ ×¢× "+"
PDES = productDescriptions.join('+ ');
                </div>

                <div class="success-box">
                    <h4>âœ… ×“×•×’××” ××•×¦×œ×—×ª</h4>
                    <strong>Items OCR:</strong>
                    <ul>
                        <li>×¢×‘×•×“×” - 150 â‚ª (××¡×•× ×Ÿ!)</li>
                        <li>×©×œ×˜ ×¨××¤×” ××œ×—×•×˜×™ GALILO - 650 â‚ª</li>
                        <li>××›×¡×” ×¡×•×œ×¨ ××™×¡×•×–×• - 350 â‚ª</li>
                    </ul>
                    <strong>PDES:</strong> "×©×œ×˜ ×¨××¤×” ××œ×—×•×˜×™ GALILO+ ××›×¡×” ×¡×•×œ×¨ ××™×¡×•×–×•"
                </div>

                <h3>×œ×•×’×™×§×ª PRICE ×‘×¨×›×‘×™×</h3>
                <div class="code-block">
// ×—×™×©×•×‘ SubTotal (×œ×¤× ×™ ××¢×)
let subtotal = ocrFields.SubTotal_amount || ocrFields.SubTotal || 0;

if (!subtotal && ocrFields.InvoiceTotal_amount && ocrFields.TotalTax_amount) {
    subtotal = ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount;
    console.log(`ğŸ“Š Calculated SubTotal: ${subtotal}`);
}

const pricePerVehicle = vehicles.length > 0 ? subtotal / vehicles.length : subtotal;
                </div>

                <div class="example-box">
                    <strong>InvoiceTotal:</strong> 1357 â‚ª<br>
                    <strong>TotalTax:</strong> 207 â‚ª<br>
                    <strong>SubTotal:</strong> 1357 - 207 = 1150 â‚ª<br>
                    <strong>Vehicles:</strong> 1<br>
                    <strong>PRICE:</strong> 1150 â‚ª
                </div>
            </section>

            <!-- Section 5: Validation -->
            <section id="validation">
                <h2>5ï¸âƒ£ ×‘×§×¨×•×ª ×•××™××•×ª (validation)</h2>

                <h3>××‘× ×” validation</h3>
                <div class="code-block">
{
  "all_valid": true,
  "checks": {
    "required_fields_check": "passed",
    "invoice_structure_check": "passed",
    "amount_validation": "passed",
    "field_mapping": { ... }
  },
  "warnings": [
    "âœ… ×¡×›×•× ×ª×§×™×Ÿ: 1150.00 ×©\"×— (0.0% ×”×¤×¨×©)"
  ]
}
                </div>

                <h3>×‘×“×™×§×•×ª</h3>

                <h4>1. required_fields_check</h4>
                <p>×‘×•×“×§ × ×•×›×—×•×ª ×©×“×•×ª ×—×•×‘×”:</p>
                <ul>
                    <li>SUPNAME</li>
                    <li>CODE</li>
                    <li>DEBIT</li>
                    <li>IVDATE</li>
                    <li>BOOKNUM</li>
                </ul>

                <h4>2. invoice_structure_check</h4>
                <p>×‘×•×“×§ ×ª×§×™× ×•×ª ××‘× ×” ×”×—×©×‘×•× ×™×ª</p>

                <h4>3. amount_validation</h4>
                <p>×‘×•×“×§ ×”×ª×××ª ×¡×›×•××™×:</p>
                <div class="code-block">
// ×—×™×©×•×‘ ×¡×›×•× ××”×¤×¨×™×˜×™×
const calculatedTotal = PINVOICEITEMS_SUBFORM.reduce((sum, item) => {
    return sum + (item.TQUANT || 0) * (item.PRICE || 0);
}, 0);

// ×§×‘×œ×ª SubTotal ×-OCR
let ocrSubtotal = ocrFields.SubTotal || ocrFields.SubTotal_amount || 0;
if (!ocrSubtotal && ocrFields.InvoiceTotal_amount && ocrFields.TotalTax_amount) {
    ocrSubtotal = ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount;
}

// ×‘×“×™×§×ª ×”×¤×¨×©
const difference = Math.abs(calculatedTotal - ocrSubtotal);
const percentDiff = (difference / ocrSubtotal) * 100;

if (percentDiff > 5) {
    warnings.push(`âš ï¸ ×”×¤×¨×© ×¡×›×•××™×: ${percentDiff.toFixed(1)}%`);
} else {
    warnings.push(`âœ… ×¡×›×•× ×ª×§×™×Ÿ: ${calculatedTotal.toFixed(2)} ×©"×—`);
}
                </div>

                <div class="warning-box">
                    <strong>âš ï¸ ×—×©×•×‘:</strong> ×”×©×•×•××” ×©×œ SubTotal (×œ×¤× ×™ ××¢×) ×•×œ× Total!
                </div>
            </section>

            <!-- Section 6: Metadata -->
            <section id="metadata">
                <h2>6ï¸âƒ£ ××˜×-×“××˜×” (metadata)</h2>

                <div class="code-block">
{
  "ocr_invoice_id": "286015 NS",
  "ocr_invoice_date": "2025-07-08",
  "ocr_total_amount": 1357,
  "ocr_subtotal": 1150,
  "ocr_tax": 207,
  "processing_timestamp": "2025-11-06T11:34:56.706Z",
  "version": "1.0-production",
  "template_index": 0,
  "template_type": "vehicles",
  "has_vehicles": true,
  "vehicle_numbers": ["419-29-702"],
  "vehicle_count": 1,
  "has_documents": false,
  "document_count": 0,
  "has_import": false
}
                </div>

                <h3>×©×“×•×ª metadata</h3>
                <table>
                    <tr>
                        <th>×©×“×”</th>
                        <th>×ª×™××•×¨</th>
                        <th>××§×•×¨</th>
                    </tr>
                    <tr>
                        <td><strong>ocr_invoice_id</strong></td>
                        <td>××¡×¤×¨ ×—×©×‘×•× ×™×ª ××§×•×¨×™ ×-OCR</td>
                        <td>InvoiceId</td>
                    </tr>
                    <tr>
                        <td><strong>ocr_invoice_date</strong></td>
                        <td>×ª××¨×™×š ××§×•×¨×™ ×-OCR</td>
                        <td>InvoiceDate</td>
                    </tr>
                    <tr>
                        <td><strong>ocr_total_amount</strong></td>
                        <td>×¡×›×•× ×›×•×œ×œ (×¢× ××¢×)</td>
                        <td>InvoiceTotal_amount</td>
                    </tr>
                    <tr>
                        <td><strong>ocr_subtotal</strong></td>
                        <td>×¡×›×•× ×œ×¤× ×™ ××¢×</td>
                        <td>SubTotal ××• Total - Tax</td>
                    </tr>
                    <tr>
                        <td><strong>ocr_tax</strong></td>
                        <td>××¢×</td>
                        <td>TotalTax_amount</td>
                    </tr>
                    <tr>
                        <td><strong>template_type</strong></td>
                        <td>×¡×•×’ ×—×©×‘×•× ×™×ª</td>
                        <td>"vehicles" / "docs_only" / "import_only" / "regular"</td>
                    </tr>
                    <tr>
                        <td><strong>has_vehicles</strong></td>
                        <td>×”×× ×—×©×‘×•× ×™×ª ×¨×›×‘×™×</td>
                        <td>structure.has_vehicles</td>
                    </tr>
                    <tr>
                        <td><strong>vehicle_numbers</strong></td>
                        <td>××¡×¤×¨×™ ×¨×›×‘×™× ×©× ××¦××•</td>
                        <td>searchResults.vehicles</td>
                    </tr>
                    <tr>
                        <td><strong>vehicle_count</strong></td>
                        <td>××¡×¤×¨ ×¨×›×‘×™×</td>
                        <td>vehicles.length</td>
                    </tr>
                </table>
            </section>

            <!-- Section 7: Field Mapping -->
            <section id="field-mapping">
                <h2>7ï¸âƒ£ ××™×¤×•×™ ×©×“×•×ª (field_mapping)</h2>

                <div class="info-box">
                    <h3>ğŸ¯ ××˜×¨×”</h3>
                    <p>field_mapping ××¦×™×’ ×œ×›×œ ×©×“×” ×‘×—×©×‘×•× ×™×ª:</p>
                    <ul>
                        <li><strong>source</strong> - ××”×™×›×Ÿ ×”×¢×¨×š ×”×’×™×¢ (OCR, Template, Calculated, Search)</li>
                        <li><strong>field</strong> - ×©× ×”×©×“×” ×”××§×•×¨×™ ×‘-OCR (×× ×¨×œ×•×•× ×˜×™)</li>
                        <li><strong>value</strong> - ×”×¢×¨×š ×”×¡×•×¤×™</li>
                        <li><strong>ocr_value</strong> - ×”×¢×¨×š ×”××§×•×¨×™ ×-OCR (×× ×©×•× ×”)</li>
                    </ul>
                </div>

                <h3>×“×•×’××” ××œ××”</h3>
                <div class="code-block">
{
  "SUPNAME": {
    "source": "Template",
    "field": "supplier_code",
    "value": "5014"
  },
  "CODE": {
    "source": "Template",
    "value": "×©\"×—"
  },
  "DEBIT": {
    "source": "Template",
    "value": "D"
  },
  "IVDATE": {
    "source": "OCR",
    "field": "InvoiceDate",
    "value": "08/07/25",
    "ocr_value": "2025-07-08"
  },
  "BOOKNUM": {
    "source": "OCR",
    "field": "InvoiceId",
    "value": "286015",
    "ocr_value": "286015 NS"
  },
  "DETAILS": {
    "source": "OCR",
    "value": null
  },
  "PINVOICEITEMS_SUBFORM": {
    "source": "Vehicle Items",
    "vehicle_numbers": ["419-29-702"],
    "count": 1,
    "items": [
      {
        "PDES": "×©×œ×˜ ×¨××¤×” ××œ×—×•×˜×™ GALILO+ ××›×¡×” ×¡×•×œ×¨ ××™×¡×•×–×•",
        "ACCNAME": "66910",
        "PRICE": 1150
      }
    ]
  }
}
                </div>

                <h3>×¡×•×’×™ source</h3>
                <ul>
                    <li><strong>OCR</strong> - × ×œ×§×— ×™×©×™×¨×•×ª ×-AZURE_RESULT</li>
                    <li><strong>Template</strong> - × ×œ×§×— ××”×ª×‘× ×™×ª (learned_config)</li>
                    <li><strong>Calculated</strong> - ×—×•×©×‘ ××¢×¨×›×™× ××—×¨×™×</li>
                    <li><strong>Documents Search</strong> - × ××¦× ×‘×—×™×¤×•×© ×ª×¢×•×“×•×ª</li>
                    <li><strong>Vehicle Items</strong> - × ×‘× ×” ××¤×¨×™×˜×™ ×¨×›×‘×™×</li>
                    <li><strong>OCR Items</strong> - × ×‘× ×” ××¤×¨×™×˜×™ OCR</li>
                </ul>
            </section>

            <!-- Section 8: Flow -->
            <section id="flow">
                <h2>8ï¸âƒ£ ×ª×”×œ×™×š ×¢×™×‘×•×“ (Flow)</h2>

                <div class="flow-step">
                    <h3>×©×œ×‘ 1: ×¤×¨×¡×•×¨ input</h3>
                    <ul>
                        <li>×¤×¨×¡×•×¨ learned_config (string â†’ object)</li>
                        <li>×¤×¨×¡×•×¨ AZURE_RESULT (string â†’ object)</li>
                        <li>×¤×¨×¡×•×¨ vehicles (string â†’ array â†’ mapping)</li>
                        <li>×¤×¨×¡×•×¨ docs_list</li>
                        <li>×¤×¨×¡×•×¨ import_files</li>
                    </ul>
                </div>

                <div class="flow-step">
                    <h3>×©×œ×‘ 2: ×–×™×”×•×™ ×¡×•×’ ×•×ª×‘× ×™×ª</h3>
                    <ul>
                        <li>×‘× ×™×™×ª structure ×-processing_scenario.all_templates</li>
                        <li>×–×™×”×•×™: has_import, has_doc, has_vehicles, debit_type</li>
                        <li>×”×ª×××ª template index</li>
                    </ul>
                </div>

                <div class="flow-step">
                    <h3>×©×œ×‘ 3: ×—×™×¤×•×© × ×ª×•× ×™×</h3>
                    <ul>
                        <li>searchBooknum() - ××¡×¤×¨ ×—×©×‘×•× ×™×ª</li>
                        <li>searchIvdate() - ×ª××¨×™×š</li>
                        <li>searchDetails() - ×¤×¨×˜×™×</li>
                        <li>searchDocuments() - ×ª×¢×•×“×•×ª (×× has_doc)</li>
                        <li>extractVehiclesAdvanced() - ×¨×›×‘×™× (×× has_vehicles)</li>
                    </ul>
                </div>

                <div class="flow-step">
                    <h3>×©×œ×‘ 4: ×‘× ×™×™×ª ×—×©×‘×•× ×™×ª</h3>
                    <ul>
                        <li>buildInvoiceFromTemplate()</li>
                        <li>××™×¤×•×™ ×©×“×•×ª ×-template + searchResults</li>
                        <li>×‘×—×™×¨×ª needItems</li>
                        <li>×™×¦×™×¨×ª PINVOICEITEMS_SUBFORM</li>
                    </ul>
                </div>

                <div class="flow-step">
                    <h3>×©×œ×‘ 5: ×‘×§×¨×•×ª</h3>
                    <ul>
                        <li>performValidation()</li>
                        <li>×‘×“×™×§×ª ×©×“×•×ª ×—×•×‘×”</li>
                        <li>×‘×“×™×§×ª ×¡×›×•××™×</li>
                        <li>×‘× ×™×™×ª field_mapping</li>
                    </ul>
                </div>

                <div class="flow-step">
                    <h3>×©×œ×‘ 6: × ×™×ª×•×— ×œ××™×“×”</h3>
                    <ul>
                        <li>analyzeLearning()</li>
                        <li>×–×™×”×•×™ partnames ×—×“×©×™×</li>
                        <li>×–×™×”×•×™ ×¨×›×‘×™× ×—×“×©×™×</li>
                        <li>×–×™×”×•×™ ×—×©×‘×•× ×•×ª ×œ× ×™×“×•×¢×™×</li>
                    </ul>
                </div>

                <div class="flow-step">
                    <h3>×©×œ×‘ 7: × ×™×§×•×™ ×•×”×—×–×¨×”</h3>
                    <ul>
                        <li>cleanInvoiceForPriority()</li>
                        <li>×”×¡×¨×ª _learningNote</li>
                        <li>×”×¡×¨×ª undefined values</li>
                        <li>×‘× ×™×™×ª result ×¡×•×¤×™</li>
                    </ul>
                </div>
            </section>

            <!-- Section 9: Examples -->
            <section id="examples">
                <h2>9ï¸âƒ£ ×“×•×’×××•×ª ××œ××•×ª</h2>

                <button class="collapsible">×“×•×’××” 1: ×—×©×‘×•× ×™×ª ×¨×›×‘×™×</button>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <h4>Input</h4>
                        <div class="code-block">
{
  "learned_config": { ... },
  "vehicles": "{[{\"CAR_NUMBER\":\"419-29-702\",\"ACCNAME\":\"66910\",\"ASSDES\":\"419-29-702 ××—×–×§×ª ××©××™×ª\"}]}",
  "AZURE_RESULT": {
    "documents": [{
      "fields": {
        "InvoiceId": { "content": "286015 NS" },
        "InvoiceDate": { "content": "2025-07-08" },
        "InvoiceTotal": { "content": "1,357.00" },
        "TotalTax": { "content": "207.00" },
        "Items": {
          "valueArray": [
            { "valueObject": { "Description": { "content": "×¢×‘×•×“×”" }, "Amount": { "content": "150.00" } } },
            { "valueObject": { "Description": { "content": "×©×œ×˜ ×¨××¤×” ××œ×—×•×˜×™ GALILO" }, "Amount": { "content": "650.00" } } },
            { "valueObject": { "Description": { "content": "××›×¡×” ×¡×•×œ×¨ ××™×¡×•×–×•" }, "Amount": { "content": "350.00" } } }
          ]
        }
      }
    }]
  },
  "AZURE_TEXT_CLEAN": "... 419-29-702 ..."
}
                        </div>

                        <h4>Output</h4>
                        <div class="code-block">
{
  "status": "success",
  "invoice_data": {
    "PINVOICES": [{
      "SUPNAME": "5014",
      "CODE": "×©\"×—",
      "DEBIT": "D",
      "IVDATE": "08/07/25",
      "BOOKNUM": "286015",
      "DETAILS": null,
      "PINVOICEITEMS_SUBFORM": [{
        "PARTNAME": "car",
        "PDES": "×©×œ×˜ ×¨××¤×” ××œ×—×•×˜×™ GALILO+ ××›×¡×” ×¡×•×œ×¨ ××™×¡×•×–×•",
        "TQUANT": 1,
        "TUNITNAME": "×™×—'",
        "PRICE": 1150,
        "VATFLAG": "Y",
        "ACCNAME": "66910"
      }]
    }]
  },
  "validation": {
    "all_valid": true,
    "checks": {
      "amount_validation": "passed",
      "field_mapping": {
        "PINVOICEITEMS_SUBFORM": {
          "source": "Vehicle Items",
          "vehicle_numbers": ["419-29-702"]
        }
      }
    },
    "warnings": ["âœ… ×¡×›×•× ×ª×§×™×Ÿ: 1150.00 ×©\"×— (0.0% ×”×¤×¨×©)"]
  },
  "metadata": {
    "template_type": "vehicles",
    "has_vehicles": true,
    "vehicle_numbers": ["419-29-702"],
    "vehicle_count": 1,
    "ocr_subtotal": 1150,
    "ocr_tax": 207
  }
}
                        </div>
                    </div>
                </div>

                <button class="collapsible">×“×•×’××” 2: ×—×©×‘×•× ×™×ª ×¢× ×ª×¢×•×“×•×ª</button>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <h4>Input</h4>
                        <div class="code-block">
{
  "learned_config": { ... },
  "docs_list": "{[{\"BOOKNUM\":\"25403318\",\"DOCNO\":\"25023118\"}]}",
  "AZURE_RESULT": {
    "documents": [{
      "fields": {
        "InvoiceId": { "content": "25403318" },
        "UnidentifiedNumbers": [
          { "value": "25403318", "label": "××¡×¤×¨" }
        ]
      }
    }]
  }
}
                        </div>

                        <h4>Output</h4>
                        <div class="code-block">
{
  "status": "success",
  "invoice_data": {
    "PINVOICES": [{
      "SUPNAME": "5014",
      "BOOKNUM": "25403318",
      "DOCNO": "25023118",
      "ORDNAME": "2501002992"
      // âš ï¸ ××™×Ÿ PINVOICEITEMS_SUBFORM - ×™×© ×ª×¢×•×“×•×ª!
    }]
  },
  "metadata": {
    "template_type": "docs_only",
    "has_documents": true,
    "document_count": 1
  }
}
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <footer>
            <p>ğŸ“… ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: 06 × ×•×‘××‘×¨ 2025</p>
            <p>ğŸ”§ ×’×¨×¡×”: v1.7.1</p>
            <p>âœ… ×ª×™×§×•× ×™× ××—×¨×•× ×™×: PDES ××ª×™××•×¨×™ ××•×¦×¨×™× + DETAILS=null ×‘×¨×›×‘×™× + SubTotal + metadata + field_mapping</p>
        </footer>
    </div>

    <script>
        // Collapsible functionality
        var coll = document.getElementsByClassName("collapsible");
        for (var i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        }

        // Smooth scroll for TOC links
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
</body>
</html>
