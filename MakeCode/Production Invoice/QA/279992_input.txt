[
    {
        "input": [
            {
                "name": "learned_config",
                "value": {
                    "status": "success",
                    "supplier_id": "279992",
                    "supplier_name": "מודגל מתכת (99) בע\"מ",
                    "vendor_tax_id_reference": "558158374",
                    "supplier_phone": "04-6914207",
                    "supplier_email": "edna@modgal-metal.com",
                    "json_files_analyzed": 10,
                    "templates_detected": 3,
                    "config": {
                        "supplier_config": {
                            "supplier_code": "279992",
                            "supplier_name": "מודגל מתכת (99) בע\"מ",
                            "vendor_tax_id_reference": "558158374"
                        },
                        "structure": [
                            {
                                "has_import": false,
                                "has_purchase_orders": false,
                                "has_doc": false,
                                "has_date_range": false,
                                "has_budcode": false,
                                "has_pdaccname": false,
                                "inventory_management": "not_managed_inventory",
                                "debit_type": "D"
                            },
                            {
                                "has_import": true,
                                "has_purchase_orders": true,
                                "has_doc": true,
                                "has_date_range": false,
                                "has_budcode": false,
                                "has_pdaccname": false,
                                "inventory_management": "not_managed_inventory",
                                "debit_type": "D"
                            },
                            {
                                "has_import": false,
                                "has_purchase_orders": false,
                                "has_doc": false,
                                "has_date_range": false,
                                "has_budcode": true,
                                "has_pdaccname": false,
                                "inventory_management": "not_managed_inventory",
                                "debit_type": "C"
                            }
                        ],
                        "rules": {
                            "invoice_date_format": "DD/MM/YY",
                            "doc_variation": "תעודה אחת (DOCNO) או מרובות (PIVDOC_SUBFORM) - שניהם בתבנית",
                            "validation_data": {
                                "TOTQUANT": 1
                            },
                            "critical_patterns": {
                                "vehicle_rules": {},
                                "partname_rules": {}
                            }
                        },
                        "document_types": [
                            {
                                "type": "חשבונית רגילה עם פירוט",
                                "accnames": [
                                    "622015",
                                    "63001"
                                ]
                            },
                            {
                                "type": "חשבונית עם תיק יבוא עם תעודות",
                                "accnames": [
                                    "63001"
                                ]
                            },
                            {
                                "type": "זיכוי רגיל עם פירוט",
                                "accnames": [
                                    "66214"
                                ]
                            }
                        ]
                    },
                    "template": {
                        "PINVOICES": [
                            {
                                "SUPNAME": "279992",
                                "CODE": "ש\"ח",
                                "DEBIT": "D",
                                "IVDATE": "08/09/25",
                                "BOOKNUM": "250000620",
                                "PINVOICEITEMS_SUBFORM": [
                                    {
                                        "PARTNAME": "zzz10",
                                        "PDES": "חיוב חודשי -שרותי ניהול ואחסנה",
                                        "TQUANT": 1,
                                        "TUNITNAME": "יח'",
                                        "PRICE": 20000,
                                        "VATFLAG": "Y",
                                        "ACCNAME": "622015"
                                    },
                                    {
                                        "PARTNAME": "השהיית מכולה",
                                        "PDES": "השהיית מכולה (יבוא) אחסנה מודגל 132 פלים 762",
                                        "TQUANT": 1,
                                        "TUNITNAME": "יח'",
                                        "PRICE": 13554.09,
                                        "VATFLAG": "Y",
                                        "ACCNAME": "63001"
                                    }
                                ]
                            },
                            {
                                "SUPNAME": "279992",
                                "CODE": "ש\"ח",
                                "DEBIT": "D",
                                "IVDATE": "19/08/25",
                                "BOOKNUM": "SI250000596",
                                "DOCNO": "25025301",
                                "ORDNAME": "2501004925",
                                "IMPFNUM": "25c00104",
                                "DETAILS": "מחליפה את 2367",
                                "PIVDOC_SUBFORM": [
                                    {
                                        "DOCNO": "",
                                        "BOOKNUM": ""
                                    }
                                ]
                            },
                            {
                                "SUPNAME": "279992",
                                "CODE": "ש\"ח",
                                "DEBIT": "C",
                                "IVDATE": "23/04/25",
                                "BOOKNUM": "250000012",
                                "PINVOICESCONT_SUBFORM": [
                                    {
                                        "FNCPATNAME": "חסז"
                                    }
                                ]
                            }
                        ],
                        "document_types_count": 3
                    },
                    "recommended_samples": {
                        "samples": [
                            {
                                "sample_ivnum": "25064826",
                                "sample_booknum": "SI250000451",
                                "sample_impfnum": "25c00025",
                                "sample_supname": "279992"
                            },
                            {
                                "sample_ivnum": "25066858",
                                "sample_booknum": "250000620",
                                "sample_impfnum": "",
                                "sample_supname": "279992"
                            },
                            {
                                "sample_ivnum": "25070088",
                                "sample_booknum": "250000012",
                                "sample_impfnum": "",
                                "sample_supname": "279992"
                            }
                        ]
                    }
                }
            },
            {
                "name": "docs_list",
                "value": {
                    "list_of_docs": null,
                    "DOC_YES_NO": "N"
                }
            },
            {
                "name": "import_files",
                "value": {
                    "IMPFILES": [
                        ""
                    ]
                }
            },
            {
                "name": "AZURE_RESULT",
                "value": {
                    "structure": {
                        "docType": "string",
                        "fields": {
                            "CustomerAddress": "string",
                            "CustomerAddress_houseNumber": "string",
                            "CustomerAddress_road": "string",
                            "CustomerAddress_streetAddress": "string",
                            "CustomerAddress_house": "string",
                            "CustomerAddressRecipient": "string",
                            "CustomerName": "string",
                            "CustomerTaxId": "string",
                            "DueDate": "YYYY-MM-DD",
                            "InvoiceDate": "YYYY-MM-DD",
                            "InvoiceId": "string",
                            "InvoiceTotal_amount": "number",
                            "InvoiceTotal_currency": "string",
                            "PaymentTerm": "string",
                            "SubTotal_amount": "number",
                            "SubTotal_currency": "string",
                            "TotalTax_amount": "number",
                            "TotalTax_currency": "string",
                            "VendorAddress": "string",
                            "VendorAddress_postalCode": "string",
                            "VendorAddress_city": "string",
                            "VendorAddressRecipient": "string",
                            "VendorName": "string",
                            "VendorTaxId": "string",
                            "VendorTel": "string",
                            "VendorFax": "string",
                            "CustomerTel": "string",
                            "CustomerFax": "string",
                            "InvoiceTime": "HH:MM:SS",
                            "VendorEmail": "string",
                            "CustomerEmail": "string",
                            "UnidentifiedNumbers": [
                                "object"
                            ]
                        },
                        "Items": [
                            {
                                "Amount_amount": "number",
                                "Amount_currency": "string",
                                "Description": "string",
                                "ProductCode": "string",
                                "Quantity": "number",
                                "Unit": "string",
                                "UnitPrice_amount": "number",
                                "UnitPrice_currency": "string"
                            }
                        ]
                    },
                    "data": {
                        "docType": "invoice",
                        "fields": {
                            "CustomerAddress": "הקטיף 11 פארק תעשיות עמק חפר",
                            "CustomerAddress_houseNumber": "11",
                            "CustomerAddress_road": "הקטיף",
                            "CustomerAddress_streetAddress": "11 הקטיף",
                            "CustomerAddress_house": "פארק תעשיות עמק חפר",
                            "CustomerAddressRecipient": "ט.פ.י פל ים בע״מ",
                            "CustomerName": "ט.פ.י פל ים בע״מ",
                            "CustomerTaxId": "513327064",
                            "DueDate": "2025-10-31",
                            "InvoiceDate": "2025-09-09",
                            "InvoiceId": "SI250000620",
                            "InvoiceTotal_amount": 23600,
                            "InvoiceTotal_currency": "ILS",
                            "Items": [
                                {
                                    "Amount_amount": 20000,
                                    "Amount_currency": "ILS",
                                    "Description": "חיוב חודשי - שירותי ניהול ואחסנה - פלים",
                                    "ProductCode": "4B",
                                    "Quantity": 1,
                                    "Unit": "יח׳",
                                    "UnitPrice_amount": 20000,
                                    "UnitPrice_currency": "ILS"
                                }
                            ],
                            "PaymentTerm": "ש+30",
                            "SubTotal_amount": 20000,
                            "SubTotal_currency": "ILS",
                            "TotalTax_amount": 3600,
                            "TotalTax_currency": "ILS",
                            "VendorAddress": "ראש פינה 12000,",
                            "VendorAddress_postalCode": "12000",
                            "VendorAddress_city": "ראש פינה",
                            "VendorAddressRecipient": "מודגל מתכת (99) בע״מ",
                            "VendorName": "מודגל מתכת (99) בע״מ",
                            "VendorTaxId": "512780883,",
                            "VendorTel": "04-6914202",
                            "VendorFax": "04-6914222",
                            "CustomerTel": "09-8304673",
                            "CustomerFax": "09-8947635",
                            "InvoiceTime": "14:42",
                            "VendorEmail": "modgalmetal@modgal-metal.com",
                            "CustomerEmail": "account@t-p-y.co.il",
                            "UnidentifiedNumbers": [
                                {
                                    "label": "עוסק מורשה",
                                    "value": "512780883, מס. תיק ניכויים: 935536177, באיחוד עוסקים מספר: 558158374"
                                },
                                {
                                    "label": "טלפון",
                                    "value": "09-8304673, פקס: 09-8947635"
                                },
                                {
                                    "label": "פרטים",
                                    "value": "שירותי ניהול 9/25"
                                },
                                {
                                    "label": "WINSERT",
                                    "value": "modgal:090925:C:SI250000620:account@t-p-y.co.il"
                                },
                                {
                                    "label": "ברקוד מספר חשבונית",
                                    "value": "*SI250000620*"
                                },
                                {
                                    "label": "לתשלום עד",
                                    "value": "31/10/25"
                                },
                                {
                                    "label": "מס. לקוח",
                                    "value": "81353075"
                                },
                                {
                                    "label": "מספר הקצאה",
                                    "value": ": 20250909144230205"
                                },
                                {
                                    "label": "דואר",
                                    "value": "edna@modgal-metal.com"
                                },
                                {
                                    "label": "טלפון",
                                    "value": "972-4-6914209"
                                },
                                {
                                    "label": "טלפון נייד",
                                    "value": "050-3344662"
                                },
                                {
                                    "label": "מספר זיהוי (VIN)",
                                    "value": "20250909144230205",
                                    "context": ": 47,200.00 ש״ח מספר הקצאה :: 20250909144230205 252091424 בברכה, עדנה נאמן מו"
                                }
                            ]
                        }
                    },
                    "metadata": {
                        "modelId": "prebuilt-invoice",
                        "totalFields": 33,
                        "uniqueDataFound": 12
                    },
                    "status": "success"
                }
            },
            {
                "name": "AZURE_TEXT",
                "value": "{\"status\":\"succeeded\",\"createdDateTime\":\"2025-11-02T15:25:06Z\",\"lastUpdatedDateTime\":\"2025-11-02T15:25:08Z\",\"analyzeResult\":{\"apiVersion\":\"2023-07-31\",\"modelId\":\"prebuilt-invoice\",\"stringIndexType\":\"textElements\",\"content\":\"מסמך ממוחשב\\nחתום דיגיטלית ומאושר\\nעל ידי גורם מאשר\\nלצורך אימות לחץ כאן!\\ncomsign\\nמודגל מתכת (99) בע״מ\\nwww.modgalmetal.com\\nmodgalmetal@modgal-metal.com ,04-6914202 .ת.ד. 63, ראש פינה 12000, טל. 04-6914222, פקס MODGA\\nעוסק מורשה: 512780883, מס. תיק ניכויים: 935536177, באיחוד עוסקים מספר: 558158374\\nלכבוד:\\nתאריך חשבונית: 09/09/25\\nט.פ.י פל ים בע״מ\\nהקטיף 11 פארק תעשיות עמק חפר\\nתאריך הדפסה: 09/09/25\\nשעת הדפסה: 14:42\\nטלפון: 09-8304673, פקס: 09-8947635\\nמספר תעודה: SI250000620\\nמס׳ חברה: 513327064\\nפרטים: שירותי ניהול 9/25\\nמס׳ תיק במע״מ: 513327064\\nWINSERT:modgal:090925:C:SI250000620:account@t-p-y.co.il\\nחשבונית מס מרכזת SI250000620 - מקור\\nהופק באמצעות Priority - פריוריטי סופטוור בע״מ\\nמק״ט\\nתאור מוצר\\nכמות\\nמחיר ליחידה\\nמחיר השורה\\n1\\n4B\\nחיוב חודשי - שירותי ניהול ואחסנה - פלים\\n1 יח׳\\n20,000.0000 ש״ח\\n20,000.00\\nברקוד מספר חשבונית : *SI250000620*\\nמחיר כולל\\n20,000.00\\nלתשלום עד: 31/10/25\\nתנאי תשלום: ש+30\\nמע״מ (18.00%)\\n3,600.00\\nמס. לקוח: 81353075\\nמס. חברה לקוח: 513327064\\nסה״כ מחיר\\n23,600.00 ש״ח\\nתיק מע״מ לקוח: 513327064\\nיתרה בהנח״ש: 47,200.00 ש״ח\\nמספר הקצאה :: 20250909144230205\\n252091424\\nבברכה,\\nעדנה נאמן\\nמודגל מתכת (99) בע״מ\\nדואר: edna@modgal-metal.com\\nטלפון: 972-4-6914209\\nטלפון נייד: 050-3344662\",\"pages\":[{\"pageNumber\":1,\"angle\":0,\"width\":8.2639,\"height\":11.6944,\"unit\":\"inch\",\"words\":[{\"content\":\"מסמך\",\"polygon\":[0.3706,0.0761,0.4975,0.0761,0.4975,0.137,0.3706,0.137],\"confidence\":0.982,\"span\":{\"offset\":0,\"length\":4}},{\"content\":\"ממוחשב\",\"polygon\":[0.1878,0.0761,0.3604,0.0761,0.3604,0.137,0.1878,0.132],\"confidence\":0.982,\"span\":{\"offset\":5,\"length\":6}},{\"content\":\"חתום\",\"polygon\":[0.467,0.1472,0.5787,0.1472,0.5787,0.203,0.467,0.203],\"confidence\":0.982,\"span\":{\"offset\":12,\"length\":4}},{\"content\":\"דיגיטלית\",\"polygon\":[0.2792,0.1472,0.4568,0.1472,0.4568,0.203,0.2792,0.203],\"confidence\":0.961,\"span\":{\"offset\":17,\"length\":8}},{\"content\":\"ומאושר\",\"polygon\":[0.1117,0.1472,0.269,0.1472,0.264,0.203,0.1117,0.198],\"confidence\":0.981,\"span\":{\"offset\":26,\"length\":6}},{\"content\":\"על\",\"polygon\":[0.467,0.2132,0.5178,0.2132,0.5178,0.2639,0.467,0.269],\"confidence\":0.982,\"span\":{\"offset\":33,\"length\":2}},{\"content\":\"ידי\",\"polygon\":[0.3858,0.2132,0.4518,0.2132,0.4568,0.269,0.3858,0.269],\"confidence\":0.982,\"span\":{\"offset\":36,\"length\":3}},{\"content\":\"גורם\",\"polygon\":[0.2995,0.2132,0.3756,0.2132,0.3756,0.269,0.2995,0.269],\"confidence\":0.982,\"span\":{\"offset\":40,\"length\":4}},{\"content\":\"מאשר\",\"polygon\":[0.1574,0.2132,0.2843,0.2132,0.2893,0.269,0.1624,0.269],\"confidence\":0.982,\"span\":{\"offset\":45,\"length\":4}},{\"content\":\"לצורך\",\"polygon\":[0.4467,0.2893,0.5736,0.2893,0.5736,0.3553,0.4467,0.3553],\"confidence\":0.961,\"span\":{\"offset\":50,\"length\":5}},{\"content\":\"אימות\",\"polygon\":[0.3249,0.2893,0.4315,0.2893,0.4315,0.3553,0.3249,0.3553],\"confidence\":0.982,\"span\":{\"offset\":56,\"length\":5}},{\"content\":\"לחץ\",\"polygon\":[0.2132,0.2893,0.3096,0.2893,0.3096,0.3553,0.2132,0.3553],\"confidence\":0.982,\"span\":{\"offset\":62,\"length\":3}},{\"content\":\"כאן!\",\"polygon\":[0.1218,0.2893,0.198,0.2893,0.203,0.3553,0.1269,0.3553],\"confidence\":0.971,\"span\":{\"offset\":66,\"length\":4}},{\"content\":\"comsign\",\"polygon\":[0.1472,0.4416,0.5228,0.4314,0.5228,0.538,0.1523,0.5279],\"confidence\":0.975,\"span\":{\"offset\":71,\"length\":7}},{\"content\":\"מודגל\",\"polygon\":[6.0558,1.0811,6.4517,1.0811,6.4517,1.2791,6.0609,1.2842],\"confidence\":0.98,\"span\":{\"offset\":79,\"length\":5}},{\"content\":\"מתכת\",\"polygon\":[5.6497,1.0862,6.0203,1.0811,6.0203,1.2842,5.6548,1.2842],\"confidence\":0.976,\"span\":{\"offset\":85,\"length\":4}},{\"content\":\"(99)\",\"polygon\":[5.2944,1.0913,5.6091,1.0862,5.6142,1.2842,5.2994,1.2842],\"confidence\":0.961,\"span\":{\"offset\":90,\"length\":4}},{\"content\":\"בע״מ\",\"polygon\":[4.9593,1.1014,5.2538,1.0913,5.2588,1.2842,4.9695,1.2791],\"confidence\":0.948,\"span\":{\"offset\":95,\"length\":4}},{\"content\":\"www.modgalmetal.com\",\"polygon\":[1.1015,1.0202,2.8122,1.0151,2.8122,1.1979,1.1066,1.2029],\"confidence\":0.951,\"span\":{\"offset\":100,\"length\":19}},{\"content\":\"modgalmetal@modgal-metal.com\",\"polygon\":[1.1523,1.274,3.0304,1.2689,3.0355,1.4364,1.1574,1.4364],\"confidence\":0.282,\"span\":{\"offset\":120,\"length\":28}},{\"content\":\",04-6914202\",\"polygon\":[3.066,1.2689,3.7665,1.2639,3.7665,1.4364,3.066,1.4364],\"confidence\":0.443,\"span\":{\"offset\":149,\"length\":11}},{\"content\":\".\",\"polygon\":[3.7969,1.2639,3.8528,1.2639,3.8528,1.4364,3.802,1.4364],\"confidence\":0.687,\"span\":{\"offset\":161,\"length\":1}},{\"content\":\"ת.ד.\",\"polygon\":[6.1979,1.274,6.4771,1.274,6.4771,1.4314,6.1979,1.4314],\"confidence\":0.7,\"span\":{\"offset\":162,\"length\":4}},{\"content\":\"63,\",\"polygon\":[5.9796,1.274,6.1624,1.274,6.1624,1.4314,5.9796,1.4314],\"confidence\":0.748,\"span\":{\"offset\":167,\"length\":3}},{\"content\":\"ראש\",\"polygon\":[5.7766,1.2689,5.9492,1.274,5.9492,1.4314,5.7766,1.4364],\"confidence\":0.782,\"span\":{\"offset\":171,\"length\":3}},{\"content\":\"פינה\",\"polygon\":[5.5177,1.2689,5.7411,1.2689,5.7411,1.4364,5.5177,1.4364],\"confidence\":0.787,\"span\":{\"offset\":175,\"length\":4}},{\"content\":\"12000,\",\"polygon\":[5.0507,1.2689,5.4822,1.2689,5.4822,1.4364,5.0507,1.4364],\"confidence\":0.714,\"span\":{\"offset\":180,\"length\":6}},{\"content\":\"טל.\",\"polygon\":[4.8375,1.2689,5.0203,1.2689,5.0203,1.4364,4.8375,1.4364],\"confidence\":0.765,\"span\":{\"offset\":187,\"length\":3}},{\"content\":\"04-6914222,\",\"polygon\":[4.1015,1.2689,4.802,1.2689,4.802,1.4364,4.1015,1.4364],\"confidence\":0.231,\"span\":{\"offset\":191,\"length\":11}},{\"content\":\"פקס\",\"polygon\":[3.8832,1.2639,4.071,1.2689,4.071,1.4364,3.8883,1.4364],\"confidence\":0.687,\"span\":{\"offset\":203,\"length\":3}},{\"content\":\"MODGA\",\"polygon\":[6.5076,1.274,7.0964,1.2791,7.0964,1.4314,6.5076,1.4314],\"confidence\":0.103,\"span\":{\"offset\":207,\"length\":5}},{\"content\":\"עוסק\",\"polygon\":[7.1167,1.7257,7.3857,1.7308,7.3857,1.8932,7.1167,1.8932],\"confidence\":0.982,\"span\":{\"offset\":213,\"length\":4}},{\"content\":\"מורשה:\",\"polygon\":[6.6345,1.7257,7.0862,1.7257,7.0862,1.8932,6.6345,1.8932],\"confidence\":0.98,\"span\":{\"offset\":218,\"length\":6}},{\"content\":\"512780883,\",\"polygon\":[5.8629,1.7257,6.604,1.7257,6.604,1.8932,5.8629,1.8932],\"confidence\":0.949,\"span\":{\"offset\":225,\"length\":10}},{\"content\":\"מס.\",\"polygon\":[5.6142,1.7257,5.8324,1.7257,5.8324,1.8932,5.6142,1.8932],\"confidence\":0.982,\"span\":{\"offset\":236,\"length\":3}},{\"content\":\"תיק\",\"polygon\":[5.4111,1.7257,5.5837,1.7257,5.5837,1.8932,5.4111,1.8932],\"confidence\":0.965,\"span\":{\"offset\":240,\"length\":3}},{\"content\":\"ניכויים:\",\"polygon\":[4.9492,1.7257,5.3807,1.7257,5.3807,1.8932,4.9492,1.8932],\"confidence\":0.92,\"span\":{\"offset\":244,\"length\":8}},{\"content\":\"935536177,\",\"polygon\":[4.1776,1.7257,4.9187,1.7257,4.9187,1.8932,4.1776,1.8932],\"confidence\":0.921,\"span\":{\"offset\":253,\"length\":10}},{\"content\":\"באיחוד\",\"polygon\":[3.7817,1.7257,4.1472,1.7257,4.1472,1.8932,3.7817,1.8882],\"confidence\":0.961,\"span\":{\"offset\":264,\"length\":6}},{\"content\":\"עוסקים\",\"polygon\":[3.3756,1.7308,3.7512,1.7257,3.7512,1.8882,3.3756,1.8882],\"confidence\":0.975,\"span\":{\"offset\":271,\"length\":6}},{\"content\":\"מספר:\",\"polygon\":[2.934,1.7308,3.3451,1.7308,3.3451,1.8882,2.934,1.8882],\"confidence\":0.976,\"span\":{\"offset\":278,\"length\":5}},{\"content\":\"558158374\",\"polygon\":[2.2487,1.7359,2.9035,1.7308,2.9035,1.8882,2.2487,1.8831],\"confidence\":0.779,\"span\":{\"offset\":284,\"length\":9}},{\"content\":\"לכבוד:\",\"polygon\":[6.939,2.2181,7.3197,2.2079,7.3197,2.3399,6.939,2.345],\"confidence\":0.976,\"span\":{\"offset\":294,\"length\":6}},{\"content\":\"תאריך\",\"polygon\":[2.3147,2.2029,2.67,2.1978,2.67,2.3602,2.3147,2.3551],\"confidence\":0.982,\"span\":{\"offset\":301,\"length\":5}},{\"content\":\"חשבונית:\",\"polygon\":[1.7259,2.1978,2.2842,2.2029,2.2842,2.3551,1.7259,2.3501],\"confidence\":0.961,\"span\":{\"offset\":307,\"length\":8}},{\"content\":\"09/09/25\",\"polygon\":[1.1827,2.1927,1.6954,2.1978,1.6954,2.3501,1.1878,2.345],\"confidence\":0.976,\"span\":{\"offset\":316,\"length\":8}},{\"content\":\"ט.פ.י\",\"polygon\":[6.9999,2.3602,7.3197,2.3602,7.3248,2.5023,7.005,2.5023],\"confidence\":0.982,\"span\":{\"offset\":325,\"length\":5}},{\"content\":\"פל\",\"polygon\":[6.8477,2.3602,6.9746,2.3602,6.9746,2.5023,6.8527,2.5023],\"confidence\":0.982,\"span\":{\"offset\":331,\"length\":2}},{\"content\":\"ים\",\"polygon\":[6.7055,2.3602,6.8172,2.3602,6.8223,2.5074,6.7055,2.5074],\"confidence\":0.982,\"span\":{\"offset\":334,\"length\":2}},{\"content\":\"בע״מ\",\"polygon\":[6.3705,2.3602,6.67,2.3602,6.67,2.5074,6.3705,2.5125],\"confidence\":0.863,\"span\":{\"offset\":337,\"length\":4}},{\"content\":\"הקטיף\",\"polygon\":[6.9593,2.5125,7.3248,2.5125,7.3248,2.6698,6.9644,2.6749],\"confidence\":0.982,\"span\":{\"offset\":342,\"length\":5}},{\"content\":\"11\",\"polygon\":[6.7461,2.5125,6.9289,2.5125,6.934,2.6749,6.7512,2.6749],\"confidence\":0.982,\"span\":{\"offset\":348,\"length\":2}},{\"content\":\"פארק\",\"polygon\":[6.4162,2.5125,6.7157,2.5125,6.7208,2.6749,6.4213,2.6749],\"confidence\":0.977,\"span\":{\"offset\":351,\"length\":4}},{\"content\":\"תעשיות\",\"polygon\":[5.9695,2.5125,6.3857,2.5125,6.3908,2.6749,5.9746,2.6749],\"confidence\":0.976,\"span\":{\"offset\":356,\"length\":6}},{\"content\":\"עמק\",\"polygon\":[5.6852,2.5125,5.9187,2.5125,5.9238,2.6749,5.6852,2.6749],\"confidence\":0.982,\"span\":{\"offset\":363,\"length\":3}},{\"content\":\"חפר\",\"polygon\":[5.406,2.5125,5.6497,2.5125,5.6548,2.6749,5.4111,2.6698],\"confidence\":0.982,\"span\":{\"offset\":367,\"length\":3}},{\"content\":\"תאריך\",\"polygon\":[2.3147,2.3602,2.6751,2.3551,2.6751,2.5125,2.3147,2.5125],\"confidence\":0.981,\"span\":{\"offset\":371,\"length\":5}},{\"content\":\"הדפסה:\",\"polygon\":[1.7969,2.3602,2.2842,2.3602,2.2893,2.5125,1.802,2.5074],\"confidence\":0.98,\"span\":{\"offset\":377,\"length\":6}},{\"content\":\"09/09/25\",\"polygon\":[1.2639,2.3551,1.7716,2.3602,1.7716,2.5074,1.2639,2.5023],\"confidence\":0.976,\"span\":{\"offset\":384,\"length\":8}},{\"content\":\"שעת\",\"polygon\":[2.4213,2.5125,2.6548,2.5074,2.6548,2.6647,2.4213,2.6546],\"confidence\":0.982,\"span\":{\"offset\":393,\"length\":3}},{\"content\":\"הדפסה:\",\"polygon\":[1.8832,2.5125,2.3858,2.5125,2.3858,2.6546,1.8832,2.6546],\"confidence\":0.975,\"span\":{\"offset\":397,\"length\":6}},{\"content\":\"14:42\",\"polygon\":[1.5381,2.5074,1.8528,2.5125,1.8579,2.6546,1.5431,2.6597],\"confidence\":0.976,\"span\":{\"offset\":404,\"length\":5}},{\"content\":\"טלפון:\",\"polygon\":[6.934,2.6851,7.3197,2.6851,7.3197,2.8424,6.934,2.8475],\"confidence\":0.962,\"span\":{\"offset\":410,\"length\":6}},{\"content\":\"09-8304673,\",\"polygon\":[6.1218,2.6851,6.9035,2.6851,6.9035,2.8475,6.1218,2.8475],\"confidence\":0.951,\"span\":{\"offset\":417,\"length\":11}},{\"content\":\"פקס:\",\"polygon\":[5.802,2.68,6.0862,2.6851,6.0913,2.8475,5.8071,2.8424],\"confidence\":0.982,\"span\":{\"offset\":429,\"length\":4}},{\"content\":\"09-8947635\",\"polygon\":[5.0609,2.68,5.7715,2.68,5.7715,2.8424,5.0659,2.8373],\"confidence\":0.961,\"span\":{\"offset\":434,\"length\":10}},{\"content\":\"מספר\",\"polygon\":[2.3401,2.6698,2.67,2.6698,2.67,2.817,2.3401,2.8119],\"confidence\":0.982,\"span\":{\"offset\":445,\"length\":4}},{\"content\":\"תעודה:\",\"polygon\":[1.8731,2.6647,2.3096,2.6698,2.3147,2.8119,1.8782,2.8119],\"confidence\":0.961,\"span\":{\"offset\":450,\"length\":6}},{\"content\":\"SI250000620\",\"polygon\":[1.066,2.6597,1.8477,2.6647,1.8477,2.8119,1.0711,2.8119],\"confidence\":0.801,\"span\":{\"offset\":457,\"length\":11}},{\"content\":\"מס׳\",\"polygon\":[7.0812,2.8475,7.3299,2.8424,7.3248,2.9997,7.0812,2.9997],\"confidence\":0.908,\"span\":{\"offset\":469,\"length\":3}},{\"content\":\"חברה:\",\"polygon\":[6.6903,2.8475,7.0507,2.8475,7.0507,2.9997,6.6903,2.9997],\"confidence\":0.982,\"span\":{\"offset\":473,\"length\":5}},{\"content\":\"513327064\",\"polygon\":[5.9898,2.8475,6.6598,2.8475,6.6598,2.9997,5.9949,2.9997],\"confidence\":0.96,\"span\":{\"offset\":479,\"length\":9}},{\"content\":\"פרטים:\",\"polygon\":[2.2386,2.8221,2.665,2.8221,2.665,2.9693,2.2386,2.9642],\"confidence\":0.98,\"span\":{\"offset\":489,\"length\":6}},{\"content\":\"שירותי\",\"polygon\":[1.8223,2.8221,2.2081,2.8221,2.2081,2.9642,1.8223,2.9642],\"confidence\":0.982,\"span\":{\"offset\":496,\"length\":6}},{\"content\":\"ניהול\",\"polygon\":[1.533,2.817,1.7919,2.8221,1.7969,2.9642,1.533,2.9693],\"confidence\":0.982,\"span\":{\"offset\":503,\"length\":5}},{\"content\":\"9/25\",\"polygon\":[1.2335,2.8119,1.5025,2.817,1.5076,2.9693,1.2386,2.9744],\"confidence\":0.978,\"span\":{\"offset\":509,\"length\":4}},{\"content\":\"מס׳\",\"polygon\":[7.071,3.0048,7.3248,2.9997,7.3248,3.1672,7.0761,3.1672],\"confidence\":0.849,\"span\":{\"offset\":514,\"length\":3}},{\"content\":\"תיק\",\"polygon\":[6.8781,3.0048,7.0405,3.0048,7.0405,3.1672,6.8781,3.1672],\"confidence\":0.982,\"span\":{\"offset\":518,\"length\":3}},{\"content\":\"במע״מ:\",\"polygon\":[6.3654,2.9997,6.8426,3.0048,6.8477,3.1672,6.3654,3.1672],\"confidence\":0.92,\"span\":{\"offset\":522,\"length\":6}},{\"content\":\"513327064\",\"polygon\":[5.6802,2.9947,6.335,2.9997,6.335,3.1672,5.6802,3.1571],\"confidence\":0.961,\"span\":{\"offset\":529,\"length\":9}},{\"content\":\"WINSERT:modgal:090925:C:SI250000620:account@t-p-y.co.il\",\"polygon\":[0.934,3.152,3.5837,3.1571,3.5837,3.284,0.934,3.2738],\"confidence\":0.712,\"span\":{\"offset\":539,\"length\":55}},{\"content\":\"חשבונית\",\"polygon\":[5.071,3.5124,5.67,3.5225,5.67,3.7053,5.071,3.7053],\"confidence\":0.976,\"span\":{\"offset\":595,\"length\":7}},{\"content\":\"מס\",\"polygon\":[4.7817,3.5124,5.0101,3.5124,5.0101,3.7053,4.7817,3.7002],\"confidence\":0.982,\"span\":{\"offset\":603,\"length\":2}},{\"content\":\"מרכזת\",\"polygon\":[4.2842,3.5073,4.7462,3.5073,4.7462,3.7002,4.2842,3.7002],\"confidence\":0.98,\"span\":{\"offset\":606,\"length\":5}},{\"content\":\"SI250000620\",\"polygon\":[3.1218,3.5124,4.2081,3.5073,4.2132,3.7002,3.1218,3.7053],\"confidence\":0.927,\"span\":{\"offset\":612,\"length\":11}},{\"content\":\"-\",\"polygon\":[2.9594,3.5175,3.0761,3.5124,3.0761,3.7053,2.9594,3.7053],\"confidence\":0.981,\"span\":{\"offset\":624,\"length\":1}},{\"content\":\"מקור\",\"polygon\":[2.599,3.5225,2.9238,3.5175,2.9238,3.7053,2.599,3.7053],\"confidence\":0.982,\"span\":{\"offset\":626,\"length\":4}},{\"content\":\"הופק\",\"polygon\":[0.8528,3.5936,0.8477,3.8017,0.736,3.8017,0.736,3.5936],\"confidence\":0.98,\"span\":{\"offset\":631,\"length\":4}},{\"content\":\"באמצעות\",\"polygon\":[0.8579,3.2383,0.8528,3.5733,0.736,3.5682,0.736,3.2383],\"confidence\":0.965,\"span\":{\"offset\":636,\"length\":7}},{\"content\":\"Priority\",\"polygon\":[0.8579,2.9084,0.8579,3.2129,0.736,3.2129,0.736,2.9135],\"confidence\":0.953,\"span\":{\"offset\":644,\"length\":8}},{\"content\":\"-\",\"polygon\":[0.8579,2.7104,0.8579,2.7866,0.736,2.7866,0.736,2.7155],\"confidence\":0.962,\"span\":{\"offset\":653,\"length\":1}},{\"content\":\"פריוריטי\",\"polygon\":[0.8579,2.3805,0.8579,2.6901,0.736,2.6901,0.736,2.3856],\"confidence\":0.954,\"span\":{\"offset\":655,\"length\":8}},{\"content\":\"סופטוור\",\"polygon\":[0.8528,2.0963,0.8579,2.3602,0.736,2.3602,0.731,2.1013],\"confidence\":0.923,\"span\":{\"offset\":664,\"length\":7}},{\"content\":\"בע״מ\",\"polygon\":[0.8477,1.8831,0.8528,2.076,0.731,2.081,0.7259,1.8932],\"confidence\":0.954,\"span\":{\"offset\":672,\"length\":4}},{\"content\":\"מק״ט\",\"polygon\":[6.8426,4.2788,7.0558,4.2788,7.0558,4.3854,6.8426,4.3854],\"confidence\":0.958,\"span\":{\"offset\":677,\"length\":4}},{\"content\":\"תאור\",\"polygon\":[5.2842,4.2738,5.5482,4.2738,5.5533,4.3905,5.2842,4.3956],\"confidence\":0.982,\"span\":{\"offset\":682,\"length\":4}},{\"content\":\"מוצר\",\"polygon\":[4.9847,4.2738,5.2436,4.2738,5.2487,4.3956,4.9898,4.4006],\"confidence\":0.982,\"span\":{\"offset\":687,\"length\":4}},{\"content\":\"כמות\",\"polygon\":[3.4721,4.2788,3.7157,4.2788,3.7157,4.3905,3.4721,4.3905],\"confidence\":0.982,\"span\":{\"offset\":692,\"length\":4}},{\"content\":\"מחיר\",\"polygon\":[2.7208,4.2636,2.9949,4.2636,2.9949,4.3905,2.7208,4.3956],\"confidence\":0.982,\"span\":{\"offset\":697,\"length\":4}},{\"content\":\"ליחידה\",\"polygon\":[2.3045,4.2636,2.6802,4.2636,2.6802,4.3956,2.3096,4.3956],\"confidence\":0.982,\"span\":{\"offset\":702,\"length\":6}},{\"content\":\"מחיר\",\"polygon\":[1.5076,4.2687,1.7817,4.2687,1.7817,4.3956,1.5127,4.3956],\"confidence\":0.982,\"span\":{\"offset\":709,\"length\":4}},{\"content\":\"השורה\",\"polygon\":[1.1167,4.2636,1.4771,4.2687,1.4771,4.3956,1.1218,4.4006],\"confidence\":0.982,\"span\":{\"offset\":714,\"length\":5}},{\"content\":\"1\",\"polygon\":[7.1675,4.5072,7.2436,4.5072,7.2385,4.6341,7.1675,4.6291],\"confidence\":0.982,\"span\":{\"offset\":720,\"length\":1}},{\"content\":\"4B\",\"polygon\":[6.8781,4.5072,7.0507,4.5072,7.0507,4.6341,6.8781,4.6341],\"confidence\":0.982,\"span\":{\"offset\":722,\"length\":2}},{\"content\":\"חיוב\",\"polygon\":[6.4416,4.5123,6.6598,4.5123,6.6598,4.6494,6.4416,4.6494],\"confidence\":0.98,\"span\":{\"offset\":725,\"length\":4}},{\"content\":\"חודשי\",\"polygon\":[6.0609,4.5072,6.4111,4.5123,6.4111,4.6494,6.0609,4.6494],\"confidence\":0.981,\"span\":{\"offset\":730,\"length\":5}},{\"content\":\"-\",\"polygon\":[5.9847,4.5072,6.0304,4.5072,6.0304,4.6494,5.9847,4.6494],\"confidence\":0.98,\"span\":{\"offset\":736,\"length\":1}},{\"content\":\"שירותי\",\"polygon\":[5.5888,4.5022,5.9543,4.5072,5.9543,4.6494,5.5939,4.6544],\"confidence\":0.981,\"span\":{\"offset\":738,\"length\":6}},{\"content\":\"ניהול\",\"polygon\":[5.3147,4.5022,5.5634,4.5022,5.5634,4.6544,5.3147,4.6544],\"confidence\":0.982,\"span\":{\"offset\":745,\"length\":5}},{\"content\":\"ואחסנה\",\"polygon\":[4.9035,4.5022,5.2842,4.5022,5.2893,4.6544,4.9035,4.6544],\"confidence\":0.982,\"span\":{\"offset\":751,\"length\":6}},{\"content\":\"-\",\"polygon\":[4.7715,4.5022,4.8578,4.5022,4.8578,4.6544,4.7715,4.6544],\"confidence\":0.982,\"span\":{\"offset\":758,\"length\":1}},{\"content\":\"פלים\",\"polygon\":[4.5025,4.5022,4.7411,4.5022,4.7411,4.6544,4.5025,4.6544],\"confidence\":0.982,\"span\":{\"offset\":760,\"length\":4}},{\"content\":\"1\",\"polygon\":[3.6649,4.4869,3.7665,4.4869,3.7715,4.6544,3.67,4.6544],\"confidence\":0.982,\"span\":{\"offset\":765,\"length\":1}},{\"content\":\"יח׳\",\"polygon\":[3.5127,4.4869,3.6345,4.4869,3.6345,4.6544,3.5127,4.6544],\"confidence\":0.855,\"span\":{\"offset\":767,\"length\":3}},{\"content\":\"20,000.0000\",\"polygon\":[2.533,4.5022,3.3045,4.5022,3.3096,4.6494,2.538,4.6494],\"confidence\":0.951,\"span\":{\"offset\":771,\"length\":11}},{\"content\":\"ש״ח\",\"polygon\":[2.2893,4.5072,2.5025,4.5072,2.5076,4.6494,2.2944,4.6544],\"confidence\":0.932,\"span\":{\"offset\":783,\"length\":3}},{\"content\":\"20,000.00\",\"polygon\":[1.2792,4.5072,1.8934,4.5072,1.8934,4.6494,1.2843,4.6443],\"confidence\":0.979,\"span\":{\"offset\":787,\"length\":9}},{\"content\":\"ברקוד\",\"polygon\":[6.9441,4.8016,7.2791,4.8067,7.2791,4.9437,6.9441,4.9437],\"confidence\":0.995,\"span\":{\"offset\":797,\"length\":5}},{\"content\":\"מספר\",\"polygon\":[6.6091,4.7965,6.9187,4.8016,6.9187,4.9437,6.6091,4.9437],\"confidence\":1,\"span\":{\"offset\":803,\"length\":4}},{\"content\":\"חשבונית\",\"polygon\":[6.1522,4.7915,6.5837,4.7965,6.5837,4.9437,6.1522,4.9437],\"confidence\":1,\"span\":{\"offset\":808,\"length\":7}},{\"content\":\":\",\"polygon\":[6.0659,4.7915,6.1218,4.7915,6.1218,4.9437,6.0659,4.9387],\"confidence\":1,\"span\":{\"offset\":816,\"length\":1}},{\"content\":\"*SI250000620*\",\"polygon\":[5.137,4.7813,6.0355,4.7915,6.0355,4.9387,5.137,4.9336],\"confidence\":0.947,\"span\":{\"offset\":818,\"length\":13}},{\"content\":\"מחיר\",\"polygon\":[3.137,4.7661,3.4365,4.7712,3.4365,4.9437,3.137,4.9437],\"confidence\":0.982,\"span\":{\"offset\":832,\"length\":4}},{\"content\":\"כולל\",\"polygon\":[2.8528,4.7712,3.1066,4.7661,3.1066,4.9437,2.8528,4.9437],\"confidence\":0.982,\"span\":{\"offset\":837,\"length\":4}},{\"content\":\"20,000.00\",\"polygon\":[1.5431,4.7813,2.1675,4.7762,2.1675,4.9285,1.5482,4.9285],\"confidence\":0.975,\"span\":{\"offset\":842,\"length\":9}},{\"content\":\"לתשלום\",\"polygon\":[6.8629,4.959,7.2842,4.959,7.2842,5.1011,6.8629,5.096],\"confidence\":0.976,\"span\":{\"offset\":852,\"length\":6}},{\"content\":\"עד:\",\"polygon\":[6.6091,4.959,6.8121,4.959,6.8121,5.096,6.6091,5.096],\"confidence\":0.982,\"span\":{\"offset\":859,\"length\":3}},{\"content\":\"31/10/25\",\"polygon\":[6.0659,4.959,6.5786,4.959,6.5837,5.096,6.071,5.1011],\"confidence\":0.961,\"span\":{\"offset\":863,\"length\":8}},{\"content\":\"תנאי\",\"polygon\":[6.9949,5.1163,7.2842,5.1112,7.2791,5.2584,6.9949,5.2483],\"confidence\":0.98,\"span\":{\"offset\":872,\"length\":4}},{\"content\":\"תשלום:\",\"polygon\":[6.5634,5.1163,6.9695,5.1163,6.9644,5.2483,6.5634,5.2483],\"confidence\":0.972,\"span\":{\"offset\":877,\"length\":6}},{\"content\":\"ש+30\",\"polygon\":[6.2284,5.1112,6.538,5.1163,6.538,5.2483,6.2334,5.2534],\"confidence\":0.982,\"span\":{\"offset\":884,\"length\":4}},{\"content\":\"מע״מ\",\"polygon\":[3.1218,5.0453,3.4264,5.0453,3.4314,5.2026,3.1218,5.2026],\"confidence\":0.933,\"span\":{\"offset\":889,\"length\":4}},{\"content\":\"(18.00%)\",\"polygon\":[2.5177,5.0453,3.0812,5.0503,3.0863,5.2026,2.5177,5.2077],\"confidence\":0.976,\"span\":{\"offset\":894,\"length\":8}},{\"content\":\"3,600.00\",\"polygon\":[1.6294,5.0402,2.1675,5.0402,2.1675,5.1823,1.6345,5.1823],\"confidence\":0.98,\"span\":{\"offset\":903,\"length\":8}},{\"content\":\"מס.\",\"polygon\":[7.0253,5.2584,7.274,5.2584,7.274,5.4259,7.0253,5.431],\"confidence\":0.982,\"span\":{\"offset\":912,\"length\":3}},{\"content\":\"לקוח:\",\"polygon\":[6.7106,5.2584,6.9898,5.2584,6.9898,5.431,6.7055,5.431],\"confidence\":0.98,\"span\":{\"offset\":916,\"length\":5}},{\"content\":\"81353075\",\"polygon\":[6.1065,5.2483,6.6751,5.2584,6.67,5.431,6.1015,5.4259],\"confidence\":0.961,\"span\":{\"offset\":922,\"length\":8}},{\"content\":\"מס.\",\"polygon\":[7.0405,5.4209,7.2791,5.4259,7.2791,5.5731,7.0405,5.5681],\"confidence\":0.982,\"span\":{\"offset\":931,\"length\":3}},{\"content\":\"חברה\",\"polygon\":[6.7461,5.4209,7.0152,5.4209,7.0152,5.5681,6.7461,5.5681],\"confidence\":0.982,\"span\":{\"offset\":935,\"length\":4}},{\"content\":\"לקוח:\",\"polygon\":[6.3705,5.4209,6.7157,5.4209,6.7157,5.5681,6.3756,5.5681],\"confidence\":0.961,\"span\":{\"offset\":940,\"length\":5}},{\"content\":\"513327064\",\"polygon\":[5.6903,5.4158,6.3451,5.4209,6.3451,5.5681,5.6954,5.5579],\"confidence\":0.966,\"span\":{\"offset\":946,\"length\":9}},{\"content\":\"סה״כ\",\"polygon\":[3.1269,5.3092,3.4264,5.3092,3.4264,5.4513,3.1269,5.4462],\"confidence\":0.977,\"span\":{\"offset\":956,\"length\":4}},{\"content\":\"מחיר\",\"polygon\":[2.8172,5.3092,3.1015,5.3092,3.1015,5.4462,2.8172,5.4462],\"confidence\":0.982,\"span\":{\"offset\":961,\"length\":4}},{\"content\":\"23,600.00\",\"polygon\":[1.5431,5.3041,2.1726,5.299,2.1776,5.4462,1.5482,5.4513],\"confidence\":0.961,\"span\":{\"offset\":966,\"length\":9}},{\"content\":\"ש״ח\",\"polygon\":[1.2792,5.3041,1.5127,5.3041,1.5178,5.4513,1.2893,5.4462],\"confidence\":0.863,\"span\":{\"offset\":976,\"length\":3}},{\"content\":\"תיק\",\"polygon\":[7.0405,5.5833,7.2791,5.5884,7.2791,5.7559,7.0405,5.7559],\"confidence\":0.982,\"span\":{\"offset\":980,\"length\":3}},{\"content\":\"מע״מ\",\"polygon\":[6.6801,5.5833,7.005,5.5833,7.005,5.7559,6.6801,5.7559],\"confidence\":0.935,\"span\":{\"offset\":984,\"length\":4}},{\"content\":\"לקוח:\",\"polygon\":[6.2284,5.5833,6.6243,5.5833,6.6243,5.7559,6.2284,5.7508],\"confidence\":0.98,\"span\":{\"offset\":989,\"length\":5}},{\"content\":\"513327064\",\"polygon\":[5.4162,5.5782,6.1928,5.5782,6.1928,5.7508,5.4162,5.7356],\"confidence\":0.961,\"span\":{\"offset\":995,\"length\":9}},{\"content\":\"יתרה\",\"polygon\":[7.0152,5.7559,7.274,5.7559,7.274,5.9031,7.0152,5.9031],\"confidence\":0.951,\"span\":{\"offset\":1005,\"length\":4}},{\"content\":\"בהנח״ש:\",\"polygon\":[6.472,5.7609,6.9695,5.7559,6.9746,5.9031,6.472,5.9031],\"confidence\":0.867,\"span\":{\"offset\":1010,\"length\":7}},{\"content\":\"47,200.00\",\"polygon\":[5.8629,5.7609,6.4416,5.7609,6.4466,5.9031,5.8629,5.9031],\"confidence\":0.937,\"span\":{\"offset\":1018,\"length\":9}},{\"content\":\"ש״ח\",\"polygon\":[5.6142,5.7609,5.8274,5.7609,5.8274,5.9031,5.6142,5.9031],\"confidence\":0.931,\"span\":{\"offset\":1028,\"length\":3}},{\"content\":\"מספר\",\"polygon\":[6.9543,5.9234,7.2791,5.9234,7.2842,6.0655,6.9593,6.0655],\"confidence\":0.982,\"span\":{\"offset\":1032,\"length\":4}},{\"content\":\"הקצאה\",\"polygon\":[6.538,5.9183,6.9289,5.9183,6.9289,6.0655,6.538,6.0655],\"confidence\":0.982,\"span\":{\"offset\":1037,\"length\":5}},{\"content\":\"::\",\"polygon\":[6.4111,5.9183,6.5076,5.9183,6.5126,6.0655,6.4162,6.0655],\"confidence\":0.833,\"span\":{\"offset\":1043,\"length\":2}},{\"content\":\"20250909144230205\",\"polygon\":[5.0761,5.9132,6.3654,5.9183,6.3705,6.0655,5.0812,6.0553],\"confidence\":0.951,\"span\":{\"offset\":1046,\"length\":17}},{\"content\":\"252091424\",\"polygon\":[6.5888,6.0756,7.274,6.0604,7.274,6.2127,6.5888,6.2025],\"confidence\":0.961,\"span\":{\"offset\":1064,\"length\":9}},{\"content\":\"בברכה,\",\"polygon\":[3.0863,6.8776,3.4924,6.8674,3.4924,6.9994,3.0863,6.9994],\"confidence\":0.98,\"span\":{\"offset\":1074,\"length\":6}},{\"content\":\"עדנה\",\"polygon\":[3.2436,7.0248,3.4873,7.0197,3.4873,7.1517,3.2436,7.1517],\"confidence\":0.982,\"span\":{\"offset\":1081,\"length\":4}},{\"content\":\"נאמן\",\"polygon\":[2.9391,7.0299,3.1929,7.0248,3.1979,7.1517,2.9441,7.1568],\"confidence\":0.982,\"span\":{\"offset\":1086,\"length\":4}},{\"content\":\"מודגל\",\"polygon\":[3.1776,7.1669,3.4974,7.1618,3.4974,7.3192,3.1827,7.3192],\"confidence\":0.969,\"span\":{\"offset\":1091,\"length\":5}},{\"content\":\"מתכת\",\"polygon\":[2.8426,7.1669,3.1472,7.1669,3.1523,7.3192,2.8477,7.3192],\"confidence\":0.981,\"span\":{\"offset\":1097,\"length\":4}},{\"content\":\"(99)\",\"polygon\":[2.5177,7.1669,2.8122,7.1669,2.8172,7.3192,2.5177,7.3192],\"confidence\":0.961,\"span\":{\"offset\":1102,\"length\":4}},{\"content\":\"בע״מ\",\"polygon\":[2.2436,7.1618,2.4873,7.1669,2.4873,7.3192,2.2436,7.3192],\"confidence\":0.922,\"span\":{\"offset\":1107,\"length\":4}},{\"content\":\"דואר:\",\"polygon\":[3.1726,7.3243,3.5025,7.3192,3.5025,7.4664,3.1726,7.4664],\"confidence\":0.967,\"span\":{\"offset\":1112,\"length\":5}},{\"content\":\"edna@modgal-metal.com\",\"polygon\":[1.6091,7.3192,3.1421,7.3243,3.1421,7.4664,1.6091,7.4765],\"confidence\":0.877,\"span\":{\"offset\":1118,\"length\":21}},{\"content\":\"טלפון:\",\"polygon\":[3.137,7.4715,3.4924,7.4715,3.4924,7.6288,3.137,7.6237],\"confidence\":0.98,\"span\":{\"offset\":1140,\"length\":6}},{\"content\":\"972-4-6914209\",\"polygon\":[2.2132,7.4715,3.1066,7.4715,3.1066,7.6237,2.2132,7.6237],\"confidence\":0.934,\"span\":{\"offset\":1147,\"length\":13}},{\"content\":\"טלפון\",\"polygon\":[3.1675,7.6288,3.4924,7.6288,3.4924,7.7811,3.1726,7.7811],\"confidence\":0.982,\"span\":{\"offset\":1161,\"length\":5}},{\"content\":\"נייד:\",\"polygon\":[2.9238,7.6288,3.1421,7.6288,3.1421,7.776,2.9238,7.776],\"confidence\":0.982,\"span\":{\"offset\":1167,\"length\":5}},{\"content\":\"050-3344662\",\"polygon\":[2.1117,7.6288,2.8934,7.6288,2.8934,7.776,2.1117,7.7658],\"confidence\":0.954,\"span\":{\"offset\":1173,\"length\":11}}],\"lines\":[{\"content\":\"מסמך ממוחשב\",\"polygon\":[0.1827,0.0761,0.5025,0.0761,0.5025,0.132,0.1827,0.132],\"spans\":[{\"offset\":0,\"length\":11}]},{\"content\":\"חתום דיגיטלית ומאושר\",\"polygon\":[0.1066,0.1421,0.5787,0.1421,0.5787,0.203,0.1066,0.198],\"spans\":[{\"offset\":12,\"length\":20}]},{\"content\":\"על ידי גורם מאשר\",\"polygon\":[0.1421,0.2132,0.533,0.2081,0.533,0.2639,0.1421,0.269],\"spans\":[{\"offset\":33,\"length\":16}]},{\"content\":\"לצורך אימות לחץ כאן!\",\"polygon\":[0.1218,0.2842,0.5787,0.2842,0.5787,0.3553,0.1218,0.3553],\"spans\":[{\"offset\":50,\"length\":20}]},{\"content\":\"comsign\",\"polygon\":[0.1472,0.4314,0.5381,0.4314,0.5381,0.5329,0.1472,0.5329],\"spans\":[{\"offset\":71,\"length\":7}]},{\"content\":\"מודגל מתכת (99) בע״מ\",\"polygon\":[4.9441,1.0862,6.4568,1.0761,6.4619,1.274,4.9492,1.2842],\"spans\":[{\"offset\":79,\"length\":20}]},{\"content\":\"www.modgalmetal.com\",\"polygon\":[1.0964,1.0151,2.8731,1.0101,2.8731,1.1928,1.0964,1.1979],\"spans\":[{\"offset\":100,\"length\":19}]},{\"content\":\"modgalmetal@modgal-metal.com ,04-6914202 .ת.ד. 63, ראש פינה 12000, טל. 04-6914222, פקס MODGA\",\"polygon\":[1.0964,1.2639,7.203,1.2639,7.203,1.4314,1.0964,1.4314],\"spans\":[{\"offset\":120,\"length\":92}]},{\"content\":\"עוסק מורשה: 512780883, מס. תיק ניכויים: 935536177, באיחוד עוסקים מספר: 558158374\",\"polygon\":[2.2487,1.7207,7.3959,1.7257,7.3959,1.8932,2.2487,1.8882],\"spans\":[{\"offset\":213,\"length\":80}]},{\"content\":\"לכבוד:\",\"polygon\":[6.934,2.2079,7.3248,2.2029,7.3299,2.3348,6.939,2.345],\"spans\":[{\"offset\":294,\"length\":6}]},{\"content\":\"תאריך חשבונית: 09/09/25\",\"polygon\":[1.1827,2.1876,2.665,2.1978,2.665,2.3551,1.1827,2.345],\"spans\":[{\"offset\":301,\"length\":23}]},{\"content\":\"ט.פ.י פל ים בע״מ\",\"polygon\":[6.34,2.3551,7.3299,2.3551,7.3299,2.5023,6.34,2.5074],\"spans\":[{\"offset\":325,\"length\":16}]},{\"content\":\"הקטיף 11 פארק תעשיות עמק חפר\",\"polygon\":[5.401,2.5074,7.3197,2.5074,7.3197,2.6698,5.401,2.6698],\"spans\":[{\"offset\":342,\"length\":28}]},{\"content\":\"תאריך הדפסה: 09/09/25\",\"polygon\":[1.2589,2.3551,2.6751,2.3551,2.6751,2.5074,1.2589,2.5023],\"spans\":[{\"offset\":371,\"length\":21}]},{\"content\":\"שעת הדפסה: 14:42\",\"polygon\":[1.533,2.5023,2.67,2.5023,2.67,2.6597,1.533,2.6546],\"spans\":[{\"offset\":393,\"length\":16}]},{\"content\":\"טלפון: 09-8304673, פקס: 09-8947635\",\"polygon\":[5.0609,2.6749,7.3299,2.68,7.3299,2.8424,5.0609,2.8373],\"spans\":[{\"offset\":410,\"length\":34}]},{\"content\":\"מספר תעודה: SI250000620\",\"polygon\":[1.0558,2.6546,2.67,2.6647,2.67,2.8119,1.0558,2.8069],\"spans\":[{\"offset\":445,\"length\":23}]},{\"content\":\"מס׳ חברה: 513327064\",\"polygon\":[5.9898,2.8424,7.3299,2.8424,7.3299,2.9947,5.9898,2.9947],\"spans\":[{\"offset\":469,\"length\":19}]},{\"content\":\"פרטים: שירותי ניהול 9/25\",\"polygon\":[1.2335,2.8119,2.67,2.817,2.67,2.9693,1.2335,2.9693],\"spans\":[{\"offset\":489,\"length\":24}]},{\"content\":\"מס׳ תיק במע״מ: 513327064\",\"polygon\":[5.6802,2.9896,7.3299,2.9997,7.3299,3.1672,5.6802,3.1571],\"spans\":[{\"offset\":514,\"length\":24}]},{\"content\":\"WINSERT:modgal:090925:C:SI250000620:account@t-p-y.co.il\",\"polygon\":[0.9289,3.1469,3.5837,3.152,3.5837,3.284,0.9289,3.2738],\"spans\":[{\"offset\":539,\"length\":55}]},{\"content\":\"חשבונית מס מרכזת SI250000620 - מקור\",\"polygon\":[2.5837,3.5073,5.6649,3.5073,5.6649,3.7002,2.5837,3.7002],\"spans\":[{\"offset\":595,\"length\":35}]},{\"content\":\"הופק באמצעות Priority - פריוריטי סופטוור בע״מ\",\"polygon\":[0.8528,1.8273,0.8579,3.8423,0.731,3.8423,0.7259,1.8273],\"spans\":[{\"offset\":631,\"length\":45}]},{\"content\":\"מק״ט\",\"polygon\":[6.8274,4.2788,7.0609,4.2788,7.0558,4.3854,6.8274,4.3854],\"spans\":[{\"offset\":677,\"length\":4}]},{\"content\":\"תאור מוצר\",\"polygon\":[4.9593,4.2687,5.5533,4.2687,5.5533,4.3956,4.9593,4.4006],\"spans\":[{\"offset\":682,\"length\":9}]},{\"content\":\"כמות\",\"polygon\":[3.4264,4.2788,3.7208,4.2788,3.7208,4.3905,3.4264,4.3905],\"spans\":[{\"offset\":692,\"length\":4}]},{\"content\":\"מחיר ליחידה\",\"polygon\":[2.2792,4.2636,2.9898,4.2636,2.9898,4.3905,2.2792,4.3905],\"spans\":[{\"offset\":697,\"length\":11}]},{\"content\":\"מחיר השורה\",\"polygon\":[1.0711,4.2636,1.7868,4.2636,1.7868,4.3956,1.0711,4.4006],\"spans\":[{\"offset\":709,\"length\":10}]},{\"content\":\"1\",\"polygon\":[7.1675,4.5072,7.2385,4.5072,7.2436,4.6341,7.1675,4.6291],\"spans\":[{\"offset\":720,\"length\":1}]},{\"content\":\"4B\",\"polygon\":[6.8781,4.5123,7.0558,4.5072,7.0609,4.6341,6.8781,4.6291],\"spans\":[{\"offset\":722,\"length\":2}]},{\"content\":\"חיוב חודשי - שירותי ניהול ואחסנה - פלים\",\"polygon\":[4.4873,4.4971,6.6649,4.5022,6.6649,4.6494,4.4873,4.6494],\"spans\":[{\"offset\":725,\"length\":39}]},{\"content\":\"1 יח׳\",\"polygon\":[3.5127,4.492,3.7715,4.4869,3.7766,4.6544,3.5127,4.6544],\"spans\":[{\"offset\":765,\"length\":5}]},{\"content\":\"20,000.0000 ש״ח\",\"polygon\":[2.2792,4.5022,3.3096,4.4971,3.3096,4.6443,2.2792,4.6494],\"spans\":[{\"offset\":771,\"length\":15}]},{\"content\":\"20,000.00\",\"polygon\":[1.2792,4.5022,1.8934,4.5022,1.8934,4.6494,1.2792,4.6443],\"spans\":[{\"offset\":787,\"length\":9}]},{\"content\":\"ברקוד מספר חשבונית : *SI250000620*\",\"polygon\":[5.137,4.7813,7.2842,4.7965,7.2842,4.9437,5.137,4.9285],\"spans\":[{\"offset\":797,\"length\":34}]},{\"content\":\"מחיר כולל\",\"polygon\":[2.8528,4.7661,3.4365,4.7661,3.4365,4.9387,2.8528,4.9387],\"spans\":[{\"offset\":832,\"length\":9}]},{\"content\":\"20,000.00\",\"polygon\":[1.5381,4.7762,2.1675,4.7712,2.1675,4.9234,1.5431,4.9234],\"spans\":[{\"offset\":842,\"length\":9}]},{\"content\":\"לתשלום עד: 31/10/25\",\"polygon\":[6.0609,4.9539,7.2842,4.9539,7.2842,5.096,6.0609,5.096],\"spans\":[{\"offset\":852,\"length\":19}]},{\"content\":\"תנאי תשלום: ש+30\",\"polygon\":[6.2284,5.1062,7.2842,5.1112,7.2842,5.2534,6.2284,5.2483],\"spans\":[{\"offset\":872,\"length\":16}]},{\"content\":\"מע״מ (18.00%)\",\"polygon\":[2.5127,5.0453,3.4365,5.0453,3.4365,5.2026,2.5127,5.2026],\"spans\":[{\"offset\":889,\"length\":13}]},{\"content\":\"3,600.00\",\"polygon\":[1.6193,5.0402,2.1624,5.0351,2.1675,5.1772,1.6193,5.1772],\"spans\":[{\"offset\":903,\"length\":8}]},{\"content\":\"מס. לקוח: 81353075\",\"polygon\":[6.1015,5.2483,7.2791,5.2483,7.2791,5.4259,6.1015,5.4209],\"spans\":[{\"offset\":912,\"length\":18}]},{\"content\":\"מס. חברה לקוח: 513327064\",\"polygon\":[5.6903,5.4158,7.2842,5.4209,7.2842,5.5681,5.6903,5.5579],\"spans\":[{\"offset\":931,\"length\":24}]},{\"content\":\"סה״כ מחיר\",\"polygon\":[2.8071,5.3041,3.4314,5.3041,3.4264,5.4462,2.8071,5.4462],\"spans\":[{\"offset\":956,\"length\":9}]},{\"content\":\"23,600.00 ש״ח\",\"polygon\":[1.2589,5.299,2.1726,5.294,2.1726,5.4462,1.2589,5.4462],\"spans\":[{\"offset\":966,\"length\":13}]},{\"content\":\"תיק מע״מ לקוח: 513327064\",\"polygon\":[5.4111,5.5782,7.2842,5.5833,7.2842,5.7559,5.4111,5.7406],\"spans\":[{\"offset\":980,\"length\":24}]},{\"content\":\"יתרה בהנח״ש: 47,200.00 ש״ח\",\"polygon\":[5.5989,5.7559,7.2791,5.7559,7.2791,5.898,5.5989,5.898],\"spans\":[{\"offset\":1005,\"length\":26}]},{\"content\":\"מספר הקצאה :: 20250909144230205\",\"polygon\":[5.0761,5.9132,7.2893,5.9183,7.2842,6.0655,5.0761,6.0553],\"spans\":[{\"offset\":1032,\"length\":31}]},{\"content\":\"252091424\",\"polygon\":[6.5837,6.0604,7.2842,6.0604,7.2842,6.2076,6.5837,6.2076],\"spans\":[{\"offset\":1064,\"length\":9}]},{\"content\":\"בברכה,\",\"polygon\":[3.0812,6.8674,3.4873,6.8624,3.4924,6.9943,3.0863,6.9994],\"spans\":[{\"offset\":1074,\"length\":6}]},{\"content\":\"עדנה נאמן\",\"polygon\":[2.9391,7.0197,3.5025,7.0146,3.5025,7.1517,2.9391,7.1568],\"spans\":[{\"offset\":1081,\"length\":9}]},{\"content\":\"מודגל מתכת (99) בע״מ\",\"polygon\":[2.2335,7.1618,3.4974,7.1618,3.4974,7.3141,2.2335,7.3141],\"spans\":[{\"offset\":1091,\"length\":20}]},{\"content\":\"דואר: edna@modgal-metal.com\",\"polygon\":[1.6091,7.3141,3.5025,7.3141,3.5025,7.4664,1.6091,7.4715],\"spans\":[{\"offset\":1112,\"length\":27}]},{\"content\":\"טלפון: 972-4-6914209\",\"polygon\":[2.203,7.4664,3.4924,7.4715,3.4924,7.6237,2.203,7.6186],\"spans\":[{\"offset\":1140,\"length\":20}]},{\"content\":\"טלפון נייד: 050-3344662\",\"polygon\":[2.0964,7.6237,3.4974,7.6237,3.4924,7.776,2.0964,7.7709],\"spans\":[{\"offset\":1161,\"length\":23}]}],\"spans\":[{\"offset\":0,\"length\":1184}]}],\"tables\":[{\"rowCount\":2,\"columnCount\":6,\"cells\":[{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":0,\"content\":\"מחיר השורה\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9617,4.2081,1.9273,4.2081,1.9273,4.4449,0.9617,4.4449]}],\"spans\":[{\"offset\":709,\"length\":10}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":1,\"content\":\"מחיר ליחידה\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.9273,4.2081,3.3591,4.2081,3.3591,4.4449,1.9273,4.4449]}],\"spans\":[{\"offset\":697,\"length\":11}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":2,\"content\":\"כמות\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.3591,4.2081,3.8058,4.2081,3.8058,4.4449,3.3591,4.4449]}],\"spans\":[{\"offset\":692,\"length\":4}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":3,\"content\":\"תאור מוצר\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.8058,4.2081,6.7417,4.2081,6.7417,4.4449,3.8058,4.4449]}],\"spans\":[{\"offset\":682,\"length\":9}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":4,\"content\":\"מק״ט\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.7417,4.2081,7.0899,4.2081,7.0899,4.4449,6.7417,4.4449]}],\"spans\":[{\"offset\":677,\"length\":4}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":5,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[7.0899,4.2081,7.3066,4.2147,7.3066,4.4449,7.0899,4.4449]}],\"spans\":[]},{\"rowIndex\":1,\"columnIndex\":0,\"content\":\"20,000.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9617,4.4449,1.9273,4.4449,1.9273,4.6949,0.9617,4.6949]}],\"spans\":[{\"offset\":787,\"length\":9}]},{\"rowIndex\":1,\"columnIndex\":1,\"content\":\"20,000.0000 ש״ח\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.9273,4.4449,3.3591,4.4449,3.3591,4.6949,1.9273,4.6949]}],\"spans\":[{\"offset\":771,\"length\":15}]},{\"rowIndex\":1,\"columnIndex\":2,\"content\":\"1 יח׳\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.3591,4.4449,3.8058,4.4449,3.8123,4.6949,3.3591,4.6949]}],\"spans\":[{\"offset\":765,\"length\":5}]},{\"rowIndex\":1,\"columnIndex\":3,\"content\":\"חיוב חודשי - שירותי ניהול ואחסנה - פלים\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.8058,4.4449,6.7417,4.4449,6.7483,4.6949,3.8123,4.6949]}],\"spans\":[{\"offset\":725,\"length\":39}]},{\"rowIndex\":1,\"columnIndex\":4,\"content\":\"4B\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.7417,4.4449,7.0899,4.4449,7.0899,4.6949,6.7483,4.6949]}],\"spans\":[{\"offset\":722,\"length\":2}]},{\"rowIndex\":1,\"columnIndex\":5,\"content\":\"1\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[7.0899,4.4449,7.3066,4.4449,7.3066,4.6949,7.0899,4.6949]}],\"spans\":[{\"offset\":720,\"length\":1}]}],\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9225,4.2021,7.3214,4.1982,7.321,4.6953,0.9218,4.6995]}],\"spans\":[{\"offset\":709,\"length\":10},{\"offset\":697,\"length\":11},{\"offset\":692,\"length\":4},{\"offset\":682,\"length\":9},{\"offset\":677,\"length\":4},{\"offset\":787,\"length\":9},{\"offset\":771,\"length\":15},{\"offset\":765,\"length\":5},{\"offset\":725,\"length\":39},{\"offset\":722,\"length\":2},{\"offset\":720,\"length\":1}]},{\"rowCount\":3,\"columnCount\":2,\"cells\":[{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":0,\"content\":\"20,000.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9442,4.7204,2.2132,4.7204,2.2132,4.964,0.9442,4.964]}],\"spans\":[{\"offset\":842,\"length\":9}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":1,\"content\":\"מחיר כולל\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.2132,4.7204,3.4721,4.7204,3.4721,4.964,2.2132,4.964]}],\"spans\":[{\"offset\":832,\"length\":9}]},{\"rowIndex\":1,\"columnIndex\":0,\"content\":\"3,600.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9442,4.964,2.2132,4.964,2.2132,5.2432,0.9442,5.2432]}],\"spans\":[{\"offset\":903,\"length\":8}]},{\"rowIndex\":1,\"columnIndex\":1,\"content\":\"מע״מ (18.00%)\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.2132,4.964,3.4721,4.964,3.4721,5.2432,2.2132,5.2432]}],\"spans\":[{\"offset\":889,\"length\":13}]},{\"rowIndex\":2,\"columnIndex\":0,\"content\":\"23,600.00 ש״ח\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9442,5.2432,2.2132,5.2432,2.2132,5.4919,0.9391,5.4919]}],\"spans\":[{\"offset\":966,\"length\":13}]},{\"rowIndex\":2,\"columnIndex\":1,\"content\":\"סה״כ מחיר\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.2132,5.2432,3.4721,5.2432,3.4721,5.4919,2.2132,5.4919]}],\"spans\":[{\"offset\":956,\"length\":9}]}],\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9393,4.7102,3.4722,4.7118,3.4706,5.4966,0.9375,5.4955]}],\"spans\":[{\"offset\":842,\"length\":9},{\"offset\":832,\"length\":9},{\"offset\":903,\"length\":8},{\"offset\":889,\"length\":13},{\"offset\":966,\"length\":13},{\"offset\":956,\"length\":9}]}],\"styles\":[],\"documents\":[{\"docType\":\"invoice\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0,0,8.2639,0,8.2639,11.6944,0,11.6944]}],\"fields\":{\"CustomerAddress\":{\"type\":\"address\",\"content\":\"הקטיף 11 פארק תעשיות עמק חפר\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[5.406,2.5125,7.3248,2.5125,7.3248,2.6749,5.406,2.6749]}],\"confidence\":0.892,\"spans\":[{\"offset\":342,\"length\":28}],\"valueAddress\":{\"houseNumber\":\"11\",\"road\":\"הקטיף\",\"streetAddress\":\"11 הקטיף\",\"house\":\"פארק תעשיות עמק חפר\"}},\"CustomerAddressRecipient\":{\"type\":\"string\",\"valueString\":\"ט.פ.י פל ים בע״מ\",\"content\":\"ט.פ.י פל ים בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.3705,2.3602,7.3248,2.3602,7.3248,2.5125,6.3705,2.5125]}],\"confidence\":0.892,\"spans\":[{\"offset\":325,\"length\":16}]},\"CustomerName\":{\"type\":\"string\",\"valueString\":\"ט.פ.י פל ים בע״מ\",\"content\":\"ט.פ.י פל ים בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.3705,2.3602,7.3248,2.3602,7.3248,2.5125,6.3705,2.5125]}],\"confidence\":0.892,\"spans\":[{\"offset\":325,\"length\":16}]},\"CustomerTaxId\":{\"type\":\"string\",\"valueString\":\"513327064\",\"content\":\"513327064\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[5.9898,2.8475,6.6598,2.8475,6.6598,2.9997,5.9949,2.9997]}],\"confidence\":0.822,\"spans\":[{\"offset\":479,\"length\":9}]},\"DueDate\":{\"type\":\"date\",\"valueDate\":\"2025-10-31\",\"content\":\"31/10/25\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.0659,4.959,6.5786,4.959,6.5837,5.096,6.071,5.1011]}],\"confidence\":0.94,\"spans\":[{\"offset\":863,\"length\":8}]},\"InvoiceDate\":{\"type\":\"date\",\"valueDate\":\"2025-09-09\",\"content\":\"09/09/25\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.1827,2.1927,1.6954,2.1978,1.6954,2.3501,1.1878,2.345]}],\"confidence\":0.968,\"spans\":[{\"offset\":316,\"length\":8}]},\"InvoiceId\":{\"type\":\"string\",\"valueString\":\"SI250000620\",\"content\":\"SI250000620\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.1218,3.5124,4.2081,3.5073,4.2132,3.7002,3.1218,3.7053]}],\"confidence\":0.967,\"spans\":[{\"offset\":612,\"length\":11}]},\"InvoiceTotal\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":23600,\"currencyCode\":\"ILS\"},\"content\":\"23,600.00 ש״ח\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.2794,5.2891,2.1792,5.2991,2.1775,5.4586,1.2776,5.4486]}],\"confidence\":0.944,\"spans\":[{\"offset\":966,\"length\":13}]},\"Items\":{\"type\":\"array\",\"valueArray\":[{\"type\":\"object\",\"valueObject\":{\"Amount\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":20000,\"currencyCode\":\"ILS\"},\"content\":\"20,000.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.2792,4.5072,1.8934,4.5072,1.8934,4.6494,1.2843,4.6443]}],\"confidence\":0.919,\"spans\":[{\"offset\":787,\"length\":9}]},\"Description\":{\"type\":\"string\",\"valueString\":\"חיוב חודשי - שירותי ניהול ואחסנה - פלים\",\"content\":\"חיוב חודשי - שירותי ניהול ואחסנה - פלים\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[4.5025,4.5022,6.6598,4.5022,6.6598,4.6544,4.5025,4.6544]}],\"confidence\":0.907,\"spans\":[{\"offset\":725,\"length\":39}]},\"ProductCode\":{\"type\":\"string\",\"valueString\":\"4B\",\"content\":\"4B\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.8781,4.5072,7.0507,4.5072,7.0507,4.6341,6.8781,4.6341]}],\"confidence\":0.595,\"spans\":[{\"offset\":722,\"length\":2}]},\"Quantity\":{\"type\":\"number\",\"valueNumber\":1,\"content\":\"1\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.6649,4.4869,3.7665,4.4869,3.7715,4.6544,3.67,4.6544]}],\"confidence\":0.917,\"spans\":[{\"offset\":765,\"length\":1}]},\"Unit\":{\"type\":\"string\",\"valueString\":\"יח׳\",\"content\":\"יח׳\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.5127,4.4869,3.6345,4.4869,3.6345,4.6544,3.5127,4.6544]}],\"confidence\":0.39,\"spans\":[{\"offset\":767,\"length\":3}]},\"UnitPrice\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":20000,\"currencyCode\":\"ILS\"},\"content\":\"20,000.0000 ש״ח\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.2893,4.5022,3.3096,4.5022,3.3096,4.6544,2.2893,4.6544]}],\"confidence\":0.922,\"spans\":[{\"offset\":771,\"length\":15}]}},\"content\":\"1\\n4B\\nחיוב חודשי - שירותי ניהול ואחסנה - פלים\\n1 יח׳\\n20,000.0000 ש״ח\\n20,000.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.2792,4.4869,7.2436,4.4869,7.2436,4.6544,1.2792,4.6544]}],\"confidence\":0.935,\"spans\":[{\"offset\":720,\"length\":76}]}]},\"PaymentTerm\":{\"type\":\"string\",\"valueString\":\"ש+30\",\"content\":\"ש+30\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.2284,5.1112,6.538,5.1163,6.538,5.2483,6.2334,5.2534]}],\"confidence\":0.82,\"spans\":[{\"offset\":884,\"length\":4}]},\"SubTotal\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":20000,\"currencyCode\":\"ILS\"},\"content\":\"20,000.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.5431,4.7813,2.1675,4.7762,2.1675,4.9285,1.5482,4.9285]}],\"confidence\":0.968,\"spans\":[{\"offset\":842,\"length\":9}]},\"TotalTax\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":3600,\"currencyCode\":\"ILS\"},\"content\":\"3,600.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.6294,5.0402,2.1675,5.0402,2.1675,5.1823,1.6345,5.1823]}],\"confidence\":0.968,\"spans\":[{\"offset\":903,\"length\":8}]},\"VendorAddress\":{\"type\":\"address\",\"content\":\"ראש פינה 12000,\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[5.0507,1.2689,5.9492,1.2689,5.9492,1.4364,5.0507,1.4364]}],\"confidence\":0.651,\"spans\":[{\"offset\":171,\"length\":15}],\"valueAddress\":{\"postalCode\":\"12000\",\"city\":\"ראש פינה\",\"streetAddress\":\"\"}},\"VendorAddressRecipient\":{\"type\":\"string\",\"valueString\":\"מודגל מתכת (99) בע״מ\",\"content\":\"מודגל מתכת (99) בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[4.9592,1.0885,6.4517,1.0781,6.4531,1.2815,4.9606,1.2918]}],\"confidence\":0.893,\"spans\":[{\"offset\":79,\"length\":20}]},\"VendorName\":{\"type\":\"string\",\"valueString\":\"מודגל מתכת (99) בע״מ\",\"content\":\"מודגל מתכת (99) בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.2436,7.1618,3.4974,7.1618,3.4974,7.3192,2.2436,7.3192]}],\"confidence\":0.364,\"spans\":[{\"offset\":1091,\"length\":20}]},\"VendorTaxId\":{\"type\":\"string\",\"valueString\":\"512780883,\",\"content\":\"512780883,\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[5.8629,1.7257,6.604,1.7257,6.604,1.8932,5.8629,1.8932]}],\"confidence\":0.589,\"spans\":[{\"offset\":225,\"length\":10}]}},\"confidence\":1,\"spans\":[{\"offset\":0,\"length\":1184}]}]}}"
            }
        ],
        "language": "javascript",
        "inputFormat": "editor",
        "dependencies": [],
        "codeEditorJavascript": "// ============================================================================\n// קוד 2 - עיבוד חשבוניות (גרסה 4.2 - תיקון מחיר)\n// מקבל: OCR + הגדרות + תעודות + יבוא\n// מחזיר: JSON לפריוריטי + דוח ביצוע\n//\n// ✨ חדש בגרסה 4.2:\n// - תיקון חישוב מחיר: InvoiceTotal - TotalTax = סה\"כ לפני מע\"מ (עבודות + חלקים)\n//\n// ✨ חדש בגרסה 4.1:\n// - פונקציית cleanInvoiceForPriority() - מנקה שדות למידה לפני שליחה\n// - זיהוי רכבים משופר - מונע זיהוי כרטיס כרכב\n//\n// ✨ חדש בגרסה 4.0:\n// - חילוץ רכבים מתקדם לפי vehicle_processing_rules.search_locations\n// - תמיכה ב-VehicleNumbers (שדה חדש מ-Azure v3.0)\n// - תמיכה ב-Items[].VehicleNumber (קישור ישיר)\n// - יצירת פריטי רכבים אוטומטית\n// - מיפוי לחשבונות לפי vehicle_account_mapping\n//\n// ✨ מגרסה 3.0:\n// - תמיכה במבנה החדש של UnidentifiedNumbers (מערך אובייקטים)\n// - ניצול התוויות (label) וההקשר (context) לזיהוי חכם יותר\n// ============================================================================\n\n// ============================================================================\n// פונקציית עזר - ניקוי invoice לפני שליחה ל-Priority\n// ============================================================================\n\nfunction cleanInvoiceForPriority(invoice) {\n    // יצירת עותק עמוק כדי לא לשנות את המקור\n    const cleaned = JSON.parse(JSON.stringify(invoice));\n\n    // ניקוי שדות שלא צריכים מהפריטים\n    if (cleaned.PINVOICEITEMS_SUBFORM) {\n        cleaned.PINVOICEITEMS_SUBFORM = cleaned.PINVOICEITEMS_SUBFORM.map(item => {\n            // מחיקת שדות למידה\n            delete item.isNewVehicle;\n            delete item._learningNote;\n\n            // מחיקת SPECIALVATFLAG אם זה לא \"Y\"\n            if (item.SPECIALVATFLAG && item.SPECIALVATFLAG !== \"Y\") {\n                delete item.SPECIALVATFLAG;\n            }\n\n            return item;\n        });\n    }\n\n    return cleaned;\n}\n\n// ============================================================================\n// פונקציה ראשית\n// ============================================================================\n\nfunction processInvoiceComplete(input) {\n    const executionReport = {\n        stage: \"\",\n        found: [],\n        not_found: [],\n        warnings: [],\n        errors: []\n    };\n\n    try {\n        // ============================================================================\n        // שלב 1: זיהוי סוג חשבונית ותבנית\n        // ============================================================================\n\n        executionReport.stage = \"שלב 1: זיהוי סוג ותבנית\";\n\n        // א. בדיקת יבוא\n        const hasImport = checkImportExists(input.import_files);\n\n        // ב. בדיקת תעודות - ב-OCR או ב-docs_list!\n        const hasDocsInOCR = checkDocsInOCR(\n            input.AZURE_RESULT.data.fields,\n            input.AZURE_TEXT\n        );\n        const hasDocsInList = checkDocsExist(input.docs_list);\n        const hasDocs = hasDocsInOCR || hasDocsInList;\n\n        // ג. זיהוי חיוב/זיכוי\n        const debitType = identifyDebitType(input.AZURE_RESULT.data.fields);\n\n        executionReport.found.push(`סוג: יבוא=${hasImport}, תעודות=${hasDocs}, חיוב/זיכוי=${debitType}`);\n\n        // ד. חיפוש תבנית מתאימה\n        const config = input.learned_config.config;\n        const templateIndex = findMatchingTemplate(config.structure, hasImport, hasDocs, debitType);\n\n        if (templateIndex === -1) {\n            executionReport.errors.push(\"לא נמצאה תבנית מתאימה!\");\n            throw new Error(\"לא נמצאה תבנית מתאימה\");\n        }\n\n        const structure = config.structure[templateIndex];\n        const template = input.learned_config.template.PINVOICES[templateIndex];\n\n        executionReport.found.push(`תבנית: index=${templateIndex}`);\n\n        // ============================================================================\n        // שלב 2: הכנה - הבנת דפוסים\n        // ============================================================================\n\n        executionReport.stage = \"שלב 2: הבנת דפוסים\";\n\n        const patterns = extractPatterns(\n            input.learned_config.recommended_samples,\n            input.docs_list\n        );\n\n        executionReport.found.push(`דפוסים: BOOKNUM=${JSON.stringify(patterns.booknum_pattern)}, תעודות=${JSON.stringify(patterns.docs_pattern)}`);\n\n        // ✨ חדש! קריאת חוקי רכבים\n        const vehicleRules = config.rules?.critical_patterns?.vehicle_rules || null;\n        if (vehicleRules && vehicleRules.enabled) {\n            executionReport.found.push(`חוקי רכבים: פעילים (${Object.keys(vehicleRules.vehicle_account_mapping || {}).length} רכבים ממופים)`);\n        }\n\n        // ============================================================================\n        // שלב 3: חיפוש וזיהוי נתונים\n        // ============================================================================\n\n        executionReport.stage = \"שלב 3: חיפוש נתונים\";\n\n        const ocrFields = input.AZURE_RESULT.data.fields;\n        const searchResults = searchAllData(\n            ocrFields,\n            input.AZURE_TEXT,\n            patterns,\n            structure,\n            input.import_files,\n            input.docs_list,\n            vehicleRules  // ✨ חדש!\n        );\n\n        // תיעוד מה נמצא\n        Object.keys(searchResults).forEach(key => {\n            if (key === 'documents' && searchResults.documents) {\n                if (searchResults.documents.length > 0) {\n                    const docsInfo = searchResults.documents.map(d =>\n                        `${d.BOOKNUM} (DOCNO: ${d.DOCNO || 'ריק'})`\n                    ).join(', ');\n                    executionReport.found.push(`תעודות: ${searchResults.documents.length} - ${docsInfo}`);\n                } else {\n                    executionReport.not_found.push('תעודות');\n                }\n            } else if (key === 'vehicles' && searchResults.vehicles) {\n                if (searchResults.vehicles.length > 0) {\n                    executionReport.found.push(`רכבים: ${searchResults.vehicles.length} - ${searchResults.vehicles.join(', ')}`);\n                } else {\n                    executionReport.not_found.push('רכבים');\n                }\n            } else if (searchResults[key]) {\n                executionReport.found.push(`${key}: ${JSON.stringify(searchResults[key]).substring(0, 50)}`);\n            } else {\n                executionReport.not_found.push(key);\n            }\n        });\n\n        // ✨ חדש! טיפול בשגיאות לתעודות חסרות\n        if (structure.has_doc) {\n            const foundDocsCount = searchResults.documents ? searchResults.documents.length : 0;\n            const ocrUnidentified = ocrFields.UnidentifiedNumbers || [];\n\n            // ספור כמה BOOKNUM נמצאו ב-OCR\n            const booknumPattern = /^108\\d{6}$/;\n            let expectedDocsCount = 0;\n\n            if (typeof ocrUnidentified[0] === 'object' && ocrUnidentified[0].value) {\n                expectedDocsCount = ocrUnidentified.filter(item =>\n                    booknumPattern.test(item.value)\n                ).length;\n            } else {\n                expectedDocsCount = ocrUnidentified.filter(num =>\n                    booknumPattern.test(num)\n                ).length;\n            }\n\n            // טיפול בשגיאות\n            if (foundDocsCount === 0) {\n                // אף תעודה לא נמצאה\n                if (expectedDocsCount > 0) {\n                    executionReport.errors.push(\n                        `תבנית דורשת תעודות. נמצאו ${expectedDocsCount} BOOKNUM ב-OCR אך לא נמצאה התאמה ב-docs_list`\n                    );\n                } else {\n                    executionReport.errors.push(\n                        'תבנית דורשת תעודות אך לא נמצאו BOOKNUM ב-OCR'\n                    );\n                }\n            } else if (expectedDocsCount > 0 && foundDocsCount < expectedDocsCount) {\n                // נמצאו תעודות חלקיות\n                executionReport.warnings.push(\n                    `נמצאו רק ${foundDocsCount} מתוך ${expectedDocsCount} תעודות מה-OCR. חסרות ${expectedDocsCount - foundDocsCount} תעודות`\n                );\n            }\n        }\n\n        // ============================================================================\n        // שלב 4: בניית JSON\n        // ============================================================================\n\n        executionReport.stage = \"שלב 4: בניית חשבונית\";\n\n        const invoice = buildInvoiceFromTemplate(\n            template,\n            structure,\n            config,\n            searchResults,\n            input.learned_config,\n            ocrFields,  // ✨ חדש! מעביר גם את ocrFields\n            input.docs_list  // ✨ חדש! מעביר גם את docs_list\n        );\n\n        // ============================================================================\n        // שלב 5: בקרות\n        // ============================================================================\n\n        executionReport.stage = \"שלב 5: בקרות\";\n\n        const validation = performValidation(\n            invoice,\n            ocrFields,\n            config,\n            input.docs_list,\n            patterns\n        );\n\n        // ============================================================================\n        // שלב 6: ניתוח למידה\n        // ============================================================================\n\n        executionReport.stage = \"שלב 6: ניתוח למידה\";\n\n        const learningAnalysis = analyzeLearning(invoice, config);\n\n        // ============================================================================\n        // שלב 7: ניקוי והחזרת תוצאה\n        // ============================================================================\n\n        // ניקוי שדות שלא צריכים (למידה בלבד, לא ל-Priority)\n        const cleanedInvoice = cleanInvoiceForPriority(invoice);\n\n        // ============================================================================\n        // שלב 8: יצירת 2 פלטים נוספים\n        // ============================================================================\n\n        // פלט 1: הנחיות ל-LLM (פרומפט בשפה טבעית)\n        const llmPrompt = generateLLMPrompt(config, ocrFields, searchResults, executionReport);\n\n        // פלט 2: קונפיג טכני למערכת\n        const technicalConfig = generateTechnicalConfig(config, ocrFields, searchResults, executionReport);\n\n        // פלט 3: סצנריו עיבוד - מה MAKE צריך לשלוף מהמערכת\n        const hasVehicles = vehicleRules &&\n                           vehicleRules.vehicle_account_mapping &&\n                           Object.keys(vehicleRules.vehicle_account_mapping).length > 0;\n\n        const processingScenario = {\n            check_docs: structure.has_doc || false,\n            check_import: structure.has_import || false,\n            check_vehicles: hasVehicles || false\n        };\n\n        return {\n            status: \"success\",\n\n            // 1. JSON לפריוריטי (הפלט העיקרי)\n            invoice_data: {\n                PINVOICES: [cleanedInvoice]\n            },\n\n            // 2. הנחיות ל-LLM (פרומפט בשפה טבעית)\n            llm_prompt: llmPrompt,\n\n            // 3. קונפיג טכני למערכת\n            technical_config: technicalConfig,\n\n            // 4. סצנריו עיבוד - מה צריך לשלוף מהמערכת\n            processing_scenario: processingScenario\n        };\n\n    } catch (error) {\n        return {\n            status: \"error\",\n            error_type: error.name || \"ProcessingError\",\n            message: error.message\n        };\n    }\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 1\n// ============================================================================\n\nfunction checkImportExists(importFiles) {\n    if (!importFiles || !importFiles.IMPFILES) return false;\n    if (importFiles.IMPFILES.length === 0) return false;\n\n    try {\n        const parsed = JSON.parse('[' + importFiles.IMPFILES[0] + ']');\n        return parsed.length > 0 && !!parsed[0].IMPFNUM;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction checkDocsExist(docsList) {\n    if (!docsList || docsList.DOC_YES_NO !== \"Y\") return false;\n    return docsList.list_of_docs && docsList.list_of_docs.length > 0;\n}\n\nfunction checkDocsInOCR(ocrFields, azureText) {\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n    const docPattern = /^25\\d{6}$/;          // DOCNO pattern\n    const booknumPattern = /^108\\d{6}$/;     // BOOKNUM pattern\n\n    let foundInUnidentified = false;\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            foundInUnidentified = unidentified.some(item =>\n                docPattern.test(item.value) || booknumPattern.test(item.value)\n            );\n        } else {\n            foundInUnidentified = unidentified.some(num =>\n                docPattern.test(num) || booknumPattern.test(num)\n            );\n        }\n    }\n\n    if (foundInUnidentified) return true;\n\n    if (azureText) {\n        // Search for both DOCNO and BOOKNUM patterns\n        const docMatches = azureText.match(/25\\d{6}/g);\n        const booknumMatches = azureText.match(/108\\d{6}/g);\n        if ((docMatches && docMatches.length > 0) || (booknumMatches && booknumMatches.length > 0)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction identifyDebitType(ocrFields) {\n    const total = ocrFields.InvoiceTotal || ocrFields.InvoiceTotal_amount || 0;\n    return total >= 0 ? \"D\" : \"C\";\n}\n\nfunction findMatchingTemplate(structures, hasImport, hasDocs, debitType) {\n    return structures.findIndex(s =>\n        s.has_import === hasImport &&\n        s.has_doc === hasDocs &&\n        s.debit_type === debitType\n    );\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 2\n// ============================================================================\n\nfunction extractPatterns(recommendedSamples, docsList) {\n    const patterns = {\n        booknum_pattern: null,\n        ivnum_pattern: null,\n        docs_pattern: null,\n        docs_totquant: {}\n    };\n\n    if (recommendedSamples && recommendedSamples.samples && recommendedSamples.samples.length > 0) {\n        const sample = recommendedSamples.samples[0];\n\n        if (sample.sample_booknum) {\n            patterns.booknum_pattern = {\n                length: sample.sample_booknum.length,\n                example: sample.sample_booknum\n            };\n        }\n\n        if (sample.sample_ivnum) {\n            patterns.ivnum_pattern = {\n                length: sample.sample_ivnum.length,\n                example: sample.sample_ivnum\n            };\n        }\n    }\n\n    if (docsList && docsList.list_of_docs && docsList.list_of_docs.length > 0) {\n        try {\n            const docs = docsList.list_of_docs.map(d => JSON.parse(d));\n\n            if (docs.length > 0) {\n                const firstDoc = docs[0];\n                patterns.docs_pattern = {\n                    booknum_example: firstDoc.BOOKNUM,\n                    docno_example: firstDoc.DOCNO\n                };\n\n                docs.forEach(doc => {\n                    if (doc.TOTQUANT) {\n                        patterns.docs_totquant[doc.BOOKNUM] = doc.TOTQUANT;\n                    }\n                });\n            }\n        } catch (e) {\n            // שגיאה בפרסור\n        }\n    }\n\n    return patterns;\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 3\n// ============================================================================\n\nfunction searchAllData(ocrFields, azureText, patterns, structure, importFiles, docsList, vehicleRules) {\n    return {\n        booknum: searchBooknum(ocrFields, patterns),\n        ivdate: searchIvdate(ocrFields),\n        details: searchDetails(ocrFields, azureText),\n        ordname: structure.has_purchase_orders || structure.has_import ? searchOrdname(ocrFields) : null,\n        impfnum: structure.has_import ? searchImpfnum(ocrFields, importFiles) : null,\n        documents: structure.has_doc ? searchDocuments(ocrFields, azureText, patterns, docsList) : null,\n        vehicles: vehicleRules ? extractVehiclesAdvanced(ocrFields, vehicleRules) : [],  // ✨ חדש!\n        items: ocrFields.Items || []\n    };\n}\n\nfunction searchBooknum(ocrFields, patterns) {\n    let booknum = ocrFields.InvoiceId || \"\";\n\n    booknum = String(booknum).replace(/^SI/i, '');\n\n    if (patterns.booknum_pattern) {\n        const expectedLength = patterns.booknum_pattern.length;\n        if (booknum.length > expectedLength) {\n            booknum = booknum.slice(-expectedLength);\n        }\n    }\n\n    return booknum;\n}\n\nfunction searchIvdate(ocrFields) {\n    const isoDate = ocrFields.InvoiceDate;\n    if (!isoDate) return \"\";\n\n    const date = new Date(isoDate);\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = String(date.getFullYear()).slice(-2);\n\n    return `${day}/${month}/${year}`;\n}\n\nfunction searchDetails(ocrFields, azureText) {\n    if (ocrFields.InvoiceDescription) {\n        return ocrFields.InvoiceDescription;\n    }\n\n    if (azureText) {\n        const lines = azureText.split('\\n').filter(l => l.trim());\n        if (lines.length > 2) {\n            return lines[2].substring(0, 100);\n        }\n    }\n\n    return \"\";\n}\n\nfunction searchOrdname(ocrFields) {\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n    const ordPattern = /^\\d{10}$/;\n    let found = \"\";\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            const orderItem = unidentified.find(item =>\n                item.label && (\n                    item.label.includes('הזמנה') ||\n                    item.label.toLowerCase().includes('order') ||\n                    item.label.toLowerCase().includes('po')\n                ) && ordPattern.test(item.value)\n            );\n\n            if (orderItem) {\n                found = orderItem.value;\n            } else {\n                const anyOrder = unidentified.find(item =>\n                    ordPattern.test(item.value)\n                );\n                found = anyOrder ? anyOrder.value : \"\";\n            }\n        } else {\n            const match = unidentified.find(num => ordPattern.test(num));\n            found = match || \"\";\n        }\n    }\n\n    return found;\n}\n\nfunction searchImpfnum(ocrFields, importFiles) {\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n    const impPattern = /^\\d{2}c\\d{5}$/;\n    let foundInOCR = \"\";\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            const importItem = unidentified.find(item =>\n                item.label && (\n                    item.label.includes('יבוא') ||\n                    item.label.toLowerCase().includes('import') ||\n                    item.label.includes('IMPFNUM')\n                ) && impPattern.test(item.value)\n            );\n\n            if (importItem) {\n                foundInOCR = importItem.value;\n            } else {\n                const anyImport = unidentified.find(item =>\n                    impPattern.test(item.value)\n                );\n                foundInOCR = anyImport ? anyImport.value : \"\";\n            }\n        } else {\n            const match = unidentified.find(num => impPattern.test(num));\n            foundInOCR = match || \"\";\n        }\n    }\n\n    if (foundInOCR) return foundInOCR;\n\n    if (importFiles && importFiles.IMPFILES && importFiles.IMPFILES.length > 0) {\n        try {\n            const parsed = JSON.parse('[' + importFiles.IMPFILES[0] + ']');\n            if (parsed.length > 0 && parsed[0].IMPFNUM) {\n                return parsed[0].IMPFNUM;\n            }\n        } catch (e) {\n            // ממשיכים בלי\n        }\n    }\n\n    return \"\";\n}\n\nfunction searchDocuments(ocrFields, azureText, patterns, docsList) {\n    const foundDocs = [];\n\n    if (!docsList || !docsList.list_of_docs || docsList.list_of_docs.length === 0) {\n        return foundDocs;\n    }\n\n    let availableDocs = [];\n    try {\n        // תיקון: flatMap כדי לשטח מערכים מקוננים\n        availableDocs = docsList.list_of_docs.flatMap(d => JSON.parse(d));\n    } catch (e) {\n        return foundDocs;\n    }\n\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            for (const item of unidentified) {\n                const match = availableDocs.find(doc => doc.BOOKNUM === item.value);\n\n                if (match) {\n                    foundDocs.push({\n                        DOCNO: match.DOCNO,\n                        BOOKNUM: match.BOOKNUM,\n                        TOTQUANT: match.TOTQUANT || null\n                    });\n                }\n            }\n        } else {\n            for (const num of unidentified) {\n                const match = availableDocs.find(doc => doc.BOOKNUM === num);\n\n                if (match) {\n                    foundDocs.push({\n                        DOCNO: match.DOCNO,\n                        BOOKNUM: match.BOOKNUM,\n                        TOTQUANT: match.TOTQUANT || null\n                    });\n                }\n            }\n        }\n    }\n\n    // Fallback: אם לא נמצא ב-UnidentifiedNumbers, חפש ב-AZURE_TEXT\n    if (foundDocs.length === 0 && azureText) {\n        for (const doc of availableDocs) {\n            // שיפור: חיפוש עם regex במקום includes (מדויק יותר)\n            // תבנית: גבול מילה + BOOKNUM + גבול מילה (כדי למנוע התאמה חלקית)\n            const pattern = new RegExp('\\\\b' + doc.BOOKNUM + '\\\\b');\n            if (pattern.test(azureText)) {\n                foundDocs.push({\n                    DOCNO: doc.DOCNO,\n                    BOOKNUM: doc.BOOKNUM,\n                    TOTQUANT: doc.TOTQUANT || null\n                });\n            }\n        }\n    }\n\n    // ✨ חדש! Fallback 2: התאמה לפי כמויות כשהOCR לא מצא תעודות\n    if (foundDocs.length === 0 && ocrFields.Items && ocrFields.Items.length > 0) {\n        const totalOcrQuantity = ocrFields.Items.reduce((sum, item) => sum + (item.Quantity || 0), 0);\n\n        if (totalOcrQuantity > 0) {\n            // פונקציית עזר להשוואת כמויות עם סובלנות\n            const isQuantityMatch = (qty1, qty2) => {\n                if (qty1 === qty2) return true;\n                const tolerance = Math.min(Math.abs(qty1 * 0.005), 10);\n                return Math.abs(qty1 - qty2) <= tolerance;\n            };\n\n            // נסה למצוא תעודה בודדת שמתאימה (עם סובלנות)\n            const singleMatch = availableDocs.find(doc => isQuantityMatch(doc.TOTQUANT, totalOcrQuantity));\n            if (singleMatch) {\n                foundDocs.push({\n                    DOCNO: singleMatch.DOCNO,\n                    BOOKNUM: singleMatch.BOOKNUM,\n                    TOTQUANT: singleMatch.TOTQUANT || null\n                });\n            }\n            // אם לא נמצא תעודה בודדת, נסה לחפש קומבינציה של מספר תעודות\n            else {\n                const matchedDocs = findDocCombinationByQuantity(totalOcrQuantity, availableDocs);\n                if (matchedDocs.length > 0) {\n                    foundDocs.push(...matchedDocs);\n                }\n            }\n        }\n    }\n\n    return foundDocs;\n}\n\n// ============================================================================\n// ✨ חדש! פונקציה למציאת קומבינציה של תעודות לפי כמות\n// ============================================================================\n\nfunction findDocCombinationByQuantity(targetQuantity, availableDocs) {\n    // אם אין תעודות או כמות יעד לא תקינה\n    if (!availableDocs || availableDocs.length === 0 || targetQuantity <= 0) {\n        return [];\n    }\n\n    // פונקציית עזר להשוואת כמויות עם סובלנות קטנה\n    const isQuantityMatch = (qty1, qty2) => {\n        // התאמה מדויקת\n        if (qty1 === qty2) return true;\n\n        // סובלנות של 0.5% או 10 יחידות (הקטן מביניהם)\n        const tolerance = Math.min(Math.abs(qty1 * 0.005), 10);\n        return Math.abs(qty1 - qty2) <= tolerance;\n    };\n\n    // נסה כל קומבינציה אפשרית (עד 4 תעודות מקסימום)\n    const maxCombinationSize = Math.min(4, availableDocs.length);\n\n    for (let size = 2; size <= maxCombinationSize; size++) {\n        const combinations = getCombinations(availableDocs, size);\n\n        for (const combo of combinations) {\n            const comboTotal = combo.reduce((sum, doc) => sum + (doc.TOTQUANT || 0), 0);\n\n            if (isQuantityMatch(comboTotal, targetQuantity)) {\n                // נמצאה קומבינציה מתאימה!\n                return combo.map(doc => ({\n                    DOCNO: doc.DOCNO,\n                    BOOKNUM: doc.BOOKNUM,\n                    TOTQUANT: doc.TOTQUANT || null\n                }));\n            }\n        }\n    }\n\n    return [];\n}\n\n// פונקציית עזר לחישוב קומבינציות\nfunction getCombinations(array, size) {\n    if (size === 1) {\n        return array.map(item => [item]);\n    }\n\n    const combinations = [];\n\n    for (let i = 0; i < array.length - size + 1; i++) {\n        const head = array[i];\n        const tailCombos = getCombinations(array.slice(i + 1), size - 1);\n\n        for (const combo of tailCombos) {\n            combinations.push([head, ...combo]);\n        }\n    }\n\n    return combinations;\n}\n\n// ============================================================================\n// ✨ חדש! פונקציות חילוץ רכבים מתקדם\n// ============================================================================\n\nfunction extractVehiclesAdvanced(ocrFields, vehicleRules) {\n    // תיקון: בדוק אם יש vehicle_account_mapping במקום enabled\n    if (!vehicleRules || !vehicleRules.vehicle_account_mapping) return [];\n\n    const foundVehicles = [];\n    // תיקון: אם אין search_locations, השתמש בברירת מחדל\n    const searchLocations = vehicleRules.search_locations || [\n        {\n            location: \"fields.UnidentifiedNumbers\",\n            priority: 1,\n            filter_by_label: \"רכב\",\n            description: \"חיפוש רכבים ב-UnidentifiedNumbers עם תווית רכב\"\n        }\n    ];\n\n    // סדר לפי עדיפות\n    const sortedLocations = [...searchLocations].sort((a, b) => a.priority - b.priority);\n\n    for (const location of sortedLocations) {\n        if (location.location === \"fields.VehicleNumbers\") {\n            // 1. רשימה מוכנה מאז'ור\n            if (ocrFields.VehicleNumbers && Array.isArray(ocrFields.VehicleNumbers)) {\n                ocrFields.VehicleNumbers.forEach(vNum => {\n                    if (!foundVehicles.includes(vNum)) {\n                        foundVehicles.push(vNum);\n                    }\n                });\n            }\n        }\n        else if (location.location === \"fields.Items[].VehicleNumber\") {\n            // 2. קישור ישיר בפריט\n            if (ocrFields.Items && Array.isArray(ocrFields.Items)) {\n                ocrFields.Items.forEach(item => {\n                    if (item.VehicleNumber && !foundVehicles.includes(item.VehicleNumber)) {\n                        foundVehicles.push(item.VehicleNumber);\n                    }\n                });\n            }\n        }\n        else if (location.location === \"fields.Items[].Description\" && location.pattern) {\n            // 3. חיפוש בתיאור לפי דפוס\n            if (ocrFields.Items && Array.isArray(ocrFields.Items)) {\n                const pattern = new RegExp(location.pattern);\n                ocrFields.Items.forEach(item => {\n                    if (item.Description) {\n                        const match = item.Description.match(pattern);\n                        if (match && match[0] && !foundVehicles.includes(match[0])) {\n                            foundVehicles.push(match[0]);\n                        }\n                    }\n                });\n            }\n        }\n        else if (location.location === \"fields.UnidentifiedNumbers\") {\n            // 4. מספרים לא מזוהים\n            const unidentified = ocrFields.UnidentifiedNumbers || [];\n            const vehiclePattern = /\\d{3}-\\d{2}-\\d{3}/;\n\n            unidentified.forEach(item => {\n                const value = typeof item === 'object' ? item.value : item;\n                const label = typeof item === 'object' ? (item.label || '') : '';\n                const context = typeof item === 'object' ? (item.context || '') : '';\n\n                // תיקון: גם אם יש תווית \"רכב\", חייב להתאים לדפוס מספר רכב!\n                // זה מונע טעויות של Azure OCR שמסמן מספר כרטיס בתור \"מספר רכב\"\n                const isValidVehicleNumber = vehiclePattern.test(value);\n\n                // בדיקה נוספת: אם בהקשר כתוב \"כרטיס\", זה לא רכב\n                const looksLikeCardNumber = context.includes('כרטיס') || label.includes('כרטיס');\n\n                // אם יש filter_by_label - רק עם התווית הזו וגם דפוס תקין\n                if (location.filter_by_label) {\n                    if (label && label.includes(location.filter_by_label)) {\n                        // תיקון: גם עם תווית רכב, חייב דפוס תקין ולא להיות מסומן ככרטיס\n                        if (isValidVehicleNumber && !looksLikeCardNumber && !foundVehicles.includes(value)) {\n                            foundVehicles.push(value);\n                        }\n                    }\n                } else {\n                    // אחרת - לפי דפוס רכב בלבד\n                    if (isValidVehicleNumber && !looksLikeCardNumber && !foundVehicles.includes(value)) {\n                        foundVehicles.push(value);\n                    }\n                }\n            });\n        }\n    }\n\n    return [...new Set(foundVehicles)]; // ייחודיים בלבד\n}\n\nfunction createVehicleItems(vehicles, ocrItems, vehicleRules, ocrFields) {\n    if (!vehicles || vehicles.length === 0) return [];\n\n    const vehicleItems = [];\n\n    // תיקון: מחיר = סכום כל החשבונית (לפני מע\"מ)\n    // חישוב: InvoiceTotal - TotalTax = סה\"כ לפני מע\"מ (עבודות + חלקים)\n    const totalPrice = ocrFields.TotalTax_amount\n        ? (ocrFields.InvoiceTotal_amount || 0) - ocrFields.TotalTax_amount\n        : (ocrFields.SubTotal_amount || ocrFields.InvoiceTotal_amount || 0);\n    const pricePerVehicle = vehicles.length > 0 ? totalPrice / vehicles.length : totalPrice;\n\n    vehicles.forEach(vehicleNum => {\n        // חיפוש מיפוי בחוקים\n        const mapping = vehicleRules.vehicle_account_mapping?.[vehicleNum];\n\n        // חיפוש תיאור מהפריטים של OCR\n        const relatedItem = ocrItems.find(item =>\n            (item.VehicleNumber && item.VehicleNumber === vehicleNum) ||\n            (item.Description && item.Description.includes(vehicleNum))\n        );\n\n        // תיקון: תיאור קצר בלבד\n        const shortDesc = extractShortDescription(ocrFields, vehicleNum);\n\n        // בניית פריט - רק שדות שPriority מכיר!\n        const item = {\n            PARTNAME: vehicleRules.output_format?.partname || \"car\",\n            PDES: shortDesc,\n            TQUANT: relatedItem?.Quantity || 1,\n            TUNITNAME: relatedItem?.Unit || \"יח'\",\n            PRICE: pricePerVehicle,\n            VATFLAG: mapping?.vat_pattern?.VATFLAG || \"Y\",\n            ACCNAME: mapping?.accname || vehicleRules.default_values?.accname || \"\"\n        };\n\n        // BUDCODE - חובה לפי התבנית!\n        if (mapping?.budcode) {\n            item.BUDCODE = mapping.budcode;\n        } else if (vehicleRules.default_values?.budcode) {\n            item.BUDCODE = vehicleRules.default_values.budcode;\n        }\n\n        // SPECIALVATFLAG - רק אם זה Y (לא שדות אחרים!)\n        if (mapping?.vat_pattern?.SPECIALVATFLAG === \"Y\") {\n            item.SPECIALVATFLAG = \"Y\";\n        }\n\n        // שמור מידע למידה בנפרד (לא נשלח ל-Priority!)\n        if (!mapping) {\n            // רק לצרכי דיווח ולמידה - לא ישלח ב-JSON הסופי\n            item._learningNote = \"רכב חדש - נדרש מיפוי\";\n        }\n\n        vehicleItems.push(item);\n    });\n\n    return vehicleItems;\n}\n\n// ============================================================================\n// פונקציית עזר - חילוץ תיאור קצר\n// ============================================================================\n\nfunction extractShortDescription(ocrFields, vehicleNum) {\n    // חיפוש תיאור קצר מהפריטים\n    if (ocrFields.Items && ocrFields.Items.length > 0) {\n        // חפש פריט שמכיל תיאור רלוונטי\n        const item = ocrFields.Items.find(i =>\n            i.Description && (\n                i.Description.includes(vehicleNum) ||\n                i.Description.includes('טיפול') ||\n                i.Description.includes('עבודה')\n            )\n        );\n\n        if (item && item.Description) {\n            const desc = item.Description.trim();\n\n            // תיקון חדש: חפש דפוס \"טיפול XXX ק\\\"מ\" או \"טיפול XXX,XXX ק\\\"מ\"\n            // דפוס: \"טיפול\" + מספר (עם או בלי פסיק) + \"ק\\\"מ\" או \"קמ\"\n            const servicePattern = /טיפול\\s+[\\d,]+\\s*ק[״\"]?מ/i;\n            const match = desc.match(servicePattern);\n\n            if (match) {\n                // נמצא דפוס טיפול - נקה אותו ונחזיר\n                let serviceDesc = match[0];\n                // המר \"קמ\" ל-\"ק\"מ\" והסר פסיקים מהמספר\n                serviceDesc = serviceDesc\n                    .replace(/,/g, '')          // הסר פסיקים\n                    .replace(/קמ/g, 'ק\"מ')      // תקנן את \"קמ\" ל-\"ק\"מ\"\n                    .replace(/ק״מ/g, 'ק\"מ');   // תקנן את ״ ל-\"\n\n                return serviceDesc;\n            }\n\n            // אם לא נמצא דפוס טיפול - חפש תיאורים אחרים (החלפה, תיקון, בדיקה)\n            const generalPattern = /(החלפת|תיקון|בדיקת|הח[''׳])\\s+[\\u0590-\\u05FF\\s]+/;\n            const generalMatch = desc.match(generalPattern);\n\n            if (generalMatch) {\n                // קח עד 50 תווים מהתיאור\n                let shortDesc = generalMatch[0].trim();\n                if (shortDesc.length > 50) {\n                    shortDesc = shortDesc.substring(0, 47) + '...';\n                }\n                return shortDesc;\n            }\n\n            // אם אין דפוס מיוחד - קח את 3-4 המילים הראשונות\n            const words = desc.split(/\\s+/);\n            let shortDesc = words.slice(0, 4).join(' ');\n\n            if (shortDesc.length > 50) {\n                shortDesc = shortDesc.substring(0, 47) + '...';\n            }\n\n            return shortDesc;\n        }\n    }\n\n    // אם לא מצאנו תיאור - החזר ברירת מחדל\n    return 'טיפול';\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 4\n// ============================================================================\n\nfunction buildInvoiceFromTemplate(template, structure, config, searchResults, learnedConfig, ocrFields, docsList) {\n    const invoice = {\n        SUPNAME: config.supplier_config.supplier_code,\n        CODE: template.CODE,\n        DEBIT: structure.debit_type,\n        IVDATE: searchResults.ivdate,\n        BOOKNUM: searchResults.booknum\n    };\n\n    if (searchResults.ordname) {\n        invoice.ORDNAME = searchResults.ordname;\n    }\n\n    if (searchResults.impfnum) {\n        invoice.IMPFNUM = searchResults.impfnum;\n    }\n\n    // תיקון: DETAILS - יצירה חכמה לפי רכבים\n    if (searchResults.vehicles && searchResults.vehicles.length > 0) {\n        // אם יש רכבים - בנה DETAILS עם תיאור טיפול + ק\"מ נוכחי\n        const vehicleNum = searchResults.vehicles[0];\n        const shortDesc = extractShortDescription(ocrFields, vehicleNum);\n\n        // חיפוש ק\"מ נוכחי מה-UnidentifiedNumbers או CustomerId\n        let currentMileage = '';\n\n        // נסה למצוא ק\"מ ב-UnidentifiedNumbers\n        const unidentified = ocrFields.UnidentifiedNumbers || [];\n        if (unidentified.length > 0) {\n            const mileageItem = unidentified.find(item => {\n                if (typeof item === 'object') {\n                    const label = item.label || '';\n                    const value = item.value || '';\n                    // חפש תווית \"ק\\\"מ\" או מספר בין 50000-300000 (טווח סביר לק\"מ)\n                    if (label.includes('ק') || label.includes('קמ') || label.includes('מ')) {\n                        return /^\\d{5,6}$/.test(value);\n                    }\n                }\n                return false;\n            });\n\n            if (mileageItem && typeof mileageItem === 'object') {\n                currentMileage = mileageItem.value;\n            }\n        }\n\n        // אם לא נמצא, נסה CustomerId (לפעמים Azure מזהה את ק\"מ כ-CustomerId)\n        if (!currentMileage && ocrFields.CustomerId && /^\\d{5,6}$/.test(ocrFields.CustomerId)) {\n            currentMileage = ocrFields.CustomerId;\n        }\n\n        // בנה DETAILS לפי הפורמט: \"תיאור טיפול-XXXXXק\\\"מ\"\n        invoice.DETAILS = currentMileage ? `${shortDesc}-${currentMileage}` : shortDesc;\n    } else if (searchResults.details) {\n        // אחרת - השתמש ב-DETAILS הרגיל\n        invoice.DETAILS = searchResults.details;\n    }\n\n    // תעודות\n    if (structure.has_doc) {\n        // אם מצאנו תעודות ב-OCR - השתמש בהן\n        if (searchResults.documents && searchResults.documents.length > 0) {\n            if (searchResults.documents.length === 1) {\n                invoice.DOCNO = searchResults.documents[0].DOCNO;\n            } else {\n                invoice.PIVDOC_SUBFORM = searchResults.documents.map(d => ({\n                    DOCNO: d.DOCNO,\n                    BOOKNUM: d.BOOKNUM\n                }));\n            }\n        }\n        // אם לא מצאנו ב-OCR אבל יש ב-docs_list - קח מ-docs_list\n        else if (docsList && docsList.DOC_YES_NO === \"Y\" && docsList.list_of_docs && docsList.list_of_docs.length > 0) {\n            try {\n                const docs = docsList.list_of_docs.flatMap(d => JSON.parse(d));\n                if (docs.length === 1) {\n                    invoice.DOCNO = docs[0].DOCNO;\n                } else if (docs.length > 1) {\n                    invoice.PIVDOC_SUBFORM = docs.map(d => ({\n                        DOCNO: d.DOCNO,\n                        BOOKNUM: d.BOOKNUM\n                    }));\n                }\n            } catch (e) {\n                // אם יש שגיאת parsing, המשך בלי תעודות\n            }\n        }\n    }\n\n    // פריטים\n    const needItems = shouldAddItems(structure, searchResults.documents, docsList);\n\n    if (needItems) {\n        const vehicleRules = config.rules?.critical_patterns?.vehicle_rules;\n\n        // ✨ חדש! אם יש רכבים - יוצרים פריטי רכבים\n        if (searchResults.vehicles && searchResults.vehicles.length > 0 && vehicleRules) {\n            invoice.PINVOICEITEMS_SUBFORM = createVehicleItems(\n                searchResults.vehicles,\n                searchResults.items,\n                vehicleRules,\n                ocrFields  // תיקון: העברת ocrFields\n            );\n        }\n        // אחרת - פריטים רגילים מ-OCR\n        else if (searchResults.items && searchResults.items.length > 0) {\n            invoice.PINVOICEITEMS_SUBFORM = buildItems(\n                searchResults.items,\n                config,\n                structure,\n                template,\n                learnedConfig\n            );\n        }\n    }\n\n    if (template.PINVOICESCONT_SUBFORM) {\n        invoice.PINVOICESCONT_SUBFORM = template.PINVOICESCONT_SUBFORM;\n    }\n\n    return invoice;\n}\n\nfunction shouldAddItems(structure, documents, docsList) {\n    // אם אין תעודות בכלל בתבנית → צריך פריטים\n    if (!structure.has_doc) return true;\n\n    // בדוק אם יש תעודות בפועל (ב-OCR או ב-docs_list)\n    const hasDocsInOCR = documents && documents.length > 0;\n    const hasDocsInList = docsList && docsList.DOC_YES_NO === \"Y\";\n    const hasDocsActually = hasDocsInOCR || hasDocsInList;\n\n    // אם התבנית אומרת שיש תעודות אבל אין בפועל → צריך פריטים\n    if (structure.has_doc && !hasDocsActually) return true;\n\n    // אם יש תעודות בפועל:\n    if (hasDocsActually) {\n        // אם יש גם יבוא → לא צריך פריטים (הכל בתעודות)\n        if (structure.has_import) return false;\n\n        // אם אין יבוא אבל יש מלאי לא מנוהל → צריך פריטים\n        if (structure.inventory_management === \"not_managed_inventory\") return true;\n    }\n\n    // אחרת → לא צריך פריטים\n    return false;\n}\n\nfunction buildItems(ocrItems, config, structure, template, learnedConfig) {\n    let defaultAccname = \"\";\n\n    if (template.PINVOICEITEMS_SUBFORM && template.PINVOICEITEMS_SUBFORM.length > 0) {\n        defaultAccname = template.PINVOICEITEMS_SUBFORM[0].ACCNAME || \"\";\n    }\n\n    if (!defaultAccname && config.document_types && config.document_types.length > 0) {\n        const docType = config.document_types[0];\n        if (docType.accnames && docType.accnames.length > 0) {\n            defaultAccname = docType.accnames[0];\n        }\n    }\n\n    let defaultBudcode = \"\";\n    if (template.PINVOICEITEMS_SUBFORM && template.PINVOICEITEMS_SUBFORM.length > 0) {\n        defaultBudcode = template.PINVOICEITEMS_SUBFORM[0].BUDCODE || \"\";\n    }\n\n    return ocrItems.map(ocrItem => {\n        const item = {\n            PARTNAME: extractPartname(ocrItem.ProductCode),\n            PDES: ocrItem.Description || \"\",\n            TQUANT: ocrItem.Quantity || 1,\n            TUNITNAME: ocrItem.Unit || \"יח'\",\n            PRICE: ocrItem.UnitPrice || ocrItem.UnitPrice_amount || 0,\n            VATFLAG: \"Y\",\n            ACCNAME: defaultAccname\n        };\n\n        if (item.PARTNAME === \"car\" && config.rules.critical_patterns.vehicle_rules) {\n            applyVehicleRules(item, ocrItem.Description, config.rules.critical_patterns.vehicle_rules);\n        }\n\n        if (config.rules.critical_patterns.partname_rules) {\n            applyPartnameRules(item, config.rules.critical_patterns.partname_rules);\n        }\n\n        if (structure.has_budcode && defaultBudcode) {\n            item.BUDCODE = defaultBudcode;\n        }\n\n        return item;\n    });\n}\n\nfunction extractPartname(productCode) {\n    if (!productCode) return \"\";\n\n    const codes = String(productCode).split('\\n');\n    const priorityCode = codes.find(c => /^[A-Z]/.test(c) || /^\\d+$/.test(c));\n\n    return priorityCode || codes[0] || \"\";\n}\n\nfunction applyVehicleRules(item, description, vehicleRules) {\n    if (!vehicleRules.vehicle_account_mapping) return;\n\n    const vehicleMatch = description.match(/\\d{3}-\\d{2}-\\d{3}/);\n    if (!vehicleMatch) return;\n\n    const vehicleNum = vehicleMatch[0];\n    const mapping = vehicleRules.vehicle_account_mapping[vehicleNum];\n\n    if (mapping) {\n        item.ACCNAME = mapping.accname;\n        item.VATFLAG = mapping.vat_pattern?.VATFLAG || mapping.vatflag || item.VATFLAG;\n\n        if (mapping.vat_pattern?.SPECIALVATFLAG && mapping.vat_pattern.SPECIALVATFLAG !== \"varies\") {\n            item.SPECIALVATFLAG = mapping.vat_pattern.SPECIALVATFLAG;\n        }\n\n        if (mapping.budcode) {\n            item.BUDCODE = mapping.budcode;\n        }\n    }\n}\n\nfunction applyPartnameRules(item, partnameRules) {\n    const rule = partnameRules[item.PARTNAME];\n\n    if (rule) {\n        if (rule.accname) item.ACCNAME = rule.accname;\n        if (rule.vatflag) item.VATFLAG = rule.vatflag;\n        if (rule.specialvatflag) item.SPECIALVATFLAG = rule.specialvatflag;\n    }\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 5 (בקרות)\n// ============================================================================\n\nfunction performValidation(invoice, ocrFields, config, docsList, patterns) {\n    const warnings = [];\n    const checks = {};\n\n    let invoiceTotquant = 0;\n    if (invoice.PINVOICEITEMS_SUBFORM) {\n        invoiceTotquant = invoice.PINVOICEITEMS_SUBFORM.reduce(\n            (sum, item) => sum + (item.TQUANT || 0),\n            0\n        );\n    }\n\n    let docsTotquant = 0;\n    if (docsList && docsList.list_of_docs) {\n        try {\n            const docs = docsList.list_of_docs.map(d => JSON.parse(d));\n            docsTotquant = docs.reduce((sum, d) => sum + (d.TOTQUANT || 0), 0);\n        } catch (e) {\n            // ממשיכים בלי\n        }\n    }\n\n    const learnedTotquant = config.rules.validation_data.TOTQUANT || 0;\n\n    checks.totquant = {\n        invoice_items_sum: invoiceTotquant,\n        docs_sum: docsTotquant,\n        learned_reference: learnedTotquant,\n        items_vs_docs_match: invoiceTotquant === docsTotquant || docsTotquant === 0,\n        notes: []\n    };\n\n    if (invoiceTotquant !== docsTotquant && docsTotquant > 0) {\n        warnings.push(`אי התאמת כמויות: פריטים=${invoiceTotquant}, תעודות=${docsTotquant}`);\n        checks.totquant.notes.push(\"אי התאמה בין פריטים לתעודות\");\n    }\n\n    if (patterns.booknum_pattern) {\n        const expected = patterns.booknum_pattern.length;\n        const actual = invoice.BOOKNUM.length;\n\n        checks.booknum_pattern = {\n            expected_length: expected,\n            actual_length: actual,\n            match: expected === actual,\n            pattern_example: patterns.booknum_pattern.example\n        };\n\n        if (expected !== actual) {\n            warnings.push(`דפוס BOOKNUM: צפוי ${expected} ספרות, קיבלנו ${actual}`);\n        }\n    }\n\n    const requiredFields = [\"SUPNAME\", \"CODE\", \"DEBIT\", \"IVDATE\", \"BOOKNUM\"];\n    const missingFields = requiredFields.filter(f => !invoice[f]);\n\n    if (missingFields.length > 0) {\n        warnings.push(`שדות חובה חסרים: ${missingFields.join(', ')}`);\n    }\n\n    if (invoice.PINVOICEITEMS_SUBFORM) {\n        const emptyAccounts = invoice.PINVOICEITEMS_SUBFORM.filter(\n            item => !item.ACCNAME || item.ACCNAME === \"\"\n        );\n\n        if (emptyAccounts.length > 0) {\n            warnings.push(`${emptyAccounts.length} פריטים ללא ACCNAME`);\n        }\n    }\n\n    return {\n        all_valid: warnings.length === 0,\n        checks: checks,\n        warnings: warnings\n    };\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 6 (למידה)\n// ============================================================================\n\nfunction analyzeLearning(invoice, config) {\n    const newPatterns = {\n        new_partnames: [],\n        new_vehicles: [],\n        unknown_accounts: []\n    };\n\n    const instructions = [];\n\n    if (invoice.PINVOICEITEMS_SUBFORM) {\n        invoice.PINVOICEITEMS_SUBFORM.forEach(item => {\n            const partnameKnown = config.rules.critical_patterns.partname_rules &&\n                                config.rules.critical_patterns.partname_rules[item.PARTNAME];\n\n            if (!partnameKnown && item.PARTNAME !== \"car\") {\n                newPatterns.new_partnames.push({\n                    partname: item.PARTNAME,\n                    pdes: item.PDES,\n                    suggested_accname: item.ACCNAME\n                });\n\n                instructions.push({\n                    type: \"add_partname_rule\",\n                    partname: item.PARTNAME,\n                    suggested_accname: item.ACCNAME,\n                    priority: \"medium\"\n                });\n            }\n\n            // ✨ חדש! זיהוי רכב חדש\n            if (item.PARTNAME === \"car\" || item.isNewVehicle) {\n                const vehicleMatch = item.PDES.match(/\\d{3}-\\d{2}-\\d{3}/);\n                if (vehicleMatch) {\n                    const vNum = vehicleMatch[0];\n                    const vehicleKnown = config.rules?.critical_patterns?.vehicle_rules?.vehicle_account_mapping?.[vNum];\n\n                    if (!vehicleKnown || item.isNewVehicle) {\n                        newPatterns.new_vehicles.push({\n                            vehicle_number: vNum,\n                            suggested_accname: item.ACCNAME,\n                            suggested_budcode: item.BUDCODE,\n                            suggested_vatflag: item.VATFLAG\n                        });\n\n                        instructions.push({\n                            type: \"add_vehicle_rule\",\n                            vehicle_number: vNum,\n                            suggested_accname: item.ACCNAME,\n                            suggested_budcode: item.BUDCODE,\n                            priority: \"high\"\n                        });\n                    }\n                }\n            }\n\n            if (!item.ACCNAME || item.ACCNAME === \"\") {\n                newPatterns.unknown_accounts.push({\n                    partname: item.PARTNAME,\n                    pdes: item.PDES\n                });\n\n                instructions.push({\n                    type: \"missing_account\",\n                    partname: item.PARTNAME,\n                    priority: \"critical\"\n                });\n            }\n        });\n    }\n\n    const learningRequired =\n        newPatterns.new_partnames.length > 0 ||\n        newPatterns.new_vehicles.length > 0 ||\n        newPatterns.unknown_accounts.length > 0;\n\n    return {\n        learning_required: learningRequired,\n        new_patterns: newPatterns,\n        learning_instructions: instructions,\n        recommendation: learningRequired ? \"שלח לקוד 3 ללמידה\" : \"אין צורך בלמידה\"\n    };\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 7 (יצירת פלטים נוספים)\n// ============================================================================\n\nfunction generateLLMPrompt(config, ocrFields, searchResults, executionReport) {\n    const supplierCode = config.supplier_config.supplier_code;\n    const supplierName = config.supplier_config.supplier_name;\n\n    // בניית הסבר על כל שדה\n    const fieldInstructions = {};\n\n    // BOOKNUM\n    fieldInstructions.booknum = {\n        field_name: \"BOOKNUM\",\n        description: \"מספר חשבונית\",\n        how_to_find: \"חפש בשדה InvoiceId ב-OCR. הסר קידומת SI אם קיימת. קח את מספר התווים האחרונים לפי הדפוס הנלמד.\",\n        example: searchResults.booknum || \"1015938\",\n        ocr_source: \"ocrFields.InvoiceId\"\n    };\n\n    // IVDATE\n    fieldInstructions.ivdate = {\n        field_name: \"IVDATE\",\n        description: \"תאריך חשבונית\",\n        how_to_find: \"קח את InvoiceDate מה-OCR והמר לפורמט DD/MM/YY\",\n        example: searchResults.ivdate || \"10/09/25\",\n        ocr_source: \"ocrFields.InvoiceDate\"\n    };\n\n    // PRICE - חשוב!\n    fieldInstructions.price = {\n        field_name: \"PRICE\",\n        description: \"מחיר לפני מע\\\"מ (עבודות + חלקים)\",\n        how_to_calculate: \"חשב: InvoiceTotal_amount - TotalTax_amount. זה נותן את סה\\\"כ החשבונית לפני מע\\\"מ.\",\n        formula: \"InvoiceTotal_amount - TotalTax_amount\",\n        example: ocrFields.InvoiceTotal_amount && ocrFields.TotalTax_amount\n            ? `${ocrFields.InvoiceTotal_amount} - ${ocrFields.TotalTax_amount} = ${ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount}`\n            : \"2524 - 385.02 = 2138.98\",\n        fallback: \"אם אין TotalTax_amount, קח SubTotal_amount. אם גם זה לא קיים, קח InvoiceTotal_amount.\",\n        ocr_source: \"ocrFields.InvoiceTotal_amount, ocrFields.TotalTax_amount\"\n    };\n\n    // VEHICLES\n    const vehicleRules = config.rules?.critical_patterns?.vehicle_rules;\n    if (vehicleRules) {\n        fieldInstructions.vehicles = {\n            field_name: \"VEHICLES\",\n            description: \"מספרי רכבים\",\n            how_to_find: \"חפש פורמט XXX-XX-XXX ב-UnidentifiedNumbers עם label='רכב'. בדוק שזה לא מספר כרטיס (context לא מכיל 'כרטיס').\",\n            pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\",\n            example: searchResults.vehicles && searchResults.vehicles.length > 0\n                ? searchResults.vehicles.join(', ')\n                : \"459-06-303\",\n            ocr_source: \"ocrFields.UnidentifiedNumbers (with label filter)\"\n        };\n    }\n\n    // DETAILS\n    fieldInstructions.details = {\n        field_name: \"DETAILS\",\n        description: \"תיאור החשבונית\",\n        how_to_find: \"אם יש רכבים: חלץ תיאור קצר של השירות (3-4 מילים, מקסימום 50 תווים) מהפריט הראשון ב-Items. אם יש גם ק\\\"מ נוכחי (CustomerId), הוסף אותו בפורמט: 'תיאור-XXXXXק\\\"מ'\",\n        example: \"טיפול 75000 ק\\\"מ-76256\",\n        ocr_source: \"ocrFields.Items[0].Description, ocrFields.CustomerId\"\n    };\n\n    // מיפוי רכבים\n    const vehicleMapping = {};\n    if (vehicleRules && vehicleRules.vehicle_account_mapping) {\n        Object.keys(vehicleRules.vehicle_account_mapping).forEach(vNum => {\n            const mapping = vehicleRules.vehicle_account_mapping[vNum];\n            vehicleMapping[vNum] = {\n                account: mapping.accname,\n                budget_code: mapping.budcode,\n                vat_flag: mapping.vat_pattern?.VATFLAG || \"Y\",\n                description: mapping.accdes || `רכב ${vNum}`\n            };\n        });\n    }\n\n    // חילוץ document_type אמיתי מהקונפיג\n    const documentType = config.document_types?.[0]?.type || \"חשבונית רגילה\";\n\n    // בניית overview דינמי לפי מבנה התבנית\n    const structure = config.structure?.[0] || {};\n    let overview = `חשבונית מספק ${supplierName}.`;\n\n    if (structure.has_import && structure.has_doc) {\n        overview += \" תבנית: יבוא + תעודות. הספק מספק מוצרי מצאי ויבוא.\";\n    } else if (structure.has_import) {\n        overview += \" תבנית: יבוא. הספק מספק מוצרים מיובאים.\";\n    } else if (structure.has_doc) {\n        overview += \" תבנית: תעודות. הספק מספק מוצרים על בסיס תעודות אספקה.\";\n    } else if (vehicleRules && Object.keys(vehicleRules.vehicle_account_mapping || {}).length > 0) {\n        overview += \" תבנית: שירותי רכב ומוסך.\";\n    } else {\n        overview += \" תבנית: חשבונית רגילה עם פירוט.\";\n    }\n\n    // בניית processing_steps דינמי לפי מבנה התבנית\n    const processingSteps = [];\n    processingSteps.push(\"1. זהה את מספר החשבונית (BOOKNUM) מתוך InvoiceId\");\n    processingSteps.push(\"2. חלץ תאריך חשבונית (IVDATE) מתוך InvoiceDate\");\n\n    if (structure.has_import) {\n        processingSteps.push(\"3. זהה מספר יבוא (IMPFNUM) מתוך import_files\");\n    }\n\n    if (structure.has_doc) {\n        processingSteps.push(`${processingSteps.length + 1}. זהה תעודות (DOCNO/BOOKNUM) - חפש מספרים בפורמט 25XXXXXX או 108XXXXXX`);\n    }\n\n    if (structure.has_purchase_orders) {\n        processingSteps.push(`${processingSteps.length + 1}. זהה הזמנת רכש (ORDNAME) אם קיימת`);\n    }\n\n    if (vehicleRules && Object.keys(vehicleRules.vehicle_account_mapping || {}).length > 0) {\n        processingSteps.push(`${processingSteps.length + 1}. חלץ מספרי רכבים מ-UnidentifiedNumbers (פורמט XXX-XX-XXX)`);\n        processingSteps.push(`${processingSteps.length + 1}. מפה כל רכב לחשבון הנכון לפי vehicle_mapping`);\n        processingSteps.push(`${processingSteps.length + 1}. צור תיאור קצר של השירות מהפריט הראשון`);\n    } else {\n        processingSteps.push(`${processingSteps.length + 1}. חשב את המחיר הכולל לפני מע\"מ: InvoiceTotal - TotalTax`);\n    }\n\n    return {\n        supplier_code: supplierCode,\n        supplier_name: supplierName,\n        document_type: documentType,\n        instructions: {\n            overview: overview,\n            processing_steps: processingSteps,\n            fields: fieldInstructions,\n            vehicle_mapping: vehicleMapping\n        }\n    };\n}\n\nfunction generateTechnicalConfig(config, ocrFields, searchResults, executionReport) {\n    const supplierCode = config.supplier_config.supplier_code;\n    const supplierName = config.supplier_config.supplier_name;\n\n    // extraction rules מפורטים\n    const extractionRules = {};\n\n    // BOOKNUM\n    extractionRules.booknum = {\n        source: \"ocrFields.InvoiceId\",\n        transformations: [\n            {\n                action: \"remove_prefix\",\n                pattern: \"^SI\",\n                case_insensitive: true,\n                description: \"הסר קידומת SI אם קיימת\"\n            },\n            {\n                action: \"take_last_n_chars\",\n                count: 7,\n                description: \"קח 7 תווים אחרונים\"\n            }\n        ],\n        validation: {\n            length: 7,\n            pattern: \"^\\\\d{7}$\",\n            required: true\n        },\n        example: searchResults.booknum || \"1015938\"\n    };\n\n    // IVDATE\n    extractionRules.ivdate = {\n        source: \"ocrFields.InvoiceDate\",\n        format: \"DD/MM/YY\",\n        transformation: {\n            from: \"ISO8601\",\n            to: \"DD/MM/YY\",\n            description: \"המר מפורמט ISO (YYYY-MM-DD) לפורמט DD/MM/YY\"\n        },\n        validation: {\n            pattern: \"^\\\\d{2}/\\\\d{2}/\\\\d{2}$\",\n            required: true\n        },\n        example: searchResults.ivdate || \"10/09/25\"\n    };\n\n    // PRICE - החישוב החשוב!\n    extractionRules.price = {\n        calculation: {\n            method: \"subtract\",\n            primary: {\n                formula: \"ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount\",\n                fields_required: [\"InvoiceTotal_amount\", \"TotalTax_amount\"],\n                description: \"סה\\\"כ לפני מע\\\"מ = סה\\\"כ כולל מע\\\"מ - מע\\\"מ\"\n            },\n            fallback: {\n                formula: \"ocrFields.SubTotal_amount || ocrFields.InvoiceTotal_amount\",\n                fields_required: [\"SubTotal_amount\"],\n                description: \"אם אין TotalTax_amount, קח SubTotal_amount\"\n            },\n            division_by_vehicles: {\n                enabled: true,\n                formula: \"totalPrice / vehicles.length\",\n                description: \"אם יש מספר רכבים, חלק את המחיר הכולל באופן שווה\"\n            }\n        },\n        description: \"מחיר לפני מע\\\"מ (עבודות + חלקים)\",\n        example_calculation: ocrFields.InvoiceTotal_amount && ocrFields.TotalTax_amount\n            ? {\n                invoice_total: ocrFields.InvoiceTotal_amount,\n                total_tax: ocrFields.TotalTax_amount,\n                calculated_price: ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount,\n                formula_used: \"InvoiceTotal_amount - TotalTax_amount\"\n            }\n            : {\n                invoice_total: 2524,\n                total_tax: 385.02,\n                calculated_price: 2138.98,\n                formula_used: \"2524 - 385.02\"\n            }\n    };\n\n    // VEHICLES\n    const vehicleRules = config.rules?.critical_patterns?.vehicle_rules;\n    if (vehicleRules) {\n        extractionRules.vehicles = {\n            search_locations: [\n                {\n                    field: \"ocrFields.UnidentifiedNumbers\",\n                    priority: 1,\n                    filter: {\n                        label: \"רכב\",\n                        description: \"רק פריטים עם תווית 'רכב'\"\n                    },\n                    pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\",\n                    validation: {\n                        must_match_pattern: true,\n                        exclude_if_context_contains: [\"כרטיס\"],\n                        description: \"בדוק שזה לא מספר כרטיס\"\n                    }\n                },\n                {\n                    field: \"ocrFields.VehicleNumbers\",\n                    priority: 2,\n                    pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\"\n                },\n                {\n                    field: \"ocrFields.Items[].Description\",\n                    priority: 3,\n                    pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\",\n                    description: \"חפש בתיאור הפריטים\"\n                }\n            ],\n            example: searchResults.vehicles || [\"459-06-303\"]\n        };\n    }\n\n    // DOCUMENTS (DOCNO + BOOKNUM)\n    if (config.structure && config.structure.some(s => s.has_doc)) {\n        extractionRules.documents = {\n            search_in: [\n                {\n                    location: \"ocrFields.UnidentifiedNumbers\",\n                    priority: 1,\n                    filter: {\n                        label: \"מס׳ הקצאה (BOOKNUM)\",\n                        description: \"חפש במערך UnidentifiedNumbers עם תווית BOOKNUM\"\n                    },\n                    pattern: \"\\\\b(108\\\\d{6})\\\\b\",\n                    description: \"BOOKNUM - 9 ספרות מתחיל ב-108\"\n                },\n                {\n                    location: \"AZURE_TEXT\",\n                    priority: 2,\n                    fallback: true,\n                    pattern: \"\\\\b(108\\\\d{6})\\\\b\",\n                    description: \"חיפוש fallback ב-AZURE_TEXT אם לא נמצא ב-UnidentifiedNumbers\"\n                }\n            ],\n            matching: {\n                match_field: \"BOOKNUM\",\n                lookup_source: \"docs_list.list_of_docs\",\n                output_fields: [\"DOCNO\", \"BOOKNUM\"],\n                description: \"התאם את BOOKNUM שנמצא ב-OCR עם docs_list כדי לקבל DOCNO\"\n            },\n            output_format: {\n                field_name: \"PIVDOC_SUBFORM\",\n                structure: [\n                    {\n                        DOCNO: \"string - מספר תעודה פנימי ב-Priority (25XXXXXX)\",\n                        BOOKNUM: \"string - מספר הקצאה חיצוני (108XXXXXX)\"\n                    }\n                ]\n            },\n            error_handling: {\n                if_none_found: {\n                    action: \"return_partial_json\",\n                    include_empty_array: true,\n                    add_to_report: \"errors\",\n                    message: \"תבנית דורשת תעודות אך לא נמצאו ב-OCR\"\n                },\n                if_partial_found: {\n                    action: \"return_partial_json\",\n                    include_found_items: true,\n                    add_to_report: \"warnings\",\n                    message: \"נמצאו רק {found_count} מתוך {expected_count} תעודות\"\n                }\n            },\n            example: searchResults.documents || [\n                { DOCNO: \"25026849\", BOOKNUM: \"108379736\" },\n                { DOCNO: \"25026850\", BOOKNUM: \"108379734\" }\n            ]\n        };\n    }\n\n    // DESCRIPTION\n    extractionRules.description = {\n        source: \"ocrFields.Items[0].Description\",\n        extraction: {\n            method: \"pattern_match\",\n            patterns: [\n                {\n                    name: \"service_with_km\",\n                    pattern: \"טיפול\\\\s+[\\\\d,]+\\\\s*ק[״\\\"]?מ\",\n                    priority: 1,\n                    description: \"טיפול XXX ק\\\"מ\"\n                },\n                {\n                    name: \"general_service\",\n                    pattern: \"(החלפת|תיקון|בדיקת)\\\\s+[\\\\u0590-\\\\u05FF\\\\s]+\",\n                    priority: 2,\n                    description: \"תיאור כללי של שירות\"\n                }\n            ],\n            max_words: 4,\n            max_length: 50,\n            append_mileage: {\n                enabled: true,\n                source: \"ocrFields.CustomerId\",\n                format: \"{description}-{mileage}\",\n                description: \"אם יש ק\\\"מ נוכחי, הוסף בפורמט: 'תיאור-XXXXXק\\\"מ'\"\n            }\n        },\n        fallback: \"טיפול\",\n        example: \"טיפול 75000 ק\\\"מ\"\n    };\n\n    // Vehicle mapping\n    const vehicleMapping = {};\n    if (vehicleRules && vehicleRules.vehicle_account_mapping) {\n        Object.keys(vehicleRules.vehicle_account_mapping).forEach(vNum => {\n            const mapping = vehicleRules.vehicle_account_mapping[vNum];\n            vehicleMapping[vNum] = {\n                accname: mapping.accname,\n                accdes: mapping.accdes,\n                budcode: mapping.budcode,\n                vat_pattern: {\n                    VATFLAG: mapping.vat_pattern?.VATFLAG || \"Y\",\n                    SPECIALVATFLAG: mapping.vat_pattern?.SPECIALVATFLAG\n                },\n                date_range_pattern: mapping.date_range_pattern || \"never\",\n                pdaccname_pattern: mapping.pdaccname_pattern || \"never\"\n            };\n        });\n    }\n\n    // Template structure\n    const template = {\n        SUPNAME: supplierCode,\n        CODE: \"ש\\\"ח\",\n        DEBIT: \"D\",\n        TUNITNAME: \"יח'\",\n        TQUANT: 1,\n        PINVOICESCONT_SUBFORM: [\n            { FNCPATNAME: \"2323\" }\n        ]\n    };\n\n    return {\n        supplier_code: supplierCode,\n        supplier_name: supplierName,\n        version: \"4.2\",\n        document_type: \"vehicle_service_invoice\",\n        extraction_rules: extractionRules,\n        vehicle_mapping: vehicleMapping,\n        template: template,\n        validation_rules: {\n            required_fields: [\"SUPNAME\", \"CODE\", \"DEBIT\", \"IVDATE\", \"BOOKNUM\"],\n            booknum_length: 7,\n            totquant_check: {\n                enabled: true,\n                compare_with_docs: true,\n                learned_reference: config.rules.validation_data.TOTQUANT || 1\n            }\n        }\n    };\n}\n\n// ============================================================================\n// נקודת כניסה - רק אם input מוגדר (סביבת Azure Functions)\n// ============================================================================\n\nif (typeof input !== 'undefined') {\n    const processInput = {\n        learned_config: input.learned_config,\n        docs_list: input.docs_list,\n        import_files: input.import_files,\n        AZURE_RESULT: input.AZURE_RESULT,\n        AZURE_TEXT: input.AZURE_TEXT\n    };\n\n    const result = processInvoiceComplete(processInput);\n\n    console.log(JSON.stringify(result));\n    return result;\n}\n\n// ============================================================================\n// ייצוא פונקציות למודול\n// ============================================================================\nmodule.exports = {\n    processInvoiceComplete\n};"
    }
]
