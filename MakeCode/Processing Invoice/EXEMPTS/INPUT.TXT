[
    {
        "input": [
            {
                "name": "learned_config",
                "value": {
                    "status": "success",
                    "supplier_id": "5014",
                    "supplier_name": "טכומטר-מכון ספידומטרים",
                    "vendor_tax_id_reference": "558117016",
                    "supplier_phone": "04-8247760",
                    "supplier_email": "",
                    "json_files_analyzed": 1,
                    "templates_detected": 1,
                    "config": {
                        "supplier_config": {
                            "supplier_code": "5014",
                            "supplier_name": "טכומטר-מכון ספידומטרים",
                            "vendor_tax_id_reference": "558117016"
                        },
                        "structure": [
                            {
                                "has_import": false,
                                "has_purchase_orders": false,
                                "has_doc": false,
                                "has_date_range": false,
                                "has_budcode": true,
                                "has_pdaccname": false,
                                "inventory_management": "not_managed_inventory",
                                "debit_type": "D"
                            }
                        ],
                        "rules": {
                            "invoice_date_format": "DD/MM/YY",
                            "doc_variation": "",
                            "validation_data": {
                                "TOTQUANT": 1
                            },
                            "critical_patterns": {
                                "vehicle_rules": {
                                    "partname": "car",
                                    "vehicle_account_mapping": {
                                        "741-69-103": {
                                            "accname": "66979",
                                            "accdes": "741-69-103 ליסינג והוצאות יוניון ירין לוזון",
                                            "vat_pattern": {
                                                "VATFLAG": "Y",
                                                "SPECIALVATFLAG": "Y"
                                            },
                                            "date_range_pattern": "never",
                                            "pdaccname_pattern": "never"
                                        }
                                    }
                                },
                                "partname_rules": {}
                            }
                        },
                        "document_types": [
                            {
                                "type": "חשבונית רגילה עם פירוט",
                                "accnames": [
                                    "66979"
                                ]
                            }
                        ]
                    },
                    "template": {
                        "PINVOICES": [
                            {
                                "SUPNAME": "5014",
                                "CODE": "ש\"ח",
                                "DEBIT": "D",
                                "IVDATE": "29/10/25",
                                "BOOKNUM": "288756",
                                "DETAILS": "התקנת מצלמה",
                                "PINVOICEITEMS_SUBFORM": [
                                    {
                                        "PARTNAME": "car",
                                        "PDES": "התקנת מצלמה כולל ציוד נלווה",
                                        "TQUANT": 1,
                                        "TUNITNAME": "יח'",
                                        "PRICE": 300,
                                        "VATFLAG": "Y",
                                        "ACCNAME": "66979",
                                        "SPECIALVATFLAG": "Y",
                                        "BUDCODE": "1.100-109"
                                    }
                                ]
                            }
                        ],
                        "document_types_count": 1
                    },
                    "recommended_samples": {
                        "samples": [
                            {
                                "sample_ivnum": "T128232",
                                "sample_booknum": "288756",
                                "sample_impfnum": "",
                                "sample_supname": "5014"
                            }
                        ]
                    }
                }
            },
            {
                "name": "docs_list",
                "value": {
                    "list_of_docs": null,
                    "DOC_YES_NO": "N"
                }
            },
            {
                "name": "import_files",
                "value": {
                    "IMPFILES": [
                        ""
                    ]
                }
            },
            {
                "name": "AZURE_RESULT",
                "value": {
                    "structure": {
                        "docType": "string",
                        "fields": {
                            "CustomerAddress": "string",
                            "CustomerAddress_houseNumber": "string",
                            "CustomerAddress_road": "string",
                            "CustomerAddress_streetAddress": "string",
                            "CustomerAddress_house": "string",
                            "CustomerAddressRecipient": "string",
                            "CustomerName": "string",
                            "CustomerTaxId": "string",
                            "InvoiceDate": "YYYY-MM-DD",
                            "InvoiceId": "string",
                            "InvoiceTotal_amount": "number",
                            "InvoiceTotal_currency": "string",
                            "PurchaseOrder": "string",
                            "SubTotal_amount": "number",
                            "SubTotal_currency": "string",
                            "TotalTax_amount": "number",
                            "TotalTax_currency": "string",
                            "VendorAddress": "string",
                            "VendorAddress_postalCode": "string",
                            "VendorAddress_house": "string",
                            "VendorAddressRecipient": "string",
                            "VendorName": "string",
                            "VendorTaxId": "string",
                            "VendorTel": "string",
                            "VendorFax": "string",
                            "InvoiceTime": "HH:MM:SS",
                            "PrintTime": "HH:MM:SS",
                            "UnidentifiedNumbers": [
                                "object"
                            ]
                        },
                        "Items": [
                            {
                                "Amount_amount": "number",
                                "Amount_currency": "string",
                                "Description": "string",
                                "Quantity": "number",
                                "UnitPrice_amount": "number",
                                "UnitPrice_currency": "string"
                            }
                        ]
                    },
                    "data": {
                        "docType": "invoice",
                        "fields": {
                            "CustomerAddress": "הקטיף 11\nא.ת עמק חפר",
                            "CustomerAddress_houseNumber": "11",
                            "CustomerAddress_road": "הקטיף",
                            "CustomerAddress_streetAddress": "11 הקטיף",
                            "CustomerAddress_house": "א.ת עמק חפר",
                            "CustomerAddressRecipient": "ט.פ. י פל ים בע״מ",
                            "CustomerName": "ט.פ. י פל ים בע״מ",
                            "CustomerTaxId": "513327064",
                            "InvoiceDate": "2025-10-22",
                            "InvoiceId": "288756 Ns",
                            "InvoiceTotal_amount": 354,
                            "InvoiceTotal_currency": "ILS",
                            "Items": [
                                {
                                    "Amount_amount": 300,
                                    "Amount_currency": "ILS",
                                    "Description": "התקנת מצלמה כולל ציוד נלווה",
                                    "Quantity": 1,
                                    "UnitPrice_amount": 300,
                                    "UnitPrice_currency": "ILS"
                                }
                            ],
                            "PurchaseOrder": "098947633:",
                            "SubTotal_amount": 300,
                            "SubTotal_currency": "ILS",
                            "TotalTax_amount": 54,
                            "TotalTax_currency": "ILS",
                            "VendorAddress": "א.ת עמק חפר ת.ד 12218",
                            "VendorAddress_postalCode": "12218",
                            "VendorAddress_house": "א.ת עמק חפר ת.ד",
                            "VendorAddressRecipient": "טכומטר-מכון ספידומטרים",
                            "VendorName": "מסמך ממוחשב\nחתום דיגיטלית\nקארדקום בע״מ",
                            "VendorTaxId": "558117016",
                            "VendorTel": "04-8247760",
                            "VendorFax": "04-8247761",
                            "InvoiceTime": "14:43",
                            "PrintTime": "14:42",
                            "UnidentifiedNumbers": [
                                {
                                    "label": "מס. כרטיס",
                                    "value": "103577"
                                },
                                {
                                    "label": "לפרעון",
                                    "value": "22/10/25"
                                },
                                {
                                    "label": "תכנון ויישום",
                                    "value": "אייל פתרונות תוכנה בע״מ"
                                }
                            ]
                        }
                    },
                    "metadata": {
                        "modelId": "prebuilt-invoice",
                        "totalFields": 29,
                        "uniqueDataFound": 3
                    },
                    "status": "success"
                }
            },
            {
                "name": "AZURE_TEXT",
                "value": "{\"status\":\"succeeded\",\"createdDateTime\":\"2025-11-05T08:27:49Z\",\"lastUpdatedDateTime\":\"2025-11-05T08:27:52Z\",\"analyzeResult\":{\"apiVersion\":\"2023-07-31\",\"modelId\":\"prebuilt-invoice\",\"stringIndexType\":\"textElements\",\"content\":\"טכומטר-מכון ספידומטרים\\nא.ת עמק חפר ת.ד 12218\\nגשר העץ 20\\nטלפון: 04-8247760\\n387001\\nפקס 04-8247761 ת.ד 12218\\nכיול ותיקון טכוגרפים וכל סוגי שעוני הרכב ומצלמות\\nתאריך\\n22/10/25:\\nחשבונית מס 288756 Ns\\n* נאמן למקור *\\nדף 1\\nתא׳ סיום\\n22/10/25 :\\n14:43\\nתא׳ הפקה 30/10/25\\nעוסק מורשה\\n558117016\\nתא׳ כניסה\\n22/10/25 :\\n14:42\\nמוסך מורשה:\\n4204\\nלכבוד\\nמס׳ לקוח\\n3730:\\nמס. כרטיס: 103577\\nט.פ. י פל ים בע״מ\\nסוג הרכב\\n: טויוטה\\nדגם\\n. .\\nהקטיף 11\\nמספר רישוי\\n:\\n741-69-103\\nמספר שילדה:\\nא.ת עמק חפר\\n0\\nשנת יצור\\n:\\nמספר מנוע\\n:\\nהערה\\nמסירה\\n:\\nטל׳ נייד\\n0505020057 :\\nטל׳עבודה\\n098947633:\\nת.זהות / ח.פ: 513327064\\nקוד עבודה\\nעבודות\\nז. תקן\\nסה״כ % הנחה סכום ש״ח\\nקוד פריט\\nחלפים\\nכמות\\n% הנחה יח׳ לצרכן\\nסכום ש״ח\\nהתקנת מצלמה כולל ציוד נלווה\\n1.00\\n300.00\\n300.00\\n1.00\\nסה״כ לעבודה\\n0.00\\nהערות:\\nסה״כ ע. חוץ\\n0.00\\nסה״כ חלפים\\n300.00\\nסה״כ\\n300.00\\nמ.ע.מ. % 18.00\\n54.00\\nתנאי תשלום:\\nלתשלום\\n354.00\\nאחריות לחלקים 3 חודשם מיום הוצאת החשבונית\\nלשירותכם תמיד ..\\nבכבוד רב,\\nעורך\\nלפרעון: 22/10/25\\nטכומטר-מכון ספידומטרים\\nעובד\\nחתימת הלקוח/ה\\nחתימת המאשר /ת:\\nתכנון ויישום: אייל פתרונות תוכנה בע״מ\\nמסמך ממוחשב\\nאחראי\\nחתום דיגיטלית\\nקארדקום בע״מ\",\"pages\":[{\"pageNumber\":1,\"angle\":0,\"width\":8.25,\"height\":11.6806,\"unit\":\"inch\",\"words\":[{\"content\":\"טכומטר-מכון\",\"polygon\":[5.6386,0.1217,7.3423,0.1267,7.3423,0.3701,5.6386,0.3802],\"confidence\":0.92,\"span\":{\"offset\":0,\"length\":11}},{\"content\":\"ספידומטרים\",\"polygon\":[4.087,0.1166,5.593,0.1217,5.593,0.3802,4.087,0.3752],\"confidence\":0.959,\"span\":{\"offset\":12,\"length\":10}},{\"content\":\"א.ת\",\"polygon\":[7.1294,0.4411,7.3221,0.436,7.317,0.583,7.1294,0.583],\"confidence\":0.982,\"span\":{\"offset\":23,\"length\":3}},{\"content\":\"עמק\",\"polygon\":[6.8201,0.4411,7.0685,0.4411,7.0685,0.583,6.8201,0.5779],\"confidence\":0.977,\"span\":{\"offset\":27,\"length\":3}},{\"content\":\"חפר\",\"polygon\":[6.5361,0.4411,6.7846,0.4411,6.7846,0.5779,6.5412,0.5779],\"confidence\":0.982,\"span\":{\"offset\":31,\"length\":3}},{\"content\":\"ת.ד\",\"polygon\":[6.2826,0.4411,6.5108,0.4411,6.5158,0.5779,6.2876,0.5779],\"confidence\":0.916,\"span\":{\"offset\":35,\"length\":3}},{\"content\":\"12218\",\"polygon\":[5.8921,0.4461,6.2522,0.4411,6.2522,0.5779,5.9023,0.5779],\"confidence\":0.982,\"span\":{\"offset\":39,\"length\":5}},{\"content\":\"גשר\",\"polygon\":[7.104,0.6084,7.3322,0.6084,7.3271,0.73,7.104,0.73],\"confidence\":0.982,\"span\":{\"offset\":45,\"length\":3}},{\"content\":\"העץ\",\"polygon\":[6.7947,0.6084,7.0584,0.6084,7.0584,0.73,6.7947,0.73],\"confidence\":0.976,\"span\":{\"offset\":49,\"length\":3}},{\"content\":\"20\",\"polygon\":[6.6172,0.6084,6.7694,0.6084,6.7694,0.73,6.6172,0.73],\"confidence\":0.982,\"span\":{\"offset\":53,\"length\":2}},{\"content\":\"טלפון:\",\"polygon\":[6.9418,0.73,7.3322,0.725,7.3373,0.8568,6.9418,0.8568],\"confidence\":0.982,\"span\":{\"offset\":56,\"length\":6}},{\"content\":\"04-8247760\",\"polygon\":[6.0848,0.73,6.7846,0.73,6.7896,0.8568,6.0848,0.8517],\"confidence\":0.938,\"span\":{\"offset\":63,\"length\":10}},{\"content\":\"387001\",\"polygon\":[5.5321,0.6185,5.953,0.6084,5.9581,0.73,5.5321,0.73],\"confidence\":0.966,\"span\":{\"offset\":74,\"length\":6}},{\"content\":\"פקס\",\"polygon\":[7.1142,1.384,7.3373,1.384,7.3322,1.526,7.1091,1.5209],\"confidence\":0.982,\"span\":{\"offset\":81,\"length\":3}},{\"content\":\"04-8247761\",\"polygon\":[6.4398,1.384,7.0736,1.384,7.0685,1.5209,6.4398,1.5108],\"confidence\":0.961,\"span\":{\"offset\":85,\"length\":10}},{\"content\":\"ת.ד\",\"polygon\":[6.1355,1.384,6.3434,1.384,6.3485,1.5108,6.1406,1.5108],\"confidence\":0.961,\"span\":{\"offset\":96,\"length\":3}},{\"content\":\"12218\",\"polygon\":[5.7806,1.384,6.1051,1.384,6.1051,1.5108,5.7806,1.5108],\"confidence\":0.98,\"span\":{\"offset\":100,\"length\":5}},{\"content\":\"כיול\",\"polygon\":[4.5281,1.3688,4.7817,1.3688,4.7817,1.5209,4.5281,1.5209],\"confidence\":0.982,\"span\":{\"offset\":106,\"length\":4}},{\"content\":\"ותיקון\",\"polygon\":[4.1326,1.3637,4.4977,1.3637,4.4977,1.5209,4.1326,1.5209],\"confidence\":0.957,\"span\":{\"offset\":111,\"length\":6}},{\"content\":\"טכוגרפים\",\"polygon\":[3.6205,1.3637,4.1022,1.3637,4.1022,1.5209,3.6205,1.5209],\"confidence\":0.961,\"span\":{\"offset\":118,\"length\":8}},{\"content\":\"וכל\",\"polygon\":[3.3771,1.3637,3.59,1.3637,3.59,1.5209,3.3771,1.5209],\"confidence\":0.982,\"span\":{\"offset\":127,\"length\":3}},{\"content\":\"סוגי\",\"polygon\":[3.0931,1.3637,3.3467,1.3637,3.3467,1.5209,3.0931,1.5209],\"confidence\":0.953,\"span\":{\"offset\":131,\"length\":4}},{\"content\":\"שעוני\",\"polygon\":[2.7534,1.3688,3.0627,1.3637,3.0627,1.5209,2.7585,1.5209],\"confidence\":0.982,\"span\":{\"offset\":136,\"length\":5}},{\"content\":\"הרכב\",\"polygon\":[2.4491,1.3688,2.723,1.3688,2.728,1.5209,2.4491,1.5209],\"confidence\":0.982,\"span\":{\"offset\":142,\"length\":4}},{\"content\":\"ומצלמות\",\"polygon\":[1.937,1.3688,2.4187,1.3688,2.4187,1.5209,1.9421,1.5209],\"confidence\":0.976,\"span\":{\"offset\":147,\"length\":7}},{\"content\":\"תאריך\",\"polygon\":[6.9316,1.597,7.3322,1.597,7.3373,1.7643,6.9367,1.7693],\"confidence\":0.979,\"span\":{\"offset\":155,\"length\":5}},{\"content\":\"22/10/25:\",\"polygon\":[6.095,1.5868,6.7643,1.5919,6.7694,1.7643,6.095,1.7643],\"confidence\":0.746,\"span\":{\"offset\":161,\"length\":9}},{\"content\":\"חשבונית\",\"polygon\":[4.736,1.6527,5.3293,1.6578,5.3293,1.8251,4.736,1.8302],\"confidence\":0.961,\"span\":{\"offset\":171,\"length\":7}},{\"content\":\"מס\",\"polygon\":[4.4419,1.6527,4.6802,1.6527,4.6802,1.8302,4.4419,1.8352],\"confidence\":0.98,\"span\":{\"offset\":179,\"length\":2}},{\"content\":\"288756\",\"polygon\":[3.8537,1.6476,4.3963,1.6527,4.3963,1.8352,3.8537,1.8302],\"confidence\":0.95,\"span\":{\"offset\":182,\"length\":6}},{\"content\":\"Ns\",\"polygon\":[3.585,1.6476,3.8182,1.6476,3.8182,1.8302,3.585,1.8302],\"confidence\":0.714,\"span\":{\"offset\":189,\"length\":2}},{\"content\":\"*\",\"polygon\":[2.6215,1.6578,2.7128,1.6629,2.7179,1.82,2.6266,1.8251],\"confidence\":0.966,\"span\":{\"offset\":192,\"length\":1}},{\"content\":\"נאמן\",\"polygon\":[2.2514,1.6578,2.5911,1.6578,2.5911,1.8302,2.2514,1.8454],\"confidence\":0.982,\"span\":{\"offset\":194,\"length\":4}},{\"content\":\"למקור\",\"polygon\":[1.7849,1.6629,2.2159,1.6578,2.2159,1.8454,1.7798,1.8302],\"confidence\":0.982,\"span\":{\"offset\":199,\"length\":5}},{\"content\":\"*\",\"polygon\":[1.6683,1.6679,1.7392,1.6629,1.7392,1.8251,1.6683,1.82],\"confidence\":0.982,\"span\":{\"offset\":205,\"length\":1}},{\"content\":\"דף\",\"polygon\":[1.1358,1.6071,1.2981,1.6071,1.2981,1.7795,1.1358,1.7795],\"confidence\":0.961,\"span\":{\"offset\":207,\"length\":2}},{\"content\":\"1\",\"polygon\":[1.0446,1.6071,1.0953,1.6071,1.0953,1.7795,1.0446,1.7795],\"confidence\":0.862,\"span\":{\"offset\":210,\"length\":1}},{\"content\":\"תא׳\",\"polygon\":[7.0685,1.8859,7.3322,1.8809,7.3322,2.0532,7.0685,2.0532],\"confidence\":0.872,\"span\":{\"offset\":212,\"length\":3}},{\"content\":\"סיום\",\"polygon\":[6.8049,1.891,7.033,1.8859,7.033,2.0532,6.8049,2.0532],\"confidence\":0.977,\"span\":{\"offset\":216,\"length\":4}},{\"content\":\"22/10/25\",\"polygon\":[5.8465,1.9011,6.4195,1.9011,6.4195,2.0431,5.8516,2.0431],\"confidence\":0.976,\"span\":{\"offset\":221,\"length\":8}},{\"content\":\":\",\"polygon\":[6.4651,1.9062,6.5513,1.9062,6.5513,2.0482,6.4651,2.0482],\"confidence\":0.73,\"span\":{\"offset\":230,\"length\":1}},{\"content\":\"14:43\",\"polygon\":[5.4104,1.9011,5.7502,1.8961,5.7502,2.0329,5.4104,2.038],\"confidence\":0.976,\"span\":{\"offset\":232,\"length\":5}},{\"content\":\"תא׳\",\"polygon\":[4.4368,1.8859,4.7005,1.8859,4.7005,2.0532,4.4368,2.0532],\"confidence\":0.858,\"span\":{\"offset\":238,\"length\":3}},{\"content\":\"הפקה\",\"polygon\":[4.0616,1.891,4.4014,1.8859,4.4014,2.0532,4.0616,2.0583],\"confidence\":0.982,\"span\":{\"offset\":242,\"length\":4}},{\"content\":\"30/10/25\",\"polygon\":[3.3213,1.8859,3.8841,1.891,3.8841,2.0583,3.3213,2.0583],\"confidence\":0.965,\"span\":{\"offset\":247,\"length\":8}},{\"content\":\"עוסק\",\"polygon\":[2.3832,1.9011,2.657,1.8961,2.657,2.038,2.3832,2.038],\"confidence\":0.964,\"span\":{\"offset\":256,\"length\":4}},{\"content\":\"מורשה\",\"polygon\":[1.9978,1.9113,2.3579,1.9011,2.3579,2.0329,2.0029,2.0329],\"confidence\":0.982,\"span\":{\"offset\":261,\"length\":5}},{\"content\":\"558117016\",\"polygon\":[0.9837,1.9163,1.6277,1.9113,1.6328,2.038,0.9837,2.0329],\"confidence\":0.961,\"span\":{\"offset\":267,\"length\":9}},{\"content\":\"תא׳\",\"polygon\":[7.0888,2.0684,7.3322,2.0684,7.3373,2.1901,7.0939,2.1952],\"confidence\":0.876,\"span\":{\"offset\":277,\"length\":3}},{\"content\":\"כניסה\",\"polygon\":[6.7339,2.0735,7.0635,2.0684,7.0685,2.1952,6.7389,2.2053],\"confidence\":0.982,\"span\":{\"offset\":281,\"length\":5}},{\"content\":\"22/10/25\",\"polygon\":[5.8516,2.0684,6.4195,2.0684,6.4195,2.2104,5.8566,2.2053],\"confidence\":0.976,\"span\":{\"offset\":287,\"length\":8}},{\"content\":\":\",\"polygon\":[6.4651,2.0684,6.5463,2.0735,6.5463,2.2104,6.4651,2.2104],\"confidence\":0.961,\"span\":{\"offset\":296,\"length\":1}},{\"content\":\"14:42\",\"polygon\":[5.4053,2.0684,5.7299,2.0684,5.7299,2.185,5.4053,2.1901],\"confidence\":0.982,\"span\":{\"offset\":298,\"length\":5}},{\"content\":\"מוסך\",\"polygon\":[2.3832,2.0684,2.6722,2.0684,2.6722,2.2104,2.3883,2.2104],\"confidence\":0.982,\"span\":{\"offset\":304,\"length\":4}},{\"content\":\"מורשה:\",\"polygon\":[1.9066,2.0735,2.3528,2.0684,2.3528,2.2104,1.9066,2.2053],\"confidence\":0.961,\"span\":{\"offset\":309,\"length\":6}},{\"content\":\"4204\",\"polygon\":[1.3184,2.0786,1.6175,2.0786,1.6175,2.2002,1.3133,2.2002],\"confidence\":0.951,\"span\":{\"offset\":316,\"length\":4}},{\"content\":\"לכבוד\",\"polygon\":[6.9519,2.5703,7.2866,2.5653,7.2866,2.6819,6.957,2.692],\"confidence\":0.981,\"span\":{\"offset\":321,\"length\":5}},{\"content\":\"מס׳\",\"polygon\":[4.8932,2.5653,5.1315,2.5602,5.1315,2.7072,4.8932,2.7072],\"confidence\":0.859,\"span\":{\"offset\":327,\"length\":3}},{\"content\":\"לקוח\",\"polygon\":[4.5991,2.5653,4.8628,2.5653,4.8628,2.7072,4.6042,2.7123],\"confidence\":0.963,\"span\":{\"offset\":331,\"length\":4}},{\"content\":\"3730:\",\"polygon\":[4.0008,2.5754,4.3861,2.5703,4.3861,2.7072,4.0008,2.7072],\"confidence\":0.926,\"span\":{\"offset\":336,\"length\":5}},{\"content\":\"מס.\",\"polygon\":[2.8244,2.5703,3.0526,2.5703,3.0526,2.7021,2.8244,2.7021],\"confidence\":0.982,\"span\":{\"offset\":342,\"length\":3}},{\"content\":\"כרטיס:\",\"polygon\":[2.2514,2.5754,2.799,2.5703,2.799,2.7021,2.2514,2.7021],\"confidence\":0.978,\"span\":{\"offset\":346,\"length\":6}},{\"content\":\"103577\",\"polygon\":[1.7849,2.5754,2.226,2.5754,2.226,2.7021,1.7849,2.7021],\"confidence\":0.982,\"span\":{\"offset\":353,\"length\":6}},{\"content\":\"ט.פ.\",\"polygon\":[7.033,2.7376,7.2967,2.7376,7.2967,2.8644,7.033,2.8644],\"confidence\":0.982,\"span\":{\"offset\":360,\"length\":4}},{\"content\":\"י\",\"polygon\":[7.0026,2.7376,7.0077,2.7376,7.0077,2.8644,7.0026,2.8644],\"confidence\":0.982,\"span\":{\"offset\":365,\"length\":1}},{\"content\":\"פל\",\"polygon\":[6.8302,2.7376,6.9773,2.7376,6.9773,2.8644,6.8302,2.8644],\"confidence\":0.982,\"span\":{\"offset\":367,\"length\":2}},{\"content\":\"ים\",\"polygon\":[6.6832,2.7376,6.8049,2.7376,6.8049,2.8644,6.6832,2.8644],\"confidence\":0.981,\"span\":{\"offset\":370,\"length\":2}},{\"content\":\"בע״מ\",\"polygon\":[6.3536,2.7376,6.6426,2.7376,6.6426,2.8644,6.3586,2.8644],\"confidence\":0.894,\"span\":{\"offset\":373,\"length\":4}},{\"content\":\"סוג\",\"polygon\":[4.9439,2.7478,5.1315,2.7427,5.1315,2.8745,4.949,2.8745],\"confidence\":0.982,\"span\":{\"offset\":378,\"length\":3}},{\"content\":\"הרכב\",\"polygon\":[4.6295,2.7478,4.9186,2.7478,4.9236,2.8745,4.6346,2.8796],\"confidence\":0.982,\"span\":{\"offset\":382,\"length\":4}},{\"content\":\":\",\"polygon\":[4.3101,2.7427,4.3811,2.7427,4.3811,2.8796,4.3101,2.8796],\"confidence\":0.954,\"span\":{\"offset\":387,\"length\":1}},{\"content\":\"טויוטה\",\"polygon\":[3.9044,2.7427,4.2847,2.7427,4.2797,2.8796,3.9095,2.8796],\"confidence\":0.98,\"span\":{\"offset\":389,\"length\":6}},{\"content\":\"דגם\",\"polygon\":[2.8649,2.7528,3.0627,2.7478,3.0627,2.8694,2.87,2.8745],\"confidence\":0.982,\"span\":{\"offset\":396,\"length\":3}},{\"content\":\".\",\"polygon\":[2.3072,2.7934,2.3072,2.8086,2.2717,2.8086,2.2717,2.7934],\"confidence\":0.551,\"span\":{\"offset\":400,\"length\":1}},{\"content\":\".\",\"polygon\":[2.3072,2.834,2.3072,2.8593,2.2717,2.8593,2.2717,2.834],\"confidence\":0.882,\"span\":{\"offset\":402,\"length\":1}},{\"content\":\"הקטיף\",\"polygon\":[6.9468,2.9151,7.2967,2.9049,7.2967,3.0418,6.9468,3.0367],\"confidence\":0.966,\"span\":{\"offset\":404,\"length\":5}},{\"content\":\"11\",\"polygon\":[6.7744,2.9151,6.8961,2.9151,6.9012,3.0367,6.7744,3.0317],\"confidence\":0.982,\"span\":{\"offset\":410,\"length\":2}},{\"content\":\"מספר\",\"polygon\":[4.8526,2.9049,5.1417,2.9049,5.1417,3.0367,4.8526,3.0266],\"confidence\":0.982,\"span\":{\"offset\":413,\"length\":4}},{\"content\":\"רישוי\",\"polygon\":[4.4977,2.9049,4.8222,2.9049,4.8222,3.0266,4.5028,3.0266],\"confidence\":0.961,\"span\":{\"offset\":418,\"length\":5}},{\"content\":\":\",\"polygon\":[4.3456,2.9252,4.3861,2.9201,4.3963,3.0266,4.3456,3.0317],\"confidence\":0.954,\"span\":{\"offset\":424,\"length\":1}},{\"content\":\"741-69-103\",\"polygon\":[3.3974,2.91,4.0616,2.9151,4.0616,3.052,3.4024,3.052],\"confidence\":0.961,\"span\":{\"offset\":426,\"length\":10}},{\"content\":\"מספר\",\"polygon\":[2.7737,2.8999,3.0576,2.9049,3.0576,3.0317,2.7737,3.0266],\"confidence\":0.982,\"span\":{\"offset\":437,\"length\":4}},{\"content\":\"שילדה:\",\"polygon\":[2.2818,2.9201,2.728,2.8999,2.728,3.0266,2.2818,3.0317],\"confidence\":0.934,\"span\":{\"offset\":442,\"length\":6}},{\"content\":\"א.ת\",\"polygon\":[7.099,3.0824,7.2663,3.0824,7.2714,3.2091,7.099,3.2091],\"confidence\":0.982,\"span\":{\"offset\":449,\"length\":3}},{\"content\":\"עמק\",\"polygon\":[6.815,3.0824,7.0432,3.0824,7.0432,3.2091,6.815,3.2091],\"confidence\":0.976,\"span\":{\"offset\":453,\"length\":3}},{\"content\":\"חפר\",\"polygon\":[6.5564,3.0874,6.7846,3.0824,6.7846,3.2091,6.5564,3.2091],\"confidence\":0.982,\"span\":{\"offset\":457,\"length\":3}},{\"content\":\"0\",\"polygon\":[5.8972,3.0925,5.9581,3.0925,5.953,3.204,5.8921,3.199],\"confidence\":0.947,\"span\":{\"offset\":461,\"length\":1}},{\"content\":\"שנת\",\"polygon\":[4.9287,3.0824,5.1315,3.0824,5.1315,3.2091,4.9338,3.204],\"confidence\":0.982,\"span\":{\"offset\":463,\"length\":3}},{\"content\":\"יצור\",\"polygon\":[4.6549,3.0824,4.8932,3.0824,4.8932,3.204,4.6549,3.2091],\"confidence\":0.982,\"span\":{\"offset\":467,\"length\":4}},{\"content\":\":\",\"polygon\":[4.3456,3.1026,4.3912,3.1026,4.3912,3.204,4.3456,3.204],\"confidence\":0.955,\"span\":{\"offset\":472,\"length\":1}},{\"content\":\"מספר\",\"polygon\":[2.7686,3.0824,3.0678,3.0824,3.0678,3.2142,2.7686,3.2091],\"confidence\":0.982,\"span\":{\"offset\":474,\"length\":4}},{\"content\":\"מנוע\",\"polygon\":[2.4796,3.0824,2.7432,3.0824,2.7432,3.2091,2.4796,3.2091],\"confidence\":0.982,\"span\":{\"offset\":479,\"length\":4}},{\"content\":\":\",\"polygon\":[2.2666,3.1026,2.3173,3.1026,2.3173,3.2091,2.2666,3.2091],\"confidence\":0.92,\"span\":{\"offset\":484,\"length\":1}},{\"content\":\"הערה\",\"polygon\":[2.7635,3.2699,3.0728,3.2649,3.0779,3.3916,2.7635,3.3967],\"confidence\":0.98,\"span\":{\"offset\":486,\"length\":4}},{\"content\":\"מסירה\",\"polygon\":[4.8121,3.417,5.1265,3.417,5.1265,3.5386,4.8121,3.5386],\"confidence\":0.982,\"span\":{\"offset\":491,\"length\":5}},{\"content\":\":\",\"polygon\":[4.3253,3.4372,4.3659,3.4372,4.3659,3.5386,4.3253,3.5386],\"confidence\":0.961,\"span\":{\"offset\":497,\"length\":1}},{\"content\":\"טל׳\",\"polygon\":[2.8396,3.4068,3.0475,3.4068,3.0475,3.5285,2.8396,3.5234],\"confidence\":0.871,\"span\":{\"offset\":499,\"length\":3}},{\"content\":\"נייד\",\"polygon\":[2.6165,3.4119,2.8142,3.4068,2.8193,3.5234,2.6215,3.5234],\"confidence\":0.934,\"span\":{\"offset\":503,\"length\":4}},{\"content\":\"0505020057\",\"polygon\":[1.4806,3.4271,2.1956,3.422,2.1956,3.5437,1.4806,3.5437],\"confidence\":0.954,\"span\":{\"offset\":508,\"length\":10}},{\"content\":\":\",\"polygon\":[2.2412,3.422,2.3072,3.4271,2.3021,3.5437,2.2412,3.5437],\"confidence\":0.961,\"span\":{\"offset\":519,\"length\":1}},{\"content\":\"טל׳עבודה\",\"polygon\":[6.7541,3.5995,7.3221,3.5944,7.3221,3.7364,6.7541,3.7364],\"confidence\":0.829,\"span\":{\"offset\":521,\"length\":8}},{\"content\":\"098947633:\",\"polygon\":[5.7755,3.6045,6.5158,3.5995,6.5108,3.7414,5.7755,3.7364],\"confidence\":0.875,\"span\":{\"offset\":530,\"length\":10}},{\"content\":\"ת.זהות\",\"polygon\":[4.7766,3.5691,5.1366,3.5691,5.1366,3.7009,4.7817,3.7059],\"confidence\":0.939,\"span\":{\"offset\":541,\"length\":6}},{\"content\":\"/\",\"polygon\":[4.6498,3.564,4.736,3.564,4.736,3.7059,4.6498,3.7059],\"confidence\":0.982,\"span\":{\"offset\":548,\"length\":1}},{\"content\":\"ח.פ:\",\"polygon\":[4.3202,3.564,4.6245,3.564,4.6245,3.7059,4.3202,3.711],\"confidence\":0.892,\"span\":{\"offset\":550,\"length\":4}},{\"content\":\"513327064\",\"polygon\":[3.6458,3.5691,4.2898,3.564,4.2949,3.711,3.6509,3.7059],\"confidence\":0.961,\"span\":{\"offset\":555,\"length\":9}},{\"content\":\"קוד\",\"polygon\":[7.028,4.1521,7.2308,4.1521,7.2308,4.294,7.028,4.289],\"confidence\":0.98,\"span\":{\"offset\":565,\"length\":3}},{\"content\":\"עבודה\",\"polygon\":[6.6274,4.147,6.9925,4.1521,6.9925,4.289,6.6325,4.289],\"confidence\":0.976,\"span\":{\"offset\":569,\"length\":5}},{\"content\":\"עבודות\",\"polygon\":[4.7107,4.1166,5.1518,4.1115,5.1569,4.2687,4.7107,4.2636],\"confidence\":0.982,\"span\":{\"offset\":575,\"length\":6}},{\"content\":\"ז.\",\"polygon\":[3.3821,4.1724,3.4937,4.1724,3.4937,4.2991,3.3821,4.2991],\"confidence\":0.951,\"span\":{\"offset\":582,\"length\":2}},{\"content\":\"תקן\",\"polygon\":[3.1692,4.1724,3.3568,4.1724,3.3568,4.2991,3.1742,4.2991],\"confidence\":0.878,\"span\":{\"offset\":585,\"length\":3}},{\"content\":\"סה״כ\",\"polygon\":[2.5252,4.1774,2.8294,4.1774,2.8294,4.3143,2.5252,4.3194],\"confidence\":0.975,\"span\":{\"offset\":589,\"length\":4}},{\"content\":\"%\",\"polygon\":[2.1703,4.1724,2.2565,4.1724,2.2565,4.3194,2.1703,4.3194],\"confidence\":0.982,\"span\":{\"offset\":594,\"length\":1}},{\"content\":\"הנחה\",\"polygon\":[1.795,4.1724,2.1094,4.1724,2.1094,4.3194,1.795,4.3194],\"confidence\":0.982,\"span\":{\"offset\":596,\"length\":4}},{\"content\":\"סכום\",\"polygon\":[1.4096,4.1774,1.7037,4.1724,1.7037,4.3194,1.4147,4.3194],\"confidence\":0.982,\"span\":{\"offset\":601,\"length\":4}},{\"content\":\"ש״ח\",\"polygon\":[1.1206,4.1774,1.3488,4.1774,1.3488,4.3194,1.1257,4.3194],\"confidence\":0.982,\"span\":{\"offset\":606,\"length\":3}},{\"content\":\"קוד\",\"polygon\":[6.6882,4.5019,6.9266,4.4968,6.9266,4.6844,6.6882,4.6844],\"confidence\":0.976,\"span\":{\"offset\":610,\"length\":3}},{\"content\":\"פריט\",\"polygon\":[6.3688,4.507,6.6527,4.5019,6.6527,4.6844,6.3688,4.6793],\"confidence\":0.982,\"span\":{\"offset\":614,\"length\":4}},{\"content\":\"חלפים\",\"polygon\":[4.589,4.5019,5.2025,4.4968,5.2025,4.6743,4.589,4.6692],\"confidence\":0.982,\"span\":{\"offset\":619,\"length\":5}},{\"content\":\"כמות\",\"polygon\":[3.3669,4.4968,3.6762,4.4968,3.6712,4.6743,3.3619,4.6692],\"confidence\":0.982,\"span\":{\"offset\":625,\"length\":4}},{\"content\":\"%\",\"polygon\":[3.0221,4.512,3.1083,4.5171,3.1083,4.659,3.0221,4.659],\"confidence\":0.982,\"span\":{\"offset\":630,\"length\":1}},{\"content\":\"הנחה\",\"polygon\":[2.6469,4.512,2.9663,4.512,2.9663,4.659,2.652,4.6641],\"confidence\":0.982,\"span\":{\"offset\":632,\"length\":4}},{\"content\":\"יח׳\",\"polygon\":[2.3427,4.512,2.5708,4.512,2.5759,4.6641,2.3477,4.6641],\"confidence\":0.807,\"span\":{\"offset\":637,\"length\":3}},{\"content\":\"לצרכן\",\"polygon\":[1.9624,4.5171,2.3173,4.512,2.3173,4.6641,1.9674,4.6641],\"confidence\":0.982,\"span\":{\"offset\":641,\"length\":5}},{\"content\":\"סכום\",\"polygon\":[1.4451,4.5222,1.7291,4.5222,1.7291,4.659,1.4451,4.654],\"confidence\":0.982,\"span\":{\"offset\":647,\"length\":4}},{\"content\":\"ש״ח\",\"polygon\":[1.1561,4.5222,1.3792,4.5222,1.3792,4.654,1.1561,4.654],\"confidence\":0.982,\"span\":{\"offset\":652,\"length\":3}},{\"content\":\"התקנת\",\"polygon\":[5.5423,4.7249,5.9581,4.7249,5.953,4.9075,5.5423,4.9075],\"confidence\":0.975,\"span\":{\"offset\":656,\"length\":5}},{\"content\":\"מצלמה\",\"polygon\":[5.0758,4.7249,5.5118,4.7249,5.5068,4.9075,5.0758,4.9075],\"confidence\":0.982,\"span\":{\"offset\":662,\"length\":5}},{\"content\":\"כולל\",\"polygon\":[4.7259,4.7249,5.0403,4.7249,5.0403,4.9075,4.7259,4.9024],\"confidence\":0.982,\"span\":{\"offset\":668,\"length\":4}},{\"content\":\"ציוד\",\"polygon\":[4.4267,4.7249,4.6904,4.7249,4.6904,4.9024,4.4216,4.8973],\"confidence\":0.982,\"span\":{\"offset\":673,\"length\":4}},{\"content\":\"נלווה\",\"polygon\":[4.087,4.7249,4.3912,4.7249,4.3861,4.8973,4.0819,4.8922],\"confidence\":0.934,\"span\":{\"offset\":678,\"length\":5}},{\"content\":\"1.00\",\"polygon\":[3.4836,4.7503,3.7371,4.7503,3.7371,4.877,3.4836,4.877],\"confidence\":0.961,\"span\":{\"offset\":684,\"length\":4}},{\"content\":\"300.00\",\"polygon\":[2.1956,4.7199,2.6215,4.7199,2.6215,4.9024,2.1956,4.9075],\"confidence\":0.981,\"span\":{\"offset\":689,\"length\":6}},{\"content\":\"300.00\",\"polygon\":[1.3285,4.7503,1.7443,4.7554,1.7443,4.8821,1.3336,4.877],\"confidence\":0.982,\"span\":{\"offset\":696,\"length\":6}},{\"content\":\"1.00\",\"polygon\":[3.4836,4.9227,3.7371,4.9227,3.7371,5.0494,3.4836,5.0443],\"confidence\":0.982,\"span\":{\"offset\":703,\"length\":4}},{\"content\":\"סה״כ\",\"polygon\":[2.6368,5.3739,2.9461,5.3789,2.9461,5.5158,2.6368,5.5209],\"confidence\":0.981,\"span\":{\"offset\":708,\"length\":4}},{\"content\":\"לעבודה\",\"polygon\":[2.155,5.3739,2.5911,5.3739,2.5911,5.5209,2.155,5.5209],\"confidence\":0.961,\"span\":{\"offset\":713,\"length\":6}},{\"content\":\"0.00\",\"polygon\":[1.4806,5.3891,1.7392,5.3891,1.7392,5.5158,1.4756,5.5158],\"confidence\":0.982,\"span\":{\"offset\":720,\"length\":4}},{\"content\":\"הערות:\",\"polygon\":[6.8606,5.5564,7.3474,5.5513,7.3474,5.6882,6.8606,5.678],\"confidence\":0.961,\"span\":{\"offset\":725,\"length\":6}},{\"content\":\"סה״כ\",\"polygon\":[2.6418,5.5513,2.9461,5.5462,2.9511,5.678,2.6469,5.678],\"confidence\":0.98,\"span\":{\"offset\":732,\"length\":4}},{\"content\":\"ע.\",\"polygon\":[2.4238,5.5513,2.586,5.5513,2.586,5.6831,2.4289,5.6831],\"confidence\":0.962,\"span\":{\"offset\":737,\"length\":2}},{\"content\":\"חוץ\",\"polygon\":[2.2362,5.5513,2.3984,5.5513,2.4035,5.6831,2.2412,5.6831],\"confidence\":0.976,\"span\":{\"offset\":740,\"length\":3}},{\"content\":\"0.00\",\"polygon\":[1.4756,5.5564,1.7291,5.5564,1.7291,5.678,1.4756,5.673],\"confidence\":0.993,\"span\":{\"offset\":744,\"length\":4}},{\"content\":\"סה״כ\",\"polygon\":[2.6418,5.7085,2.9461,5.7034,2.9461,5.8403,2.6469,5.8403],\"confidence\":0.98,\"span\":{\"offset\":749,\"length\":4}},{\"content\":\"חלפים\",\"polygon\":[2.221,5.7085,2.6013,5.7085,2.6063,5.8403,2.226,5.8403],\"confidence\":0.982,\"span\":{\"offset\":754,\"length\":5}},{\"content\":\"300.00\",\"polygon\":[1.3336,5.7287,1.7342,5.7237,1.7342,5.8403,1.3336,5.8352],\"confidence\":0.982,\"span\":{\"offset\":760,\"length\":6}},{\"content\":\"סה״כ\",\"polygon\":[2.6469,6.0431,2.9511,6.038,2.9511,6.1647,2.6469,6.1698],\"confidence\":0.98,\"span\":{\"offset\":767,\"length\":4}},{\"content\":\"300.00\",\"polygon\":[1.3336,6.0532,1.724,6.0481,1.7291,6.1698,1.3387,6.1698],\"confidence\":0.995,\"span\":{\"offset\":772,\"length\":6}},{\"content\":\"מ.ע.מ.\",\"polygon\":[2.5201,6.2357,2.9359,6.2357,2.9359,6.3675,2.5252,6.3675],\"confidence\":0.954,\"span\":{\"offset\":779,\"length\":6}},{\"content\":\"%\",\"polygon\":[2.4796,6.2357,2.4948,6.2357,2.4998,6.3675,2.4796,6.3675],\"confidence\":0.982,\"span\":{\"offset\":786,\"length\":1}},{\"content\":\"18.00\",\"polygon\":[2.0283,6.2306,2.368,6.2357,2.3731,6.3675,2.0333,6.3675],\"confidence\":0.982,\"span\":{\"offset\":788,\"length\":5}},{\"content\":\"54.00\",\"polygon\":[1.3995,6.2357,1.7342,6.2357,1.7392,6.3574,1.3995,6.3625],\"confidence\":0.961,\"span\":{\"offset\":794,\"length\":5}},{\"content\":\"תנאי\",\"polygon\":[7.0077,6.5145,7.3271,6.5196,7.3322,6.6818,7.0077,6.6869],\"confidence\":0.982,\"span\":{\"offset\":800,\"length\":4}},{\"content\":\"תשלום:\",\"polygon\":[6.5513,6.5145,6.9722,6.5145,6.9773,6.6869,6.5513,6.6869],\"confidence\":0.974,\"span\":{\"offset\":805,\"length\":6}},{\"content\":\"לתשלום\",\"polygon\":[2.4644,6.5348,2.9309,6.5298,2.9309,6.6717,2.4644,6.6717],\"confidence\":0.982,\"span\":{\"offset\":812,\"length\":6}},{\"content\":\"354.00\",\"polygon\":[1.3285,6.5247,1.7392,6.5247,1.7443,6.6514,1.3336,6.6514],\"confidence\":0.982,\"span\":{\"offset\":819,\"length\":6}},{\"content\":\"אחריות\",\"polygon\":[6.2724,6.839,6.5767,6.839,6.5817,6.9607,6.2724,6.9607],\"confidence\":0.981,\"span\":{\"offset\":826,\"length\":6}},{\"content\":\"לחלקים\",\"polygon\":[5.8972,6.839,6.242,6.839,6.242,6.9607,5.9023,6.9607],\"confidence\":0.965,\"span\":{\"offset\":833,\"length\":6}},{\"content\":\"3\",\"polygon\":[5.7958,6.839,5.8668,6.839,5.8718,6.9607,5.7958,6.9607],\"confidence\":0.982,\"span\":{\"offset\":840,\"length\":1}},{\"content\":\"חודשם\",\"polygon\":[5.4966,6.839,5.7704,6.839,5.7704,6.9607,5.4966,6.9607],\"confidence\":0.982,\"span\":{\"offset\":842,\"length\":5}},{\"content\":\"מיום\",\"polygon\":[5.2684,6.839,5.4713,6.839,5.4713,6.9607,5.2684,6.9607],\"confidence\":0.982,\"span\":{\"offset\":848,\"length\":4}},{\"content\":\"הוצאת\",\"polygon\":[4.9541,6.839,5.2431,6.839,5.2482,6.9607,4.9541,6.9607],\"confidence\":0.98,\"span\":{\"offset\":853,\"length\":5}},{\"content\":\"החשבונית\",\"polygon\":[4.4926,6.839,4.9287,6.839,4.9287,6.9607,4.4926,6.9607],\"confidence\":0.973,\"span\":{\"offset\":859,\"length\":8}},{\"content\":\"לשירותכם\",\"polygon\":[6.1457,6.981,6.5767,6.9759,6.5767,7.0925,6.1457,7.0824],\"confidence\":0.976,\"span\":{\"offset\":868,\"length\":8}},{\"content\":\"תמיד\",\"polygon\":[5.8871,6.981,6.1203,6.981,6.1203,7.0824,5.8871,7.0824],\"confidence\":0.934,\"span\":{\"offset\":877,\"length\":4}},{\"content\":\"..\",\"polygon\":[5.8262,6.986,5.8668,6.981,5.8668,7.0824,5.8262,7.0824],\"confidence\":0.963,\"span\":{\"offset\":882,\"length\":2}},{\"content\":\"בכבוד\",\"polygon\":[2.5455,9.891,2.9207,9.8859,2.9207,10.0177,2.5506,10.0228],\"confidence\":0.982,\"span\":{\"offset\":885,\"length\":5}},{\"content\":\"רב,\",\"polygon\":[2.3072,9.896,2.5151,9.891,2.5201,10.0228,2.3072,10.0278],\"confidence\":0.982,\"span\":{\"offset\":891,\"length\":3}},{\"content\":\"עורך\",\"polygon\":[7.0533,10.1394,7.3119,10.1394,7.3119,10.261,7.0533,10.261],\"confidence\":0.982,\"span\":{\"offset\":895,\"length\":4}},{\"content\":\"לפרעון:\",\"polygon\":[5.9378,10.1242,6.4195,10.1242,6.4246,10.2712,5.9428,10.2763],\"confidence\":0.976,\"span\":{\"offset\":900,\"length\":7}},{\"content\":\"22/10/25\",\"polygon\":[5.2989,10.1242,5.8617,10.1242,5.8668,10.2763,5.3039,10.2763],\"confidence\":0.976,\"span\":{\"offset\":908,\"length\":8}},{\"content\":\"טכומטר-מכון\",\"polygon\":[2.586,10.043,3.3669,10.038,3.3669,10.185,2.586,10.185],\"confidence\":0.938,\"span\":{\"offset\":917,\"length\":11}},{\"content\":\"ספידומטרים\",\"polygon\":[1.866,10.043,2.5556,10.043,2.5556,10.185,1.866,10.1901],\"confidence\":0.961,\"span\":{\"offset\":929,\"length\":10}},{\"content\":\"עובד\",\"polygon\":[7.033,10.3168,7.3221,10.3168,7.3221,10.4486,7.033,10.4486],\"confidence\":0.98,\"span\":{\"offset\":940,\"length\":4}},{\"content\":\"חתימת\",\"polygon\":[4.2137,10.2357,4.6093,10.2357,4.6093,10.3827,4.2137,10.3827],\"confidence\":0.982,\"span\":{\"offset\":945,\"length\":5}},{\"content\":\"הלקוח/ה\",\"polygon\":[3.6407,10.2306,4.1782,10.2357,4.1782,10.3827,3.6458,10.3878],\"confidence\":0.976,\"span\":{\"offset\":951,\"length\":7}},{\"content\":\"חתימת\",\"polygon\":[2.4187,10.2357,2.8041,10.2357,2.8041,10.3776,2.4187,10.3776],\"confidence\":0.982,\"span\":{\"offset\":959,\"length\":5}},{\"content\":\"המאשר\",\"polygon\":[1.9218,10.2408,2.3731,10.2357,2.3781,10.3776,1.9269,10.3776],\"confidence\":0.982,\"span\":{\"offset\":965,\"length\":5}},{\"content\":\"/ת:\",\"polygon\":[1.7037,10.2357,1.8812,10.2408,1.8812,10.3776,1.7037,10.3776],\"confidence\":0.934,\"span\":{\"offset\":971,\"length\":3}},{\"content\":\"תכנון\",\"polygon\":[6.9012,10.5297,7.3322,10.5348,7.3322,10.6565,6.9063,10.6565],\"confidence\":0.98,\"span\":{\"offset\":975,\"length\":5}},{\"content\":\"ויישום:\",\"polygon\":[6.2319,10.5196,6.8251,10.5297,6.8251,10.6565,6.2319,10.6615],\"confidence\":0.965,\"span\":{\"offset\":981,\"length\":7}},{\"content\":\"אייל\",\"polygon\":[5.8211,10.5196,6.1457,10.5196,6.1457,10.6615,5.8211,10.6615],\"confidence\":0.982,\"span\":{\"offset\":989,\"length\":4}},{\"content\":\"פתרונות\",\"polygon\":[5.167,10.5196,5.74,10.5196,5.7451,10.6615,5.1721,10.6615],\"confidence\":0.961,\"span\":{\"offset\":994,\"length\":7}},{\"content\":\"תוכנה\",\"polygon\":[4.6701,10.5196,5.0808,10.5196,5.0859,10.6615,4.6701,10.6615],\"confidence\":0.98,\"span\":{\"offset\":1002,\"length\":5}},{\"content\":\"בע״מ\",\"polygon\":[4.2391,10.5247,4.5738,10.5247,4.5738,10.6615,4.2442,10.6565],\"confidence\":0.951,\"span\":{\"offset\":1008,\"length\":4}},{\"content\":\"מסמך\",\"polygon\":[3.4075,10.5095,3.6154,10.5449,3.6306,10.6362,3.4278,10.5956],\"confidence\":0.935,\"span\":{\"offset\":1013,\"length\":4}},{\"content\":\"ממוחשב\",\"polygon\":[3.0931,10.6413,3.3872,10.5145,3.4075,10.5956,3.1286,10.7173],\"confidence\":0.951,\"span\":{\"offset\":1018,\"length\":6}},{\"content\":\"אחראי\",\"polygon\":[1.2474,10.5044,1.648,10.5095,1.648,10.6717,1.2474,10.6666],\"confidence\":0.98,\"span\":{\"offset\":1025,\"length\":5}},{\"content\":\"חתום\",\"polygon\":[3.5343,10.8339,3.8436,10.7883,3.8588,10.9201,3.5545,10.9657],\"confidence\":0.982,\"span\":{\"offset\":1031,\"length\":4}},{\"content\":\"דיגיטלית\",\"polygon\":[2.9968,10.915,3.4937,10.8441,3.514,10.9708,3.0171,11.0468],\"confidence\":0.963,\"span\":{\"offset\":1036,\"length\":8}},{\"content\":\"קארדקום\",\"polygon\":[3.3872,11.2344,3.6965,11.1178,3.727,11.1989,3.3974,11.3307],\"confidence\":0.79,\"span\":{\"offset\":1045,\"length\":7}},{\"content\":\"בע״מ\",\"polygon\":[3.1742,11.1888,3.3669,11.2344,3.3771,11.3307,3.1742,11.2851],\"confidence\":0.822,\"span\":{\"offset\":1053,\"length\":4}}],\"lines\":[{\"content\":\"טכומטר-מכון ספידומטרים\",\"polygon\":[4.0008,0.1166,7.3525,0.1166,7.3525,0.3752,4.0008,0.3701],\"spans\":[{\"offset\":0,\"length\":22}]},{\"content\":\"א.ת עמק חפר ת.ד 12218\",\"polygon\":[5.8921,0.436,7.3322,0.436,7.3322,0.5779,5.8921,0.5779],\"spans\":[{\"offset\":23,\"length\":21}]},{\"content\":\"גשר העץ 20\",\"polygon\":[6.602,0.6084,7.3322,0.6033,7.3322,0.725,6.6071,0.73],\"spans\":[{\"offset\":45,\"length\":10}]},{\"content\":\"טלפון: 04-8247760\",\"polygon\":[6.0747,0.725,7.3373,0.725,7.3373,0.8517,6.0747,0.8517],\"spans\":[{\"offset\":56,\"length\":17}]},{\"content\":\"387001\",\"polygon\":[5.5169,0.6084,5.9581,0.6084,5.9581,0.725,5.5169,0.73],\"spans\":[{\"offset\":74,\"length\":6}]},{\"content\":\"פקס 04-8247761 ת.ד 12218\",\"polygon\":[5.7755,1.379,7.3373,1.384,7.3373,1.5209,5.7755,1.5108],\"spans\":[{\"offset\":81,\"length\":24}]},{\"content\":\"כיול ותיקון טכוגרפים וכל סוגי שעוני הרכב ומצלמות\",\"polygon\":[1.9167,1.3637,4.7867,1.3637,4.7867,1.5158,1.9167,1.5158],\"spans\":[{\"offset\":106,\"length\":48}]},{\"content\":\"תאריך\",\"polygon\":[6.7896,1.597,7.3322,1.5919,7.3322,1.7592,6.7896,1.7643],\"spans\":[{\"offset\":155,\"length\":5}]},{\"content\":\"22/10/25:\",\"polygon\":[6.095,1.5868,6.7947,1.5919,6.7896,1.7643,6.095,1.7592],\"spans\":[{\"offset\":161,\"length\":9}]},{\"content\":\"חשבונית מס 288756 Ns\",\"polygon\":[3.585,1.6426,5.3344,1.6476,5.3344,1.8302,3.585,1.8251],\"spans\":[{\"offset\":171,\"length\":20}]},{\"content\":\"* נאמן למקור *\",\"polygon\":[1.6632,1.6578,2.7128,1.6578,2.7179,1.8403,1.6632,1.8403],\"spans\":[{\"offset\":192,\"length\":14}]},{\"content\":\"דף 1\",\"polygon\":[1.0446,1.6071,1.3032,1.6071,1.3032,1.7795,1.0446,1.7795],\"spans\":[{\"offset\":207,\"length\":4}]},{\"content\":\"תא׳ סיום\",\"polygon\":[6.7694,1.8859,7.3322,1.8809,7.3373,2.0431,6.7694,2.0532],\"spans\":[{\"offset\":212,\"length\":8}]},{\"content\":\"22/10/25 :\",\"polygon\":[5.8465,1.8961,6.5564,1.9011,6.5564,2.0431,5.8465,2.038],\"spans\":[{\"offset\":221,\"length\":10}]},{\"content\":\"14:43\",\"polygon\":[5.4104,1.9062,5.7806,1.8961,5.7806,2.0329,5.4155,2.0329],\"spans\":[{\"offset\":232,\"length\":5}]},{\"content\":\"תא׳ הפקה 30/10/25\",\"polygon\":[3.3162,1.8859,4.7056,1.8809,4.7056,2.0482,3.3162,2.0532],\"spans\":[{\"offset\":238,\"length\":17}]},{\"content\":\"עוסק מורשה\",\"polygon\":[1.9725,1.9011,2.6621,1.8961,2.6621,2.0329,1.9725,2.038],\"spans\":[{\"offset\":256,\"length\":10}]},{\"content\":\"558117016\",\"polygon\":[0.9736,1.9062,1.6429,1.9062,1.6429,2.0329,0.9736,2.0329],\"spans\":[{\"offset\":267,\"length\":9}]},{\"content\":\"תא׳ כניסה\",\"polygon\":[6.6832,2.0735,7.3322,2.0634,7.3373,2.1901,6.6832,2.2002],\"spans\":[{\"offset\":277,\"length\":9}]},{\"content\":\"22/10/25 :\",\"polygon\":[5.8516,2.0634,6.5463,2.0634,6.5463,2.2053,5.8516,2.2002],\"spans\":[{\"offset\":287,\"length\":10}]},{\"content\":\"14:42\",\"polygon\":[5.4053,2.0684,5.7299,2.0684,5.7299,2.185,5.4104,2.1901],\"spans\":[{\"offset\":298,\"length\":5}]},{\"content\":\"מוסך מורשה:\",\"polygon\":[1.9015,2.0684,2.6722,2.0634,2.6773,2.2053,1.9015,2.2053],\"spans\":[{\"offset\":304,\"length\":11}]},{\"content\":\"4204\",\"polygon\":[1.3082,2.0786,1.6175,2.0786,1.6175,2.2002,1.3082,2.1952],\"spans\":[{\"offset\":316,\"length\":4}]},{\"content\":\"לכבוד\",\"polygon\":[6.9468,2.5754,7.2866,2.5653,7.2916,2.6869,6.9519,2.692],\"spans\":[{\"offset\":321,\"length\":5}]},{\"content\":\"מס׳ לקוח\",\"polygon\":[4.4166,2.5602,5.1315,2.5602,5.1315,2.7072,4.4166,2.7123],\"spans\":[{\"offset\":327,\"length\":8}]},{\"content\":\"3730:\",\"polygon\":[3.9856,2.5703,4.3912,2.5703,4.3912,2.7021,3.9856,2.7021],\"spans\":[{\"offset\":336,\"length\":5}]},{\"content\":\"מס. כרטיס: 103577\",\"polygon\":[1.7849,2.5703,3.0576,2.5653,3.0576,2.6971,1.7849,2.7021],\"spans\":[{\"offset\":342,\"length\":17}]},{\"content\":\"ט.פ. י פל ים בע״מ\",\"polygon\":[6.3282,2.7326,7.2967,2.7326,7.2967,2.8644,6.3282,2.8593],\"spans\":[{\"offset\":360,\"length\":17}]},{\"content\":\"סוג הרכב\",\"polygon\":[4.6042,2.7427,5.1315,2.7427,5.1315,2.8745,4.6042,2.8745],\"spans\":[{\"offset\":378,\"length\":8}]},{\"content\":\": טויוטה\",\"polygon\":[3.874,2.7376,4.3811,2.7376,4.3811,2.8745,3.874,2.8796],\"spans\":[{\"offset\":387,\"length\":8}]},{\"content\":\"דגם\",\"polygon\":[2.8447,2.7579,3.0678,2.7478,3.0678,2.8694,2.8497,2.8694],\"spans\":[{\"offset\":396,\"length\":3}]},{\"content\":\". .\",\"polygon\":[2.3072,2.7934,2.3021,2.8593,2.2767,2.8593,2.2717,2.7934],\"spans\":[{\"offset\":400,\"length\":3}]},{\"content\":\"הקטיף 11\",\"polygon\":[6.7694,2.9049,7.2967,2.9049,7.2967,3.0367,6.7694,3.0367],\"spans\":[{\"offset\":404,\"length\":8}]},{\"content\":\"מספר רישוי\",\"polygon\":[4.4723,2.9049,5.1417,2.9049,5.1366,3.0317,4.4723,3.0215],\"spans\":[{\"offset\":413,\"length\":10}]},{\"content\":\":\",\"polygon\":[4.3456,2.9252,4.4064,2.9201,4.4064,3.0317,4.3456,3.0367],\"spans\":[{\"offset\":424,\"length\":1}]},{\"content\":\"741-69-103\",\"polygon\":[3.3974,2.91,4.0768,2.91,4.0718,3.0469,3.3974,3.0469],\"spans\":[{\"offset\":426,\"length\":10}]},{\"content\":\"מספר שילדה:\",\"polygon\":[2.2767,2.9049,3.0576,2.8999,3.0576,3.0266,2.2767,3.0317],\"spans\":[{\"offset\":437,\"length\":11}]},{\"content\":\"א.ת עמק חפר\",\"polygon\":[6.5513,3.0773,7.2916,3.0773,7.2916,3.2091,6.5513,3.2091],\"spans\":[{\"offset\":449,\"length\":11}]},{\"content\":\"0\",\"polygon\":[5.8921,3.0925,5.9682,3.0925,5.9682,3.204,5.8921,3.199],\"spans\":[{\"offset\":461,\"length\":1}]},{\"content\":\"שנת יצור\",\"polygon\":[4.6093,3.0773,5.1366,3.0773,5.1366,3.204,4.6093,3.204],\"spans\":[{\"offset\":463,\"length\":8}]},{\"content\":\":\",\"polygon\":[4.3506,3.1026,4.3963,3.1026,4.3912,3.204,4.3456,3.204],\"spans\":[{\"offset\":472,\"length\":1}]},{\"content\":\"מספר מנוע\",\"polygon\":[2.4644,3.0773,3.0678,3.0773,3.0678,3.2091,2.4644,3.2091],\"spans\":[{\"offset\":474,\"length\":9}]},{\"content\":\":\",\"polygon\":[2.2666,3.1026,2.3325,3.1026,2.3274,3.2091,2.2666,3.2091],\"spans\":[{\"offset\":484,\"length\":1}]},{\"content\":\"הערה\",\"polygon\":[2.7128,3.2699,3.0779,3.2649,3.0779,3.3916,2.7128,3.3967],\"spans\":[{\"offset\":486,\"length\":4}]},{\"content\":\"מסירה\",\"polygon\":[4.7715,3.417,5.1315,3.417,5.1315,3.5386,4.7715,3.5386],\"spans\":[{\"offset\":491,\"length\":5}]},{\"content\":\":\",\"polygon\":[4.3253,3.4372,4.3659,3.4372,4.3659,3.5386,4.3253,3.5386],\"spans\":[{\"offset\":497,\"length\":1}]},{\"content\":\"טל׳ נייד\",\"polygon\":[2.6063,3.4068,3.0576,3.4068,3.0576,3.5234,2.6063,3.5234],\"spans\":[{\"offset\":499,\"length\":8}]},{\"content\":\"0505020057 :\",\"polygon\":[1.4604,3.422,2.3072,3.417,2.3072,3.5437,1.4604,3.5437],\"spans\":[{\"offset\":508,\"length\":12}]},{\"content\":\"טל׳עבודה\",\"polygon\":[6.7187,3.5944,7.3221,3.5893,7.3221,3.7313,6.7187,3.7364],\"spans\":[{\"offset\":521,\"length\":8}]},{\"content\":\"098947633:\",\"polygon\":[5.7654,3.5995,6.5158,3.5995,6.5158,3.7364,5.7654,3.7364],\"spans\":[{\"offset\":530,\"length\":10}]},{\"content\":\"ת.זהות / ח.פ: 513327064\",\"polygon\":[3.6458,3.564,5.1366,3.564,5.1366,3.7059,3.6458,3.7059],\"spans\":[{\"offset\":541,\"length\":23}]},{\"content\":\"קוד עבודה\",\"polygon\":[6.597,4.1419,7.2359,4.1521,7.2308,4.289,6.597,4.2839],\"spans\":[{\"offset\":565,\"length\":9}]},{\"content\":\"עבודות\",\"polygon\":[4.6498,4.1115,5.167,4.1115,5.167,4.2636,4.6498,4.2636],\"spans\":[{\"offset\":575,\"length\":6}]},{\"content\":\"ז. תקן\",\"polygon\":[3.1641,4.1774,3.4988,4.1724,3.4988,4.2991,3.1641,4.2991],\"spans\":[{\"offset\":582,\"length\":6}]},{\"content\":\"סה״כ % הנחה סכום ש״ח\",\"polygon\":[1.0902,4.1724,2.87,4.1724,2.87,4.3143,1.0902,4.3143],\"spans\":[{\"offset\":589,\"length\":20}]},{\"content\":\"קוד פריט\",\"polygon\":[6.3536,4.4968,6.9316,4.4917,6.9316,4.6793,6.3536,4.6844],\"spans\":[{\"offset\":610,\"length\":8}]},{\"content\":\"חלפים\",\"polygon\":[4.5484,4.4968,5.2076,4.4917,5.2076,4.6692,4.5535,4.6692],\"spans\":[{\"offset\":619,\"length\":5}]},{\"content\":\"כמות\",\"polygon\":[3.3314,4.4968,3.6813,4.4968,3.6813,4.6743,3.3314,4.6641],\"spans\":[{\"offset\":625,\"length\":4}]},{\"content\":\"% הנחה יח׳ לצרכן\",\"polygon\":[1.9573,4.512,3.1134,4.507,3.1134,4.659,1.9624,4.659],\"spans\":[{\"offset\":630,\"length\":16}]},{\"content\":\"סכום ש״ח\",\"polygon\":[1.1257,4.5171,1.7291,4.5171,1.7291,4.654,1.1257,4.6489],\"spans\":[{\"offset\":647,\"length\":8}]},{\"content\":\"התקנת מצלמה כולל ציוד נלווה\",\"polygon\":[4.0667,4.7199,5.9631,4.7199,5.9631,4.9024,4.0667,4.8973],\"spans\":[{\"offset\":656,\"length\":27}]},{\"content\":\"1.00\",\"polygon\":[3.4836,4.7503,3.7422,4.7503,3.7422,4.872,3.4836,4.877],\"spans\":[{\"offset\":684,\"length\":4}]},{\"content\":\"300.00\",\"polygon\":[2.2007,4.7249,2.6266,4.7199,2.6266,4.9075,2.1956,4.9075],\"spans\":[{\"offset\":689,\"length\":6}]},{\"content\":\"300.00\",\"polygon\":[1.3082,4.7503,1.7494,4.7503,1.7494,4.877,1.3082,4.872],\"spans\":[{\"offset\":696,\"length\":6}]},{\"content\":\"1.00\",\"polygon\":[3.4836,4.9227,3.7523,4.9227,3.7523,5.0494,3.4836,5.0393],\"spans\":[{\"offset\":703,\"length\":4}]},{\"content\":\"סה״כ לעבודה\",\"polygon\":[2.1145,5.3739,2.9511,5.3739,2.9511,5.5158,2.1145,5.5158],\"spans\":[{\"offset\":708,\"length\":11}]},{\"content\":\"0.00\",\"polygon\":[1.4705,5.3941,1.7443,5.3891,1.7443,5.5158,1.4705,5.5057],\"spans\":[{\"offset\":720,\"length\":4}]},{\"content\":\"הערות:\",\"polygon\":[6.8606,5.5462,7.3525,5.5462,7.3525,5.6831,6.8606,5.678],\"spans\":[{\"offset\":725,\"length\":6}]},{\"content\":\"סה״כ ע. חוץ\",\"polygon\":[2.2362,5.5462,2.9511,5.5412,2.9511,5.673,2.2362,5.678],\"spans\":[{\"offset\":732,\"length\":11}]},{\"content\":\"0.00\",\"polygon\":[1.4705,5.5614,1.7342,5.5564,1.7392,5.678,1.4756,5.6679],\"spans\":[{\"offset\":744,\"length\":4}]},{\"content\":\"סה״כ חלפים\",\"polygon\":[2.2007,5.7034,2.9511,5.7034,2.9511,5.8352,2.2007,5.8352],\"spans\":[{\"offset\":749,\"length\":10}]},{\"content\":\"300.00\",\"polygon\":[1.3234,5.7237,1.7443,5.7186,1.7443,5.8352,1.3234,5.8352],\"spans\":[{\"offset\":760,\"length\":6}]},{\"content\":\"סה״כ\",\"polygon\":[2.6063,6.0431,2.9511,6.038,2.9562,6.1647,2.6114,6.1698],\"spans\":[{\"offset\":767,\"length\":4}]},{\"content\":\"300.00\",\"polygon\":[1.3184,6.0481,1.7443,6.0481,1.7443,6.1647,1.3184,6.1647],\"spans\":[{\"offset\":772,\"length\":6}]},{\"content\":\"מ.ע.מ. % 18.00\",\"polygon\":[2.0283,6.2306,2.9359,6.2306,2.9359,6.3625,2.0283,6.3625],\"spans\":[{\"offset\":779,\"length\":14}]},{\"content\":\"54.00\",\"polygon\":[1.3995,6.2408,1.7392,6.2357,1.7443,6.3625,1.3995,6.3625],\"spans\":[{\"offset\":794,\"length\":5}]},{\"content\":\"תנאי תשלום:\",\"polygon\":[6.5513,6.5145,7.3322,6.5145,7.3322,6.6818,6.5513,6.6818],\"spans\":[{\"offset\":800,\"length\":11}]},{\"content\":\"לתשלום\",\"polygon\":[2.4441,6.5247,2.9359,6.5247,2.9359,6.6666,2.4441,6.6666],\"spans\":[{\"offset\":812,\"length\":6}]},{\"content\":\"354.00\",\"polygon\":[1.3184,6.5196,1.7494,6.5196,1.7494,6.6464,1.3184,6.6464],\"spans\":[{\"offset\":819,\"length\":6}]},{\"content\":\"אחריות לחלקים 3 חודשם מיום הוצאת החשבונית\",\"polygon\":[4.4673,6.8339,6.5868,6.8339,6.5868,6.9556,4.4673,6.9556],\"spans\":[{\"offset\":826,\"length\":41}]},{\"content\":\"לשירותכם תמיד ..\",\"polygon\":[5.8211,6.9708,6.5767,6.9708,6.5767,7.0874,5.8211,7.0874],\"spans\":[{\"offset\":868,\"length\":16}]},{\"content\":\"בכבוד רב,\",\"polygon\":[2.3021,9.891,2.9258,9.8859,2.9309,10.0177,2.3072,10.0228],\"spans\":[{\"offset\":885,\"length\":9}]},{\"content\":\"עורך\",\"polygon\":[7.028,10.1394,7.3221,10.1394,7.3221,10.261,7.028,10.261],\"spans\":[{\"offset\":895,\"length\":4}]},{\"content\":\"לפרעון: 22/10/25\",\"polygon\":[5.2989,10.1191,6.4246,10.1191,6.4246,10.2712,5.2989,10.2712],\"spans\":[{\"offset\":900,\"length\":16}]},{\"content\":\"טכומטר-מכון ספידומטרים\",\"polygon\":[1.8356,10.043,3.372,10.0329,3.372,10.1799,1.8356,10.185],\"spans\":[{\"offset\":917,\"length\":22}]},{\"content\":\"עובד\",\"polygon\":[7.0229,10.3168,7.3221,10.3219,7.3221,10.4486,7.0229,10.4486],\"spans\":[{\"offset\":940,\"length\":4}]},{\"content\":\"חתימת הלקוח/ה\",\"polygon\":[3.6103,10.2256,4.6093,10.2306,4.6093,10.3827,3.6103,10.3827],\"spans\":[{\"offset\":945,\"length\":13}]},{\"content\":\"חתימת המאשר /ת:\",\"polygon\":[1.6987,10.2357,2.8041,10.2306,2.8041,10.3726,1.6987,10.3726],\"spans\":[{\"offset\":959,\"length\":15}]},{\"content\":\"תכנון ויישום: אייל פתרונות תוכנה בע״מ\",\"polygon\":[4.2188,10.5145,7.3271,10.5196,7.3271,10.6615,4.2188,10.6565],\"spans\":[{\"offset\":975,\"length\":37}]},{\"content\":\"מסמך ממוחשב\",\"polygon\":[3.0931,10.5652,3.6002,10.5095,3.6306,10.6362,3.1083,10.7224],\"spans\":[{\"offset\":1013,\"length\":11}]},{\"content\":\"אחראי\",\"polygon\":[1.2474,10.5044,1.6581,10.5095,1.6632,10.6717,1.2525,10.6666],\"spans\":[{\"offset\":1025,\"length\":5}]},{\"content\":\"חתום דיגיטלית\",\"polygon\":[2.9511,10.9201,3.8436,10.7832,3.8639,10.915,2.9714,11.0468],\"spans\":[{\"offset\":1031,\"length\":13}]},{\"content\":\"קארדקום בע״מ\",\"polygon\":[3.1692,11.1837,3.7117,11.1128,3.732,11.2851,3.1793,11.3307],\"spans\":[{\"offset\":1045,\"length\":12}]}],\"spans\":[{\"offset\":0,\"length\":1057}]}],\"tables\":[{\"rowCount\":10,\"columnCount\":5,\"cells\":[{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":0,\"columnSpan\":2,\"content\":\"סה״כ % הנחה סכום ש״ח\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.859,4.0222,3.2249,4.0153,3.2249,4.3265,0.859,4.3265]}],\"spans\":[{\"offset\":589,\"length\":20}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":2,\"content\":\"ז. תקן\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,4.0153,3.9028,4.0153,3.9028,4.3265,3.2249,4.3265]}],\"spans\":[{\"offset\":582,\"length\":6}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":3,\"content\":\"עבודות\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,4.0153,6.1511,4.0153,6.158,4.3265,3.9028,4.3265]}],\"spans\":[{\"offset\":575,\"length\":6}]},{\"kind\":\"columnHeader\",\"rowIndex\":0,\"columnIndex\":4,\"content\":\"קוד עבודה\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.1511,4.0153,7.3617,4.0153,7.3686,4.3196,6.158,4.3265]}],\"spans\":[{\"offset\":565,\"length\":9}]},{\"kind\":\"columnHeader\",\"rowIndex\":1,\"columnIndex\":0,\"content\":\"סכום ש״ח\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.859,4.3265,1.8759,4.3265,1.869,4.7277,0.8521,4.7277]}],\"spans\":[{\"offset\":647,\"length\":8}]},{\"kind\":\"columnHeader\",\"rowIndex\":1,\"columnIndex\":1,\"content\":\"% הנחה יח׳ לצרכן\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.8759,4.3265,3.2249,4.3265,3.2249,4.7277,1.869,4.7277]}],\"spans\":[{\"offset\":630,\"length\":16}]},{\"kind\":\"columnHeader\",\"rowIndex\":1,\"columnIndex\":2,\"content\":\"כמות\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,4.3265,3.9028,4.3265,3.9028,4.7277,3.2249,4.7277]}],\"spans\":[{\"offset\":625,\"length\":4}]},{\"kind\":\"columnHeader\",\"rowIndex\":1,\"columnIndex\":3,\"content\":\"חלפים\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,4.3265,6.158,4.3265,6.158,4.7277,3.9028,4.7277]}],\"spans\":[{\"offset\":619,\"length\":5}]},{\"kind\":\"columnHeader\",\"rowIndex\":1,\"columnIndex\":4,\"content\":\"קוד פריט\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,4.3265,7.3686,4.3196,7.3686,4.7208,6.158,4.7277]}],\"spans\":[{\"offset\":610,\"length\":8}]},{\"rowIndex\":2,\"columnIndex\":0,\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8521,4.7277,1.869,4.7277,1.869,4.9006,0.8452,4.9006]}],\"spans\":[{\"offset\":696,\"length\":6}]},{\"rowIndex\":2,\"columnIndex\":1,\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,4.7277,3.2249,4.7277,3.2249,4.9006,1.869,4.9006]}],\"spans\":[{\"offset\":689,\"length\":6}]},{\"rowIndex\":2,\"columnIndex\":2,\"content\":\"1.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,4.7277,3.9028,4.7277,3.9028,4.9006,3.2249,4.9006]}],\"spans\":[{\"offset\":684,\"length\":4}]},{\"rowIndex\":2,\"columnIndex\":3,\"content\":\"התקנת מצלמה כולל ציוד נלווה\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,4.7277,6.158,4.7277,6.158,4.8937,3.9028,4.9006]}],\"spans\":[{\"offset\":656,\"length\":27}]},{\"rowIndex\":2,\"columnIndex\":4,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,4.7277,7.3686,4.7208,7.3686,4.8937,6.158,4.8937]}],\"spans\":[]},{\"rowIndex\":3,\"columnIndex\":0,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8452,4.9006,1.869,4.9006,1.869,5.0666,0.8452,5.0666]}],\"spans\":[]},{\"rowIndex\":3,\"columnIndex\":1,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,4.9006,3.2249,4.9006,3.2249,5.0666,1.869,5.0666]}],\"spans\":[]},{\"rowIndex\":3,\"columnIndex\":2,\"content\":\"1.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,4.9006,3.9028,4.9006,3.9028,5.0666,3.2249,5.0666]}],\"spans\":[{\"offset\":703,\"length\":4}]},{\"rowIndex\":3,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,4.9006,6.158,4.8937,6.158,5.0666,3.9028,5.0666]}],\"spans\":[]},{\"rowIndex\":3,\"columnIndex\":4,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,4.8937,7.3686,4.8937,7.3755,5.0666,6.158,5.0666]}],\"spans\":[]},{\"rowIndex\":4,\"columnIndex\":0,\"content\":\"0.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8452,5.0666,1.869,5.0666,1.869,5.5369,0.8382,5.5369]}],\"spans\":[{\"offset\":720,\"length\":4}]},{\"rowIndex\":4,\"columnIndex\":1,\"content\":\"סה״כ לעבודה\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,5.0666,3.2249,5.0666,3.2249,5.5369,1.869,5.5369]}],\"spans\":[{\"offset\":708,\"length\":11}]},{\"rowIndex\":4,\"columnIndex\":2,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,5.0666,3.9028,5.0666,3.9028,5.5369,3.2249,5.5369]}],\"spans\":[]},{\"rowIndex\":4,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,5.0666,6.158,5.0666,6.158,5.53,3.9028,5.5369]}],\"spans\":[]},{\"rowIndex\":4,\"columnIndex\":4,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,5.0666,7.3755,5.0666,7.3755,5.53,6.158,5.53]}],\"spans\":[]},{\"rowIndex\":5,\"columnIndex\":0,\"content\":\"0.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8382,5.5369,1.869,5.5369,1.869,5.7029,0.8382,5.7029]}],\"spans\":[{\"offset\":744,\"length\":4}]},{\"rowIndex\":5,\"columnIndex\":1,\"content\":\"סה״כ ע. חוץ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,5.5369,3.2249,5.5369,3.2249,5.7029,1.869,5.7029]}],\"spans\":[{\"offset\":732,\"length\":11}]},{\"rowIndex\":5,\"columnIndex\":2,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,5.5369,3.9028,5.5369,3.9028,5.7029,3.2249,5.7029]}],\"spans\":[]},{\"rowIndex\":5,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,5.5369,6.158,5.53,6.158,5.7029,3.9028,5.7029]}],\"spans\":[]},{\"rowIndex\":5,\"columnIndex\":4,\"content\":\"הערות:\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,5.53,7.3755,5.53,7.3755,5.7029,6.158,5.7029]}],\"spans\":[{\"offset\":725,\"length\":6}]},{\"rowIndex\":6,\"columnIndex\":0,\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8382,5.7029,1.869,5.7029,1.869,5.945,0.8313,5.945]}],\"spans\":[{\"offset\":760,\"length\":6}]},{\"rowIndex\":6,\"columnIndex\":1,\"content\":\"סה״כ חלפים\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,5.7029,3.2249,5.7029,3.2249,5.945,1.869,5.945]}],\"spans\":[{\"offset\":749,\"length\":10}]},{\"rowIndex\":6,\"columnIndex\":2,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,5.7029,3.9028,5.7029,3.9028,5.945,3.2249,5.945]}],\"spans\":[]},{\"rowIndex\":6,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,5.7029,6.158,5.7029,6.158,5.945,3.9028,5.945]}],\"spans\":[]},{\"rowIndex\":6,\"columnIndex\":4,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,5.7029,7.3755,5.7029,7.3824,5.945,6.158,5.945]}],\"spans\":[]},{\"rowIndex\":7,\"columnIndex\":0,\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8313,5.945,1.869,5.945,1.869,6.2078,0.8313,6.2078]}],\"spans\":[{\"offset\":772,\"length\":6}]},{\"rowIndex\":7,\"columnIndex\":1,\"content\":\"סה״כ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,5.945,3.2249,5.945,3.2249,6.2078,1.869,6.2078]}],\"spans\":[{\"offset\":767,\"length\":4}]},{\"rowIndex\":7,\"columnIndex\":2,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,5.945,3.9028,5.945,3.9028,6.2078,3.2249,6.2078]}],\"spans\":[]},{\"rowIndex\":7,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,5.945,6.158,5.945,6.158,6.2078,3.9028,6.2078]}],\"spans\":[]},{\"rowIndex\":7,\"columnIndex\":4,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,5.945,7.3824,5.945,7.3824,6.2078,6.158,6.2078]}],\"spans\":[]},{\"rowIndex\":8,\"columnIndex\":0,\"content\":\"54.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8313,6.2078,1.869,6.2078,1.869,6.4498,0.8244,6.4498]}],\"spans\":[{\"offset\":794,\"length\":5}]},{\"rowIndex\":8,\"columnIndex\":1,\"content\":\"מ.ע.מ. % 18.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,6.2078,3.2249,6.2078,3.2249,6.4498,1.869,6.4498]}],\"spans\":[{\"offset\":779,\"length\":14}]},{\"rowIndex\":8,\"columnIndex\":2,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,6.2078,3.9028,6.2078,3.9028,6.4498,3.2249,6.4498]}],\"spans\":[]},{\"rowIndex\":8,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,6.2078,6.158,6.2078,6.158,6.4498,3.9028,6.4498]}],\"spans\":[]},{\"rowIndex\":8,\"columnIndex\":4,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,6.2078,7.3824,6.2078,7.3824,6.4429,6.158,6.4498]}],\"spans\":[]},{\"rowIndex\":9,\"columnIndex\":0,\"content\":\"354.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.8244,6.4498,1.869,6.4498,1.869,6.7196,0.8244,6.7196]}],\"spans\":[{\"offset\":819,\"length\":6}]},{\"rowIndex\":9,\"columnIndex\":1,\"content\":\"לתשלום\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.869,6.4498,3.2249,6.4498,3.2249,6.7196,1.869,6.7196]}],\"spans\":[{\"offset\":812,\"length\":6}]},{\"rowIndex\":9,\"columnIndex\":2,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.2249,6.4498,3.9028,6.4498,3.9028,6.7196,3.2249,6.7196]}],\"spans\":[]},{\"rowIndex\":9,\"columnIndex\":3,\"content\":\"\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.9028,6.4498,6.158,6.4498,6.1649,6.7265,3.9028,6.7196]}],\"spans\":[]},{\"rowIndex\":9,\"columnIndex\":4,\"content\":\"תנאי תשלום:\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.158,6.4498,7.3824,6.4429,7.3824,6.7265,6.1649,6.7265]}],\"spans\":[{\"offset\":800,\"length\":11}]}],\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.6222,4.0029,7.3627,4.0063,7.3584,6.7356,0.6179,6.7348]}],\"spans\":[{\"offset\":589,\"length\":20},{\"offset\":582,\"length\":6},{\"offset\":575,\"length\":6},{\"offset\":565,\"length\":9},{\"offset\":647,\"length\":8},{\"offset\":630,\"length\":16},{\"offset\":625,\"length\":4},{\"offset\":619,\"length\":5},{\"offset\":610,\"length\":8},{\"offset\":696,\"length\":6},{\"offset\":689,\"length\":6},{\"offset\":684,\"length\":4},{\"offset\":656,\"length\":27},{\"offset\":703,\"length\":4},{\"offset\":720,\"length\":4},{\"offset\":708,\"length\":11},{\"offset\":744,\"length\":4},{\"offset\":732,\"length\":11},{\"offset\":725,\"length\":6},{\"offset\":760,\"length\":6},{\"offset\":749,\"length\":10},{\"offset\":772,\"length\":6},{\"offset\":767,\"length\":4},{\"offset\":794,\"length\":5},{\"offset\":779,\"length\":14},{\"offset\":819,\"length\":6},{\"offset\":812,\"length\":6},{\"offset\":800,\"length\":11}]}],\"styles\":[{\"confidence\":0.1,\"spans\":[{\"offset\":484,\"length\":1}],\"isHandwritten\":true}],\"documents\":[{\"docType\":\"invoice\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0,0,8.25,0,8.25,11.6806,0,11.6806]}],\"fields\":{\"CustomerAddress\":{\"type\":\"address\",\"content\":\"הקטיף 11\\nא.ת עמק חפר\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.5564,2.9049,7.2967,2.9049,7.2967,3.2091,6.5564,3.2091]}],\"confidence\":0.309,\"spans\":[{\"offset\":404,\"length\":8},{\"offset\":449,\"length\":11}],\"valueAddress\":{\"houseNumber\":\"11\",\"road\":\"הקטיף\",\"streetAddress\":\"11 הקטיף\",\"house\":\"א.ת עמק חפר\"}},\"CustomerAddressRecipient\":{\"type\":\"string\",\"valueString\":\"ט.פ. י פל ים בע״מ\",\"content\":\"ט.פ. י פל ים בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.3536,2.7376,7.2967,2.7376,7.2967,2.8644,6.3536,2.8644]}],\"confidence\":0.314,\"spans\":[{\"offset\":360,\"length\":17}]},\"CustomerName\":{\"type\":\"string\",\"valueString\":\"ט.פ. י פל ים בע״מ\",\"content\":\"ט.פ. י פל ים בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.3536,2.7376,7.2967,2.7376,7.2967,2.8644,6.3536,2.8644]}],\"confidence\":0.314,\"spans\":[{\"offset\":360,\"length\":17}]},\"CustomerTaxId\":{\"type\":\"string\",\"valueString\":\"513327064\",\"content\":\"513327064\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.6458,3.5691,4.2898,3.564,4.2949,3.711,3.6509,3.7059]}],\"confidence\":0.454,\"spans\":[{\"offset\":555,\"length\":9}]},\"InvoiceDate\":{\"type\":\"date\",\"valueDate\":\"2025-10-22\",\"content\":\"22/10/25:\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[6.095,1.5868,6.7643,1.5919,6.7694,1.7643,6.095,1.7643]}],\"confidence\":0.947,\"spans\":[{\"offset\":161,\"length\":9}]},\"InvoiceId\":{\"type\":\"string\",\"valueString\":\"288756 Ns\",\"content\":\"288756 Ns\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.585,1.6451,4.398,1.6527,4.3963,1.8378,3.5833,1.8302]}],\"confidence\":0.6,\"spans\":[{\"offset\":182,\"length\":9}]},\"InvoiceTotal\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":354,\"currencyCode\":\"ILS\"},\"content\":\"354.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.3285,6.5247,1.7392,6.5247,1.7443,6.6514,1.3336,6.6514]}],\"confidence\":0.957,\"spans\":[{\"offset\":819,\"length\":6}]},\"Items\":{\"type\":\"array\",\"valueArray\":[{\"type\":\"object\",\"valueObject\":{\"Amount\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":300,\"currencyCode\":\"ILS\"},\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.3285,4.7503,1.7443,4.7554,1.7443,4.8821,1.3336,4.877]}],\"confidence\":0.853,\"spans\":[{\"offset\":696,\"length\":6}]},\"Description\":{\"type\":\"string\",\"valueString\":\"התקנת מצלמה כולל ציוד נלווה\",\"content\":\"התקנת מצלמה כולל ציוד נלווה\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[4.0834,4.7097,5.9581,4.7249,5.9566,4.9149,4.0818,4.8997]}],\"confidence\":0.881,\"spans\":[{\"offset\":656,\"length\":27}]},\"Quantity\":{\"type\":\"number\",\"valueNumber\":1,\"content\":\"1.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[3.4836,4.7503,3.7371,4.7503,3.7371,4.877,3.4836,4.877]}],\"confidence\":0.86,\"spans\":[{\"offset\":684,\"length\":4}]},\"UnitPrice\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":300,\"currencyCode\":\"ILS\"},\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.1956,4.7199,2.6215,4.7199,2.6215,4.9024,2.1956,4.9075]}],\"confidence\":0.852,\"spans\":[{\"offset\":689,\"length\":6}]}},\"content\":\"התקנת מצלמה כולל ציוד נלווה\\n1.00\\n300.00\\n300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.329,4.6874,5.9581,4.7249,5.9564,4.938,1.3273,4.9005]}],\"confidence\":0.876,\"spans\":[{\"offset\":656,\"length\":46}]}]},\"PurchaseOrder\":{\"type\":\"string\",\"valueString\":\"098947633:\",\"content\":\"098947633:\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[5.7755,3.6045,6.5158,3.5995,6.5108,3.7414,5.7755,3.7364]}],\"confidence\":0.442,\"spans\":[{\"offset\":530,\"length\":10}]},\"SubTotal\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":300,\"currencyCode\":\"ILS\"},\"content\":\"300.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.3336,6.0532,1.724,6.0481,1.7291,6.1698,1.3387,6.1698]}],\"confidence\":0.437,\"spans\":[{\"offset\":772,\"length\":6}]},\"TotalTax\":{\"type\":\"currency\",\"valueCurrency\":{\"amount\":54,\"currencyCode\":\"ILS\"},\"content\":\"54.00\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[1.3995,6.2357,1.7342,6.2357,1.7392,6.3574,1.3995,6.3625]}],\"confidence\":0.96,\"spans\":[{\"offset\":794,\"length\":5}]},\"VendorAddress\":{\"type\":\"address\",\"content\":\"א.ת עמק חפר ת.ד 12218\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[5.8921,0.436,7.3221,0.436,7.3221,0.583,5.8921,0.583]}],\"confidence\":0.814,\"spans\":[{\"offset\":23,\"length\":21}],\"valueAddress\":{\"postalCode\":\"12218\",\"streetAddress\":\"\",\"house\":\"א.ת עמק חפר ת.ד\"}},\"VendorAddressRecipient\":{\"type\":\"string\",\"valueString\":\"טכומטר-מכון ספידומטרים\",\"content\":\"טכומטר-מכון ספידומטרים\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[4.087,0.1158,7.3431,0.1267,7.3422,0.3861,4.0861,0.3752]}],\"confidence\":0.658,\"spans\":[{\"offset\":0,\"length\":22}]},\"VendorName\":{\"type\":\"string\",\"valueString\":\"מסמך ממוחשב\\nחתום דיגיטלית\\nקארדקום בע״מ\",\"content\":\"מסמך ממוחשב\\nחתום דיגיטלית\\nקארדקום בע״מ\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[2.9469,10.5776,3.7939,10.4524,3.9125,11.2546,3.0655,11.3798]}],\"confidence\":0.459,\"spans\":[{\"offset\":1013,\"length\":11},{\"offset\":1031,\"length\":26}]},\"VendorTaxId\":{\"type\":\"string\",\"valueString\":\"558117016\",\"content\":\"558117016\",\"boundingRegions\":[{\"pageNumber\":1,\"polygon\":[0.9837,1.9163,1.6277,1.9113,1.6328,2.038,0.9837,2.0329]}],\"confidence\":0.443,\"spans\":[{\"offset\":267,\"length\":9}]}},\"confidence\":1,\"spans\":[{\"offset\":0,\"length\":1057}]}]}}"
            }
        ],
        "language": "javascript",
        "inputFormat": "string",
        "dependencies": [],
        "codeStringJavascript": "// ============================================================================\n// קוד 2 - עיבוד חשבוניות (גרסה 4.2 - תיקון מחיר)\n// מקבל: OCR + הגדרות + תעודות + יבוא\n// מחזיר: JSON לפריוריטי + דוח ביצוע\n//\n// ✨ חדש בגרסה 4.2:\n// - תיקון חישוב מחיר: InvoiceTotal - TotalTax = סה\"כ לפני מע\"מ (עבודות + חלקים)\n//\n// ✨ חדש בגרסה 4.1:\n// - פונקציית cleanInvoiceForPriority() - מנקה שדות למידה לפני שליחה\n// - זיהוי רכבים משופר - מונע זיהוי כרטיס כרכב\n//\n// ✨ חדש בגרסה 4.0:\n// - חילוץ רכבים מתקדם לפי vehicle_processing_rules.search_locations\n// - תמיכה ב-VehicleNumbers (שדה חדש מ-Azure v3.0)\n// - תמיכה ב-Items[].VehicleNumber (קישור ישיר)\n// - יצירת פריטי רכבים אוטומטית\n// - מיפוי לחשבונות לפי vehicle_account_mapping\n//\n// ✨ מגרסה 3.0:\n// - תמיכה במבנה החדש של UnidentifiedNumbers (מערך אובייקטים)\n// - ניצול התוויות (label) וההקשר (context) לזיהוי חכם יותר\n// ============================================================================\n\n// ============================================================================\n// פונקציית עזר - ניקוי invoice לפני שליחה ל-Priority\n// ============================================================================\n\nfunction cleanInvoiceForPriority(invoice) {\n    // יצירת עותק עמוק כדי לא לשנות את המקור\n    const cleaned = JSON.parse(JSON.stringify(invoice));\n\n    // ניקוי שדות שלא צריכים מהפריטים\n    if (cleaned.PINVOICEITEMS_SUBFORM) {\n        cleaned.PINVOICEITEMS_SUBFORM = cleaned.PINVOICEITEMS_SUBFORM.map(item => {\n            // מחיקת שדות למידה\n            delete item.isNewVehicle;\n            delete item._learningNote;\n\n            // מחיקת SPECIALVATFLAG אם זה לא \"Y\"\n            if (item.SPECIALVATFLAG && item.SPECIALVATFLAG !== \"Y\") {\n                delete item.SPECIALVATFLAG;\n            }\n\n            return item;\n        });\n    }\n\n    return cleaned;\n}\n\n// ============================================================================\n// פונקציה ראשית\n// ============================================================================\n\nfunction processInvoiceComplete(input) {\n    const executionReport = {\n        stage: \"\",\n        found: [],\n        not_found: [],\n        warnings: [],\n        errors: []\n    };\n\n    try {\n        // ============================================================================\n        // שלב 1: זיהוי סוג חשבונית ותבנית\n        // ============================================================================\n\n        executionReport.stage = \"שלב 1: זיהוי סוג ותבנית\";\n\n        // א. בדיקת יבוא\n        const hasImport = checkImportExists(input.import_files);\n\n        // ב. בדיקת תעודות - ב-OCR או ב-docs_list!\n        const hasDocsInOCR = checkDocsInOCR(\n            input.AZURE_RESULT.data.fields,\n            input.AZURE_TEXT\n        );\n        const hasDocsInList = checkDocsExist(input.docs_list);\n        const hasDocs = hasDocsInOCR || hasDocsInList;\n\n        // ג. זיהוי חיוב/זיכוי\n        const debitType = identifyDebitType(input.AZURE_RESULT.data.fields);\n\n        executionReport.found.push(`סוג: יבוא=${hasImport}, תעודות=${hasDocs}, חיוב/זיכוי=${debitType}`);\n\n        // ד. חיפוש תבנית מתאימה\n        const config = input.learned_config.config;\n        const templateIndex = findMatchingTemplate(config.structure, hasImport, hasDocs, debitType);\n\n        if (templateIndex === -1) {\n            executionReport.errors.push(\"לא נמצאה תבנית מתאימה!\");\n            throw new Error(\"לא נמצאה תבנית מתאימה\");\n        }\n\n        const structure = config.structure[templateIndex];\n        const template = input.learned_config.template.PINVOICES[templateIndex];\n\n        executionReport.found.push(`תבנית: index=${templateIndex}`);\n\n        // ============================================================================\n        // שלב 2: הכנה - הבנת דפוסים\n        // ============================================================================\n\n        executionReport.stage = \"שלב 2: הבנת דפוסים\";\n\n        const patterns = extractPatterns(\n            input.learned_config.recommended_samples,\n            input.docs_list\n        );\n\n        executionReport.found.push(`דפוסים: BOOKNUM=${JSON.stringify(patterns.booknum_pattern)}, תעודות=${JSON.stringify(patterns.docs_pattern)}`);\n\n        // ✨ חדש! קריאת חוקי רכבים\n        const vehicleRules = config.rules?.critical_patterns?.vehicle_rules || null;\n        if (vehicleRules && vehicleRules.enabled) {\n            executionReport.found.push(`חוקי רכבים: פעילים (${Object.keys(vehicleRules.vehicle_account_mapping || {}).length} רכבים ממופים)`);\n        }\n\n        // ============================================================================\n        // שלב 3: חיפוש וזיהוי נתונים\n        // ============================================================================\n\n        executionReport.stage = \"שלב 3: חיפוש נתונים\";\n\n        const ocrFields = input.AZURE_RESULT.data.fields;\n        const searchResults = searchAllData(\n            ocrFields,\n            input.AZURE_TEXT,\n            patterns,\n            structure,\n            input.import_files,\n            input.docs_list,\n            vehicleRules  // ✨ חדש!\n        );\n\n        // תיעוד מה נמצא\n        Object.keys(searchResults).forEach(key => {\n            if (key === 'documents' && searchResults.documents) {\n                if (searchResults.documents.length > 0) {\n                    const docsInfo = searchResults.documents.map(d =>\n                        `${d.BOOKNUM} (DOCNO: ${d.DOCNO || 'ריק'})`\n                    ).join(', ');\n                    executionReport.found.push(`תעודות: ${searchResults.documents.length} - ${docsInfo}`);\n                } else {\n                    executionReport.not_found.push('תעודות');\n                }\n            } else if (key === 'vehicles' && searchResults.vehicles) {\n                if (searchResults.vehicles.length > 0) {\n                    executionReport.found.push(`רכבים: ${searchResults.vehicles.length} - ${searchResults.vehicles.join(', ')}`);\n                } else {\n                    executionReport.not_found.push('רכבים');\n                }\n            } else if (searchResults[key]) {\n                executionReport.found.push(`${key}: ${JSON.stringify(searchResults[key]).substring(0, 50)}`);\n            } else {\n                executionReport.not_found.push(key);\n            }\n        });\n\n        // ✨ חדש! טיפול בשגיאות לתעודות חסרות\n        if (structure.has_doc) {\n            const foundDocsCount = searchResults.documents ? searchResults.documents.length : 0;\n            const ocrUnidentified = ocrFields.UnidentifiedNumbers || [];\n\n            // ספור כמה BOOKNUM נמצאו ב-OCR\n            const booknumPattern = /^108\\d{6}$/;\n            let expectedDocsCount = 0;\n\n            if (typeof ocrUnidentified[0] === 'object' && ocrUnidentified[0].value) {\n                expectedDocsCount = ocrUnidentified.filter(item =>\n                    booknumPattern.test(item.value)\n                ).length;\n            } else {\n                expectedDocsCount = ocrUnidentified.filter(num =>\n                    booknumPattern.test(num)\n                ).length;\n            }\n\n            // טיפול בשגיאות\n            if (foundDocsCount === 0) {\n                // אף תעודה לא נמצאה\n                if (expectedDocsCount > 0) {\n                    executionReport.errors.push(\n                        `תבנית דורשת תעודות. נמצאו ${expectedDocsCount} BOOKNUM ב-OCR אך לא נמצאה התאמה ב-docs_list`\n                    );\n                } else {\n                    executionReport.errors.push(\n                        'תבנית דורשת תעודות אך לא נמצאו BOOKNUM ב-OCR'\n                    );\n                }\n            } else if (expectedDocsCount > 0 && foundDocsCount < expectedDocsCount) {\n                // נמצאו תעודות חלקיות\n                executionReport.warnings.push(\n                    `נמצאו רק ${foundDocsCount} מתוך ${expectedDocsCount} תעודות מה-OCR. חסרות ${expectedDocsCount - foundDocsCount} תעודות`\n                );\n            }\n        }\n\n        // ============================================================================\n        // שלב 4: בניית JSON\n        // ============================================================================\n\n        executionReport.stage = \"שלב 4: בניית חשבונית\";\n\n        const invoice = buildInvoiceFromTemplate(\n            template,\n            structure,\n            config,\n            searchResults,\n            input.learned_config,\n            ocrFields,  // ✨ חדש! מעביר גם את ocrFields\n            input.docs_list  // ✨ חדש! מעביר גם את docs_list\n        );\n\n        // ============================================================================\n        // שלב 5: בקרות\n        // ============================================================================\n\n        executionReport.stage = \"שלב 5: בקרות\";\n\n        const validation = performValidation(\n            invoice,\n            ocrFields,\n            config,\n            input.docs_list,\n            patterns\n        );\n\n        // ============================================================================\n        // שלב 6: ניתוח למידה\n        // ============================================================================\n\n        executionReport.stage = \"שלב 6: ניתוח למידה\";\n\n        const learningAnalysis = analyzeLearning(invoice, config);\n\n        // ============================================================================\n        // שלב 7: ניקוי והחזרת תוצאה\n        // ============================================================================\n\n        // ניקוי שדות שלא צריכים (למידה בלבד, לא ל-Priority)\n        const cleanedInvoice = cleanInvoiceForPriority(invoice);\n\n        // ============================================================================\n        // שלב 8: יצירת פלטים נוספים - לכל תבנית אפשרית!\n        // ============================================================================\n\n        // פלט 1: חשבוניות לכל התבניות\n        const allInvoices = [];\n        for (let i = 0; i < config.structure.length; i++) {\n            const templateStructure = config.structure[i];\n            const templateData = input.learned_config.template.PINVOICES[i];\n\n            const tempInvoice = buildInvoiceFromTemplate(\n                templateData,\n                templateStructure,\n                config,\n                searchResults,\n                input.learned_config,\n                ocrFields,\n                input.docs_list\n            );\n\n            const cleanedTempInvoice = cleanInvoiceForPriority(tempInvoice);\n            allInvoices.push(cleanedTempInvoice);\n        }\n\n        // פלט 2: הנחיות ל-LLM - לכל תבנית\n        const allLlmPrompts = [];\n        const allTechnicalConfigs = [];\n\n        for (let i = 0; i < config.structure.length; i++) {\n            const templateStructure = config.structure[i];\n\n            allLlmPrompts.push(generateLLMPrompt(\n                config,\n                ocrFields,\n                searchResults,\n                executionReport,\n                i,\n                templateStructure\n            ));\n\n            allTechnicalConfigs.push(generateTechnicalConfig(\n                config,\n                ocrFields,\n                searchResults,\n                executionReport,\n                i,\n                templateStructure\n            ));\n        }\n\n        // פלט 2: הנחיות לתבנית שנבחרה (לנוחות)\n        const selectedLlmPrompt = allLlmPrompts[templateIndex];\n        const selectedTechnicalConfig = allTechnicalConfigs[templateIndex];\n\n        // פלט 3: סצנריו עיבוד - מה MAKE צריך לשלוף מהמערכת - לכל תבנית!\n        const hasVehicles = vehicleRules &&\n                           vehicleRules.vehicle_account_mapping &&\n                           Object.keys(vehicleRules.vehicle_account_mapping).length > 0;\n\n        const allProcessingScenarios = [];\n        for (let i = 0; i < config.structure.length; i++) {\n            const templateStructure = config.structure[i];\n            allProcessingScenarios.push({\n                check_docs: templateStructure.has_doc || false,\n                check_import: templateStructure.has_import || false,\n                check_vehicles: hasVehicles || false\n            });\n        }\n\n        const selectedProcessingScenario = allProcessingScenarios[templateIndex];\n\n        return {\n            status: \"success\",\n\n            // 1. JSON לפריוריטי (הפלט העיקרי) - כל התבניות!\n            invoice_data: {\n                PINVOICES: allInvoices\n            },\n\n            // 2. הנחיות ל-LLM - עם כל התבניות בפנים\n            llm_prompt: {\n                ...selectedLlmPrompt,\n                all_templates: allLlmPrompts\n            },\n\n            // 3. קונפיג טכני - עם כל התבניות בפנים\n            technical_config: {\n                ...selectedTechnicalConfig,\n                all_templates: allTechnicalConfigs\n            },\n\n            // 4. סצנריו עיבוד - מה צריך לשלוף מהמערכת - עם כל התבניות בפנים\n            processing_scenario: {\n                ...selectedProcessingScenario,\n                all_templates: allProcessingScenarios\n            }\n        };\n\n    } catch (error) {\n        return {\n            status: \"error\",\n            error_type: error.name || \"ProcessingError\",\n            message: error.message\n        };\n    }\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 1\n// ============================================================================\n\nfunction checkImportExists(importFiles) {\n    if (!importFiles || !importFiles.IMPFILES) return false;\n    if (importFiles.IMPFILES.length === 0) return false;\n\n    try {\n        const parsed = JSON.parse('[' + importFiles.IMPFILES[0] + ']');\n        return parsed.length > 0 && !!parsed[0].IMPFNUM;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction checkDocsExist(docsList) {\n    if (!docsList || docsList.DOC_YES_NO !== \"Y\") return false;\n    return docsList.list_of_docs && docsList.list_of_docs.length > 0;\n}\n\nfunction checkDocsInOCR(ocrFields, azureText) {\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n    const docPattern = /^25\\d{6}$/;          // DOCNO pattern\n    const booknumPattern = /^108\\d{6}$/;     // BOOKNUM pattern\n\n    let foundInUnidentified = false;\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            foundInUnidentified = unidentified.some(item =>\n                docPattern.test(item.value) || booknumPattern.test(item.value)\n            );\n        } else {\n            foundInUnidentified = unidentified.some(num =>\n                docPattern.test(num) || booknumPattern.test(num)\n            );\n        }\n    }\n\n    if (foundInUnidentified) return true;\n\n    if (azureText) {\n        // Search for both DOCNO and BOOKNUM patterns with word boundaries\n        const docMatches = azureText.match(/\\b25\\d{6}\\b/g);\n        const booknumMatches = azureText.match(/\\b108\\d{6}\\b/g);\n        if ((docMatches && docMatches.length > 0) || (booknumMatches && booknumMatches.length > 0)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction identifyDebitType(ocrFields) {\n    const total = ocrFields.InvoiceTotal || ocrFields.InvoiceTotal_amount || 0;\n    return total >= 0 ? \"D\" : \"C\";\n}\n\nfunction findMatchingTemplate(structures, hasImport, hasDocs, debitType) {\n    return structures.findIndex(s =>\n        s.has_import === hasImport &&\n        s.has_doc === hasDocs &&\n        s.debit_type === debitType\n    );\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 2\n// ============================================================================\n\nfunction extractPatterns(recommendedSamples, docsList) {\n    const patterns = {\n        booknum_pattern: null,\n        ivnum_pattern: null,\n        docs_pattern: null,\n        docs_totquant: {}\n    };\n\n    if (recommendedSamples && recommendedSamples.samples && recommendedSamples.samples.length > 0) {\n        const sample = recommendedSamples.samples[0];\n\n        if (sample.sample_booknum) {\n            patterns.booknum_pattern = {\n                length: sample.sample_booknum.length,\n                example: sample.sample_booknum\n            };\n        }\n\n        if (sample.sample_ivnum) {\n            patterns.ivnum_pattern = {\n                length: sample.sample_ivnum.length,\n                example: sample.sample_ivnum\n            };\n        }\n    }\n\n    if (docsList && docsList.list_of_docs && docsList.list_of_docs.length > 0) {\n        try {\n            const docs = docsList.list_of_docs.map(d => JSON.parse(d));\n\n            if (docs.length > 0) {\n                const firstDoc = docs[0];\n                patterns.docs_pattern = {\n                    booknum_example: firstDoc.BOOKNUM,\n                    docno_example: firstDoc.DOCNO\n                };\n\n                docs.forEach(doc => {\n                    if (doc.TOTQUANT) {\n                        patterns.docs_totquant[doc.BOOKNUM] = doc.TOTQUANT;\n                    }\n                });\n            }\n        } catch (e) {\n            // שגיאה בפרסור\n        }\n    }\n\n    return patterns;\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 3\n// ============================================================================\n\nfunction searchAllData(ocrFields, azureText, patterns, structure, importFiles, docsList, vehicleRules) {\n    return {\n        booknum: searchBooknum(ocrFields, patterns),\n        ivdate: searchIvdate(ocrFields),\n        details: searchDetails(ocrFields, azureText),\n        ordname: structure.has_purchase_orders || structure.has_import ? searchOrdname(ocrFields) : null,\n        impfnum: structure.has_import ? searchImpfnum(ocrFields, importFiles) : null,\n        documents: structure.has_doc ? searchDocuments(ocrFields, azureText, patterns, docsList) : null,\n        vehicles: vehicleRules ? extractVehiclesAdvanced(ocrFields, vehicleRules) : [],  // ✨ חדש!\n        items: ocrFields.Items || []\n    };\n}\n\nfunction searchBooknum(ocrFields, patterns) {\n    let booknum = ocrFields.InvoiceId || \"\";\n\n    booknum = String(booknum).replace(/^SI/i, '');\n\n    if (patterns.booknum_pattern) {\n        const expectedLength = patterns.booknum_pattern.length;\n        if (booknum.length > expectedLength) {\n            booknum = booknum.slice(-expectedLength);\n        }\n    }\n\n    return booknum;\n}\n\nfunction searchIvdate(ocrFields) {\n    const isoDate = ocrFields.InvoiceDate;\n    if (!isoDate) return \"\";\n\n    const date = new Date(isoDate);\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = String(date.getFullYear()).slice(-2);\n\n    return `${day}/${month}/${year}`;\n}\n\nfunction searchDetails(ocrFields, azureText) {\n    if (ocrFields.InvoiceDescription) {\n        return ocrFields.InvoiceDescription;\n    }\n\n    if (azureText) {\n        const lines = azureText.split('\\n').filter(l => l.trim());\n        if (lines.length > 2) {\n            return lines[2].substring(0, 100);\n        }\n    }\n\n    return \"\";\n}\n\nfunction searchOrdname(ocrFields) {\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n    const ordPattern = /^\\d{10}$/;\n    let found = \"\";\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            const orderItem = unidentified.find(item =>\n                item.label && (\n                    item.label.includes('הזמנה') ||\n                    item.label.toLowerCase().includes('order') ||\n                    item.label.toLowerCase().includes('po')\n                ) && ordPattern.test(item.value)\n            );\n\n            if (orderItem) {\n                found = orderItem.value;\n            } else {\n                const anyOrder = unidentified.find(item =>\n                    ordPattern.test(item.value)\n                );\n                found = anyOrder ? anyOrder.value : \"\";\n            }\n        } else {\n            const match = unidentified.find(num => ordPattern.test(num));\n            found = match || \"\";\n        }\n    }\n\n    return found;\n}\n\nfunction searchImpfnum(ocrFields, importFiles) {\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n    const impPattern = /^\\d{2}c\\d{5}$/;\n    let foundInOCR = \"\";\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            const importItem = unidentified.find(item =>\n                item.label && (\n                    item.label.includes('יבוא') ||\n                    item.label.toLowerCase().includes('import') ||\n                    item.label.includes('IMPFNUM')\n                ) && impPattern.test(item.value)\n            );\n\n            if (importItem) {\n                foundInOCR = importItem.value;\n            } else {\n                const anyImport = unidentified.find(item =>\n                    impPattern.test(item.value)\n                );\n                foundInOCR = anyImport ? anyImport.value : \"\";\n            }\n        } else {\n            const match = unidentified.find(num => impPattern.test(num));\n            foundInOCR = match || \"\";\n        }\n    }\n\n    if (foundInOCR) return foundInOCR;\n\n    if (importFiles && importFiles.IMPFILES && importFiles.IMPFILES.length > 0) {\n        try {\n            const parsed = JSON.parse('[' + importFiles.IMPFILES[0] + ']');\n            if (parsed.length > 0 && parsed[0].IMPFNUM) {\n                return parsed[0].IMPFNUM;\n            }\n        } catch (e) {\n            // ממשיכים בלי\n        }\n    }\n\n    return \"\";\n}\n\nfunction searchDocuments(ocrFields, azureText, patterns, docsList) {\n    const foundDocs = [];\n\n    if (!docsList || !docsList.list_of_docs || docsList.list_of_docs.length === 0) {\n        return foundDocs;\n    }\n\n    let availableDocs = [];\n    try {\n        // תיקון: flatMap כדי לשטח מערכים מקוננים\n        availableDocs = docsList.list_of_docs.flatMap(d => JSON.parse(d));\n    } catch (e) {\n        return foundDocs;\n    }\n\n    const unidentified = ocrFields.UnidentifiedNumbers || [];\n\n    if (unidentified.length > 0) {\n        if (typeof unidentified[0] === 'object' && unidentified[0].value) {\n            for (const item of unidentified) {\n                const match = availableDocs.find(doc => doc.BOOKNUM === item.value);\n\n                if (match) {\n                    foundDocs.push({\n                        DOCNO: match.DOCNO,\n                        BOOKNUM: match.BOOKNUM,\n                        TOTQUANT: match.TOTQUANT || null\n                    });\n                }\n            }\n        } else {\n            for (const num of unidentified) {\n                const match = availableDocs.find(doc => doc.BOOKNUM === num);\n\n                if (match) {\n                    foundDocs.push({\n                        DOCNO: match.DOCNO,\n                        BOOKNUM: match.BOOKNUM,\n                        TOTQUANT: match.TOTQUANT || null\n                    });\n                }\n            }\n        }\n    }\n\n    // Fallback: אם לא נמצא ב-UnidentifiedNumbers, חפש ב-AZURE_TEXT\n    if (foundDocs.length === 0 && azureText) {\n        for (const doc of availableDocs) {\n            // שיפור: חיפוש עם regex במקום includes (מדויק יותר)\n            // תבנית: גבול מילה + BOOKNUM + גבול מילה (כדי למנוע התאמה חלקית)\n            const pattern = new RegExp('\\\\b' + doc.BOOKNUM + '\\\\b');\n            if (pattern.test(azureText)) {\n                foundDocs.push({\n                    DOCNO: doc.DOCNO,\n                    BOOKNUM: doc.BOOKNUM,\n                    TOTQUANT: doc.TOTQUANT || null\n                });\n            }\n        }\n    }\n\n    // ✨ חדש! Fallback 2: התאמה לפי כמויות כשהOCR לא מצא תעודות\n    if (foundDocs.length === 0 && ocrFields.Items && ocrFields.Items.length > 0) {\n        const totalOcrQuantity = ocrFields.Items.reduce((sum, item) => sum + (item.Quantity || 0), 0);\n\n        if (totalOcrQuantity > 0) {\n            // פונקציית עזר להשוואת כמויות עם סובלנות\n            const isQuantityMatch = (qty1, qty2) => {\n                if (qty1 === qty2) return true;\n                const tolerance = Math.min(Math.abs(qty1 * 0.005), 10);\n                return Math.abs(qty1 - qty2) <= tolerance;\n            };\n\n            // נסה למצוא תעודה בודדת שמתאימה (עם סובלנות)\n            const singleMatch = availableDocs.find(doc => isQuantityMatch(doc.TOTQUANT, totalOcrQuantity));\n            if (singleMatch) {\n                foundDocs.push({\n                    DOCNO: singleMatch.DOCNO,\n                    BOOKNUM: singleMatch.BOOKNUM,\n                    TOTQUANT: singleMatch.TOTQUANT || null\n                });\n            }\n            // אם לא נמצא תעודה בודדת, נסה לחפש קומבינציה של מספר תעודות\n            else {\n                const matchedDocs = findDocCombinationByQuantity(totalOcrQuantity, availableDocs);\n                if (matchedDocs.length > 0) {\n                    foundDocs.push(...matchedDocs);\n                }\n            }\n        }\n    }\n\n    return foundDocs;\n}\n\n// ============================================================================\n// ✨ חדש! פונקציה למציאת קומבינציה של תעודות לפי כמות\n// ============================================================================\n\nfunction findDocCombinationByQuantity(targetQuantity, availableDocs) {\n    // אם אין תעודות או כמות יעד לא תקינה\n    if (!availableDocs || availableDocs.length === 0 || targetQuantity <= 0) {\n        return [];\n    }\n\n    // פונקציית עזר להשוואת כמויות עם סובלנות קטנה\n    const isQuantityMatch = (qty1, qty2) => {\n        // התאמה מדויקת\n        if (qty1 === qty2) return true;\n\n        // סובלנות של 0.5% או 10 יחידות (הקטן מביניהם)\n        const tolerance = Math.min(Math.abs(qty1 * 0.005), 10);\n        return Math.abs(qty1 - qty2) <= tolerance;\n    };\n\n    // נסה כל קומבינציה אפשרית (עד 4 תעודות מקסימום)\n    const maxCombinationSize = Math.min(4, availableDocs.length);\n\n    for (let size = 2; size <= maxCombinationSize; size++) {\n        const combinations = getCombinations(availableDocs, size);\n\n        for (const combo of combinations) {\n            const comboTotal = combo.reduce((sum, doc) => sum + (doc.TOTQUANT || 0), 0);\n\n            if (isQuantityMatch(comboTotal, targetQuantity)) {\n                // נמצאה קומבינציה מתאימה!\n                return combo.map(doc => ({\n                    DOCNO: doc.DOCNO,\n                    BOOKNUM: doc.BOOKNUM,\n                    TOTQUANT: doc.TOTQUANT || null\n                }));\n            }\n        }\n    }\n\n    return [];\n}\n\n// פונקציית עזר לחישוב קומבינציות\nfunction getCombinations(array, size) {\n    if (size === 1) {\n        return array.map(item => [item]);\n    }\n\n    const combinations = [];\n\n    for (let i = 0; i < array.length - size + 1; i++) {\n        const head = array[i];\n        const tailCombos = getCombinations(array.slice(i + 1), size - 1);\n\n        for (const combo of tailCombos) {\n            combinations.push([head, ...combo]);\n        }\n    }\n\n    return combinations;\n}\n\n// ============================================================================\n// ✨ חדש! פונקציות חילוץ רכבים מתקדם\n// ============================================================================\n\nfunction extractVehiclesAdvanced(ocrFields, vehicleRules) {\n    // תיקון: בדוק אם יש vehicle_account_mapping במקום enabled\n    if (!vehicleRules || !vehicleRules.vehicle_account_mapping) return [];\n\n    const foundVehicles = [];\n    // תיקון: אם אין search_locations, השתמש בברירת מחדל\n    const searchLocations = vehicleRules.search_locations || [\n        {\n            location: \"fields.UnidentifiedNumbers\",\n            priority: 1,\n            filter_by_label: \"רכב\",\n            description: \"חיפוש רכבים ב-UnidentifiedNumbers עם תווית רכב\"\n        }\n    ];\n\n    // סדר לפי עדיפות\n    const sortedLocations = [...searchLocations].sort((a, b) => a.priority - b.priority);\n\n    for (const location of sortedLocations) {\n        if (location.location === \"fields.VehicleNumbers\") {\n            // 1. רשימה מוכנה מאז'ור\n            if (ocrFields.VehicleNumbers && Array.isArray(ocrFields.VehicleNumbers)) {\n                ocrFields.VehicleNumbers.forEach(vNum => {\n                    if (!foundVehicles.includes(vNum)) {\n                        foundVehicles.push(vNum);\n                    }\n                });\n            }\n        }\n        else if (location.location === \"fields.Items[].VehicleNumber\") {\n            // 2. קישור ישיר בפריט\n            if (ocrFields.Items && Array.isArray(ocrFields.Items)) {\n                ocrFields.Items.forEach(item => {\n                    if (item.VehicleNumber && !foundVehicles.includes(item.VehicleNumber)) {\n                        foundVehicles.push(item.VehicleNumber);\n                    }\n                });\n            }\n        }\n        else if (location.location === \"fields.Items[].Description\" && location.pattern) {\n            // 3. חיפוש בתיאור לפי דפוס\n            if (ocrFields.Items && Array.isArray(ocrFields.Items)) {\n                const pattern = new RegExp(location.pattern);\n                ocrFields.Items.forEach(item => {\n                    if (item.Description) {\n                        const match = item.Description.match(pattern);\n                        if (match && match[0] && !foundVehicles.includes(match[0])) {\n                            foundVehicles.push(match[0]);\n                        }\n                    }\n                });\n            }\n        }\n        else if (location.location === \"fields.UnidentifiedNumbers\") {\n            // 4. מספרים לא מזוהים\n            const unidentified = ocrFields.UnidentifiedNumbers || [];\n            const vehiclePattern = /\\d{3}-\\d{2}-\\d{3}/;\n\n            unidentified.forEach(item => {\n                const value = typeof item === 'object' ? item.value : item;\n                const label = typeof item === 'object' ? (item.label || '') : '';\n                const context = typeof item === 'object' ? (item.context || '') : '';\n\n                // תיקון: גם אם יש תווית \"רכב\", חייב להתאים לדפוס מספר רכב!\n                // זה מונע טעויות של Azure OCR שמסמן מספר כרטיס בתור \"מספר רכב\"\n                const isValidVehicleNumber = vehiclePattern.test(value);\n\n                // בדיקה נוספת: אם בהקשר כתוב \"כרטיס\", זה לא רכב\n                const looksLikeCardNumber = context.includes('כרטיס') || label.includes('כרטיס');\n\n                // אם יש filter_by_label - רק עם התווית הזו וגם דפוס תקין\n                if (location.filter_by_label) {\n                    if (label && label.includes(location.filter_by_label)) {\n                        // תיקון: גם עם תווית רכב, חייב דפוס תקין ולא להיות מסומן ככרטיס\n                        if (isValidVehicleNumber && !looksLikeCardNumber && !foundVehicles.includes(value)) {\n                            foundVehicles.push(value);\n                        }\n                    }\n                } else {\n                    // אחרת - לפי דפוס רכב בלבד\n                    if (isValidVehicleNumber && !looksLikeCardNumber && !foundVehicles.includes(value)) {\n                        foundVehicles.push(value);\n                    }\n                }\n            });\n        }\n    }\n\n    return [...new Set(foundVehicles)]; // ייחודיים בלבד\n}\n\nfunction createVehicleItems(vehicles, ocrItems, vehicleRules, ocrFields) {\n    if (!vehicles || vehicles.length === 0) return [];\n\n    const vehicleItems = [];\n\n    // תיקון: מחיר = סכום כל החשבונית (לפני מע\"מ)\n    // חישוב: InvoiceTotal - TotalTax = סה\"כ לפני מע\"מ (עבודות + חלקים)\n    const totalPrice = ocrFields.TotalTax_amount\n        ? (ocrFields.InvoiceTotal_amount || 0) - ocrFields.TotalTax_amount\n        : (ocrFields.SubTotal_amount || ocrFields.InvoiceTotal_amount || 0);\n    const pricePerVehicle = vehicles.length > 0 ? totalPrice / vehicles.length : totalPrice;\n\n    vehicles.forEach(vehicleNum => {\n        // חיפוש מיפוי בחוקים\n        const mapping = vehicleRules.vehicle_account_mapping?.[vehicleNum];\n\n        // חיפוש תיאור מהפריטים של OCR\n        const relatedItem = ocrItems.find(item =>\n            (item.VehicleNumber && item.VehicleNumber === vehicleNum) ||\n            (item.Description && item.Description.includes(vehicleNum))\n        );\n\n        // תיקון: תיאור קצר בלבד\n        const shortDesc = extractShortDescription(ocrFields, vehicleNum);\n\n        // בניית פריט - רק שדות שPriority מכיר!\n        const item = {\n            PARTNAME: vehicleRules.output_format?.partname || \"car\",\n            PDES: shortDesc,\n            TQUANT: relatedItem?.Quantity || 1,\n            TUNITNAME: relatedItem?.Unit || \"יח'\",\n            PRICE: pricePerVehicle,\n            VATFLAG: mapping?.vat_pattern?.VATFLAG || \"Y\",\n            ACCNAME: mapping?.accname || vehicleRules.default_values?.accname || \"\"\n        };\n\n        // BUDCODE - חובה לפי התבנית!\n        if (mapping?.budcode) {\n            item.BUDCODE = mapping.budcode;\n        } else if (vehicleRules.default_values?.budcode) {\n            item.BUDCODE = vehicleRules.default_values.budcode;\n        }\n\n        // SPECIALVATFLAG - רק אם זה Y (לא שדות אחרים!)\n        if (mapping?.vat_pattern?.SPECIALVATFLAG === \"Y\") {\n            item.SPECIALVATFLAG = \"Y\";\n        }\n\n        // שמור מידע למידה בנפרד (לא נשלח ל-Priority!)\n        if (!mapping) {\n            // רק לצרכי דיווח ולמידה - לא ישלח ב-JSON הסופי\n            item._learningNote = \"רכב חדש - נדרש מיפוי\";\n        }\n\n        vehicleItems.push(item);\n    });\n\n    return vehicleItems;\n}\n\n// ============================================================================\n// פונקציית עזר - חילוץ תיאור קצר\n// ============================================================================\n\nfunction extractShortDescription(ocrFields, vehicleNum) {\n    // חיפוש תיאור קצר מהפריטים\n    if (ocrFields.Items && ocrFields.Items.length > 0) {\n        // חפש פריט שמכיל תיאור רלוונטי\n        const item = ocrFields.Items.find(i =>\n            i.Description && (\n                i.Description.includes(vehicleNum) ||\n                i.Description.includes('טיפול') ||\n                i.Description.includes('עבודה')\n            )\n        );\n\n        if (item && item.Description) {\n            const desc = item.Description.trim();\n\n            // תיקון חדש: חפש דפוס \"טיפול XXX ק\\\"מ\" או \"טיפול XXX,XXX ק\\\"מ\"\n            // דפוס: \"טיפול\" + מספר (עם או בלי פסיק) + \"ק\\\"מ\" או \"קמ\"\n            const servicePattern = /טיפול\\s+[\\d,]+\\s*ק[״\"]?מ/i;\n            const match = desc.match(servicePattern);\n\n            if (match) {\n                // נמצא דפוס טיפול - נקה אותו ונחזיר\n                let serviceDesc = match[0];\n                // המר \"קמ\" ל-\"ק\"מ\" והסר פסיקים מהמספר\n                serviceDesc = serviceDesc\n                    .replace(/,/g, '')          // הסר פסיקים\n                    .replace(/קמ/g, 'ק\"מ')      // תקנן את \"קמ\" ל-\"ק\"מ\"\n                    .replace(/ק״מ/g, 'ק\"מ');   // תקנן את ״ ל-\"\n\n                return serviceDesc;\n            }\n\n            // אם לא נמצא דפוס טיפול - חפש תיאורים אחרים (החלפה, תיקון, בדיקה)\n            const generalPattern = /(החלפת|תיקון|בדיקת|הח[''׳])\\s+[\\u0590-\\u05FF\\s]+/;\n            const generalMatch = desc.match(generalPattern);\n\n            if (generalMatch) {\n                // קח עד 50 תווים מהתיאור\n                let shortDesc = generalMatch[0].trim();\n                if (shortDesc.length > 50) {\n                    shortDesc = shortDesc.substring(0, 47) + '...';\n                }\n                return shortDesc;\n            }\n\n            // אם אין דפוס מיוחד - קח את 3-4 המילים הראשונות\n            const words = desc.split(/\\s+/);\n            let shortDesc = words.slice(0, 4).join(' ');\n\n            if (shortDesc.length > 50) {\n                shortDesc = shortDesc.substring(0, 47) + '...';\n            }\n\n            return shortDesc;\n        }\n    }\n\n    // אם לא מצאנו תיאור - החזר ברירת מחדל\n    return 'טיפול';\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 4\n// ============================================================================\n\nfunction buildInvoiceFromTemplate(template, structure, config, searchResults, learnedConfig, ocrFields, docsList) {\n    const invoice = {\n        SUPNAME: config.supplier_config.supplier_code,\n        CODE: template.CODE,\n        DEBIT: structure.debit_type,\n        IVDATE: searchResults.ivdate,\n        BOOKNUM: searchResults.booknum\n    };\n\n    if (searchResults.ordname) {\n        invoice.ORDNAME = searchResults.ordname;\n    }\n\n    if (searchResults.impfnum) {\n        invoice.IMPFNUM = searchResults.impfnum;\n    }\n\n    // תיקון: DETAILS - יצירה חכמה לפי רכבים\n    if (searchResults.vehicles && searchResults.vehicles.length > 0) {\n        // אם יש רכבים - בנה DETAILS עם תיאור טיפול + ק\"מ נוכחי\n        const vehicleNum = searchResults.vehicles[0];\n        const shortDesc = extractShortDescription(ocrFields, vehicleNum);\n\n        // חיפוש ק\"מ נוכחי מה-UnidentifiedNumbers או CustomerId\n        let currentMileage = '';\n\n        // נסה למצוא ק\"מ ב-UnidentifiedNumbers\n        const unidentified = ocrFields.UnidentifiedNumbers || [];\n        if (unidentified.length > 0) {\n            const mileageItem = unidentified.find(item => {\n                if (typeof item === 'object') {\n                    const label = item.label || '';\n                    const value = item.value || '';\n                    // חפש תווית \"ק\\\"מ\" או מספר בין 50000-300000 (טווח סביר לק\"מ)\n                    if (label.includes('ק') || label.includes('קמ') || label.includes('מ')) {\n                        return /^\\d{5,6}$/.test(value);\n                    }\n                }\n                return false;\n            });\n\n            if (mileageItem && typeof mileageItem === 'object') {\n                currentMileage = mileageItem.value;\n            }\n        }\n\n        // אם לא נמצא, נסה CustomerId (לפעמים Azure מזהה את ק\"מ כ-CustomerId)\n        if (!currentMileage && ocrFields.CustomerId && /^\\d{5,6}$/.test(ocrFields.CustomerId)) {\n            currentMileage = ocrFields.CustomerId;\n        }\n\n        // בנה DETAILS לפי הפורמט: \"תיאור טיפול-XXXXXק\\\"מ\"\n        invoice.DETAILS = currentMileage ? `${shortDesc}-${currentMileage}` : shortDesc;\n    } else if (searchResults.details) {\n        // אחרת - השתמש ב-DETAILS הרגיל\n        invoice.DETAILS = searchResults.details;\n    }\n\n    // תעודות\n    if (structure.has_doc) {\n        // אם מצאנו תעודות ב-OCR - השתמש בהן\n        if (searchResults.documents && searchResults.documents.length > 0) {\n            if (searchResults.documents.length === 1) {\n                invoice.DOCNO = searchResults.documents[0].DOCNO;\n            } else {\n                invoice.PIVDOC_SUBFORM = searchResults.documents.map(d => ({\n                    DOCNO: d.DOCNO,\n                    BOOKNUM: d.BOOKNUM\n                }));\n            }\n        }\n        // אם לא מצאנו ב-OCR אבל יש ב-docs_list - קח מ-docs_list\n        else if (docsList && docsList.DOC_YES_NO === \"Y\" && docsList.list_of_docs && docsList.list_of_docs.length > 0) {\n            try {\n                const docs = docsList.list_of_docs.flatMap(d => JSON.parse(d));\n                if (docs.length === 1) {\n                    invoice.DOCNO = docs[0].DOCNO;\n                } else if (docs.length > 1) {\n                    invoice.PIVDOC_SUBFORM = docs.map(d => ({\n                        DOCNO: d.DOCNO,\n                        BOOKNUM: d.BOOKNUM\n                    }));\n                }\n            } catch (e) {\n                // אם יש שגיאת parsing, המשך בלי תעודות\n            }\n        }\n    }\n\n    // פריטים\n    const needItems = shouldAddItems(structure, searchResults.documents, docsList);\n\n    if (needItems) {\n        const vehicleRules = config.rules?.critical_patterns?.vehicle_rules;\n\n        // ✨ חדש! אם יש רכבים - יוצרים פריטי רכבים\n        if (searchResults.vehicles && searchResults.vehicles.length > 0 && vehicleRules) {\n            invoice.PINVOICEITEMS_SUBFORM = createVehicleItems(\n                searchResults.vehicles,\n                searchResults.items,\n                vehicleRules,\n                ocrFields  // תיקון: העברת ocrFields\n            );\n        }\n        // אחרת - פריטים רגילים מ-OCR\n        else if (searchResults.items && searchResults.items.length > 0) {\n            invoice.PINVOICEITEMS_SUBFORM = buildItems(\n                searchResults.items,\n                config,\n                structure,\n                template,\n                learnedConfig\n            );\n        }\n    }\n\n    if (template.PINVOICESCONT_SUBFORM) {\n        invoice.PINVOICESCONT_SUBFORM = template.PINVOICESCONT_SUBFORM;\n    }\n\n    return invoice;\n}\n\nfunction shouldAddItems(structure, documents, docsList) {\n    // אם אין תעודות בכלל בתבנית → צריך פריטים\n    if (!structure.has_doc) return true;\n\n    // בדוק אם יש תעודות בפועל (ב-OCR או ב-docs_list)\n    const hasDocsInOCR = documents && documents.length > 0;\n    const hasDocsInList = docsList && docsList.DOC_YES_NO === \"Y\";\n    const hasDocsActually = hasDocsInOCR || hasDocsInList;\n\n    // אם התבנית אומרת שיש תעודות אבל אין בפועל → צריך פריטים\n    if (structure.has_doc && !hasDocsActually) return true;\n\n    // אם יש תעודות בפועל:\n    if (hasDocsActually) {\n        // אם יש גם יבוא → לא צריך פריטים (הכל בתעודות)\n        if (structure.has_import) return false;\n\n        // אם אין יבוא אבל יש מלאי לא מנוהל → צריך פריטים\n        if (structure.inventory_management === \"not_managed_inventory\") return true;\n    }\n\n    // אחרת → לא צריך פריטים\n    return false;\n}\n\nfunction buildItems(ocrItems, config, structure, template, learnedConfig) {\n    let defaultAccname = \"\";\n\n    if (template.PINVOICEITEMS_SUBFORM && template.PINVOICEITEMS_SUBFORM.length > 0) {\n        defaultAccname = template.PINVOICEITEMS_SUBFORM[0].ACCNAME || \"\";\n    }\n\n    if (!defaultAccname && config.document_types && config.document_types.length > 0) {\n        const docType = config.document_types[0];\n        if (docType.accnames && docType.accnames.length > 0) {\n            defaultAccname = docType.accnames[0];\n        }\n    }\n\n    let defaultBudcode = \"\";\n    if (template.PINVOICEITEMS_SUBFORM && template.PINVOICEITEMS_SUBFORM.length > 0) {\n        defaultBudcode = template.PINVOICEITEMS_SUBFORM[0].BUDCODE || \"\";\n    }\n\n    return ocrItems.map(ocrItem => {\n        const item = {\n            PARTNAME: extractPartname(ocrItem.ProductCode),\n            PDES: ocrItem.Description || \"\",\n            TQUANT: ocrItem.Quantity || 1,\n            TUNITNAME: ocrItem.Unit || \"יח'\",\n            PRICE: ocrItem.UnitPrice || ocrItem.UnitPrice_amount || 0,\n            VATFLAG: \"Y\",\n            ACCNAME: defaultAccname\n        };\n\n        if (item.PARTNAME === \"car\" && config.rules.critical_patterns.vehicle_rules) {\n            applyVehicleRules(item, ocrItem.Description, config.rules.critical_patterns.vehicle_rules);\n        }\n\n        if (config.rules.critical_patterns.partname_rules) {\n            applyPartnameRules(item, config.rules.critical_patterns.partname_rules);\n        }\n\n        if (structure.has_budcode && defaultBudcode) {\n            item.BUDCODE = defaultBudcode;\n        }\n\n        return item;\n    });\n}\n\nfunction extractPartname(productCode) {\n    if (!productCode) return \"\";\n\n    const codes = String(productCode).split('\\n');\n    const priorityCode = codes.find(c => /^[A-Z]/.test(c) || /^\\d+$/.test(c));\n\n    return priorityCode || codes[0] || \"\";\n}\n\nfunction applyVehicleRules(item, description, vehicleRules) {\n    if (!vehicleRules.vehicle_account_mapping) return;\n\n    const vehicleMatch = description.match(/\\d{3}-\\d{2}-\\d{3}/);\n    if (!vehicleMatch) return;\n\n    const vehicleNum = vehicleMatch[0];\n    const mapping = vehicleRules.vehicle_account_mapping[vehicleNum];\n\n    if (mapping) {\n        item.ACCNAME = mapping.accname;\n        item.VATFLAG = mapping.vat_pattern?.VATFLAG || mapping.vatflag || item.VATFLAG;\n\n        if (mapping.vat_pattern?.SPECIALVATFLAG && mapping.vat_pattern.SPECIALVATFLAG !== \"varies\") {\n            item.SPECIALVATFLAG = mapping.vat_pattern.SPECIALVATFLAG;\n        }\n\n        if (mapping.budcode) {\n            item.BUDCODE = mapping.budcode;\n        }\n    }\n}\n\nfunction applyPartnameRules(item, partnameRules) {\n    const rule = partnameRules[item.PARTNAME];\n\n    if (rule) {\n        if (rule.accname) item.ACCNAME = rule.accname;\n        if (rule.vatflag) item.VATFLAG = rule.vatflag;\n        if (rule.specialvatflag) item.SPECIALVATFLAG = rule.specialvatflag;\n    }\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 5 (בקרות)\n// ============================================================================\n\nfunction performValidation(invoice, ocrFields, config, docsList, patterns) {\n    const warnings = [];\n    const checks = {};\n\n    let invoiceTotquant = 0;\n    if (invoice.PINVOICEITEMS_SUBFORM) {\n        invoiceTotquant = invoice.PINVOICEITEMS_SUBFORM.reduce(\n            (sum, item) => sum + (item.TQUANT || 0),\n            0\n        );\n    }\n\n    let docsTotquant = 0;\n    if (docsList && docsList.list_of_docs) {\n        try {\n            const docs = docsList.list_of_docs.map(d => JSON.parse(d));\n            docsTotquant = docs.reduce((sum, d) => sum + (d.TOTQUANT || 0), 0);\n        } catch (e) {\n            // ממשיכים בלי\n        }\n    }\n\n    const learnedTotquant = config.rules.validation_data.TOTQUANT || 0;\n\n    checks.totquant = {\n        invoice_items_sum: invoiceTotquant,\n        docs_sum: docsTotquant,\n        learned_reference: learnedTotquant,\n        items_vs_docs_match: invoiceTotquant === docsTotquant || docsTotquant === 0,\n        notes: []\n    };\n\n    if (invoiceTotquant !== docsTotquant && docsTotquant > 0) {\n        warnings.push(`אי התאמת כמויות: פריטים=${invoiceTotquant}, תעודות=${docsTotquant}`);\n        checks.totquant.notes.push(\"אי התאמה בין פריטים לתעודות\");\n    }\n\n    if (patterns.booknum_pattern) {\n        const expected = patterns.booknum_pattern.length;\n        const actual = invoice.BOOKNUM.length;\n\n        checks.booknum_pattern = {\n            expected_length: expected,\n            actual_length: actual,\n            match: expected === actual,\n            pattern_example: patterns.booknum_pattern.example\n        };\n\n        if (expected !== actual) {\n            warnings.push(`דפוס BOOKNUM: צפוי ${expected} ספרות, קיבלנו ${actual}`);\n        }\n    }\n\n    const requiredFields = [\"SUPNAME\", \"CODE\", \"DEBIT\", \"IVDATE\", \"BOOKNUM\"];\n    const missingFields = requiredFields.filter(f => !invoice[f]);\n\n    if (missingFields.length > 0) {\n        warnings.push(`שדות חובה חסרים: ${missingFields.join(', ')}`);\n    }\n\n    if (invoice.PINVOICEITEMS_SUBFORM) {\n        const emptyAccounts = invoice.PINVOICEITEMS_SUBFORM.filter(\n            item => !item.ACCNAME || item.ACCNAME === \"\"\n        );\n\n        if (emptyAccounts.length > 0) {\n            warnings.push(`${emptyAccounts.length} פריטים ללא ACCNAME`);\n        }\n    }\n\n    return {\n        all_valid: warnings.length === 0,\n        checks: checks,\n        warnings: warnings\n    };\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 6 (למידה)\n// ============================================================================\n\nfunction analyzeLearning(invoice, config) {\n    const newPatterns = {\n        new_partnames: [],\n        new_vehicles: [],\n        unknown_accounts: []\n    };\n\n    const instructions = [];\n\n    if (invoice.PINVOICEITEMS_SUBFORM) {\n        invoice.PINVOICEITEMS_SUBFORM.forEach(item => {\n            const partnameKnown = config.rules.critical_patterns.partname_rules &&\n                                config.rules.critical_patterns.partname_rules[item.PARTNAME];\n\n            if (!partnameKnown && item.PARTNAME !== \"car\") {\n                newPatterns.new_partnames.push({\n                    partname: item.PARTNAME,\n                    pdes: item.PDES,\n                    suggested_accname: item.ACCNAME\n                });\n\n                instructions.push({\n                    type: \"add_partname_rule\",\n                    partname: item.PARTNAME,\n                    suggested_accname: item.ACCNAME,\n                    priority: \"medium\"\n                });\n            }\n\n            // ✨ חדש! זיהוי רכב חדש\n            if (item.PARTNAME === \"car\" || item.isNewVehicle) {\n                const vehicleMatch = item.PDES.match(/\\d{3}-\\d{2}-\\d{3}/);\n                if (vehicleMatch) {\n                    const vNum = vehicleMatch[0];\n                    const vehicleKnown = config.rules?.critical_patterns?.vehicle_rules?.vehicle_account_mapping?.[vNum];\n\n                    if (!vehicleKnown || item.isNewVehicle) {\n                        newPatterns.new_vehicles.push({\n                            vehicle_number: vNum,\n                            suggested_accname: item.ACCNAME,\n                            suggested_budcode: item.BUDCODE,\n                            suggested_vatflag: item.VATFLAG\n                        });\n\n                        instructions.push({\n                            type: \"add_vehicle_rule\",\n                            vehicle_number: vNum,\n                            suggested_accname: item.ACCNAME,\n                            suggested_budcode: item.BUDCODE,\n                            priority: \"high\"\n                        });\n                    }\n                }\n            }\n\n            if (!item.ACCNAME || item.ACCNAME === \"\") {\n                newPatterns.unknown_accounts.push({\n                    partname: item.PARTNAME,\n                    pdes: item.PDES\n                });\n\n                instructions.push({\n                    type: \"missing_account\",\n                    partname: item.PARTNAME,\n                    priority: \"critical\"\n                });\n            }\n        });\n    }\n\n    const learningRequired =\n        newPatterns.new_partnames.length > 0 ||\n        newPatterns.new_vehicles.length > 0 ||\n        newPatterns.unknown_accounts.length > 0;\n\n    return {\n        learning_required: learningRequired,\n        new_patterns: newPatterns,\n        learning_instructions: instructions,\n        recommendation: learningRequired ? \"שלח לקוד 3 ללמידה\" : \"אין צורך בלמידה\"\n    };\n}\n\n// ============================================================================\n// פונקציות עזר - שלב 7 (יצירת פלטים נוספים)\n// ============================================================================\n\nfunction generateLLMPrompt(config, ocrFields, searchResults, executionReport, templateIndex, structure) {\n    const supplierCode = config.supplier_config.supplier_code;\n    const supplierName = config.supplier_config.supplier_name;\n\n    // בניית הסבר על כל שדה\n    const fieldInstructions = {};\n\n    // BOOKNUM\n    fieldInstructions.booknum = {\n        field_name: \"BOOKNUM\",\n        description: \"מספר חשבונית\",\n        how_to_find: \"חפש בשדה InvoiceId ב-OCR. הסר קידומת SI אם קיימת. קח את מספר התווים האחרונים לפי הדפוס הנלמד.\",\n        example: searchResults.booknum || \"1015938\",\n        ocr_source: \"ocrFields.InvoiceId\"\n    };\n\n    // IVDATE\n    fieldInstructions.ivdate = {\n        field_name: \"IVDATE\",\n        description: \"תאריך חשבונית\",\n        how_to_find: \"קח את InvoiceDate מה-OCR והמר לפורמט DD/MM/YY\",\n        example: searchResults.ivdate || \"10/09/25\",\n        ocr_source: \"ocrFields.InvoiceDate\"\n    };\n\n    // PRICE - חשוב!\n    fieldInstructions.price = {\n        field_name: \"PRICE\",\n        description: \"מחיר לפני מע\\\"מ (עבודות + חלקים)\",\n        how_to_calculate: \"חשב: InvoiceTotal_amount - TotalTax_amount. זה נותן את סה\\\"כ החשבונית לפני מע\\\"מ.\",\n        formula: \"InvoiceTotal_amount - TotalTax_amount\",\n        example: ocrFields.InvoiceTotal_amount && ocrFields.TotalTax_amount\n            ? `${ocrFields.InvoiceTotal_amount} - ${ocrFields.TotalTax_amount} = ${ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount}`\n            : \"2524 - 385.02 = 2138.98\",\n        fallback: \"אם אין TotalTax_amount, קח SubTotal_amount. אם גם זה לא קיים, קח InvoiceTotal_amount.\",\n        ocr_source: \"ocrFields.InvoiceTotal_amount, ocrFields.TotalTax_amount\"\n    };\n\n    // VEHICLES\n    const vehicleRules = config.rules?.critical_patterns?.vehicle_rules;\n    if (vehicleRules) {\n        fieldInstructions.vehicles = {\n            field_name: \"VEHICLES\",\n            description: \"מספרי רכבים\",\n            how_to_find: \"חפש פורמט XXX-XX-XXX ב-UnidentifiedNumbers עם label='רכב'. בדוק שזה לא מספר כרטיס (context לא מכיל 'כרטיס').\",\n            pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\",\n            example: searchResults.vehicles && searchResults.vehicles.length > 0\n                ? searchResults.vehicles.join(', ')\n                : \"459-06-303\",\n            ocr_source: \"ocrFields.UnidentifiedNumbers (with label filter)\"\n        };\n    }\n\n    // DETAILS\n    fieldInstructions.details = {\n        field_name: \"DETAILS\",\n        description: \"תיאור החשבונית\",\n        how_to_find: \"אם יש רכבים: חלץ תיאור קצר של השירות (3-4 מילים, מקסימום 50 תווים) מהפריט הראשון ב-Items. אם יש גם ק\\\"מ נוכחי (CustomerId), הוסף אותו בפורמט: 'תיאור-XXXXXק\\\"מ'\",\n        example: \"טיפול 75000 ק\\\"מ-76256\",\n        ocr_source: \"ocrFields.Items[0].Description, ocrFields.CustomerId\"\n    };\n\n    // מיפוי רכבים\n    const vehicleMapping = {};\n    if (vehicleRules && vehicleRules.vehicle_account_mapping) {\n        Object.keys(vehicleRules.vehicle_account_mapping).forEach(vNum => {\n            const mapping = vehicleRules.vehicle_account_mapping[vNum];\n            vehicleMapping[vNum] = {\n                account: mapping.accname,\n                budget_code: mapping.budcode,\n                vat_flag: mapping.vat_pattern?.VATFLAG || \"Y\",\n                description: mapping.accdes || `רכב ${vNum}`\n            };\n        });\n    }\n\n    // בניית document_type דינמית לפי מבנה התבנית שנבחרה\n    let documentType = \"\";\n    if (structure.has_import && structure.has_doc) {\n        documentType = \"חשבונית עם תיק יבוא עם תעודות\";\n    } else if (structure.has_import) {\n        documentType = \"חשבונית יבוא\";\n    } else if (structure.has_doc) {\n        documentType = \"חשבונית עם תעודות\";\n    } else if (structure.debit_type === \"C\") {\n        documentType = \"זיכוי רגיל עם פירוט\";\n    } else if (vehicleRules && Object.keys(vehicleRules.vehicle_account_mapping || {}).length > 0) {\n        documentType = \"חשבונית שירותי רכב ומוסך\";\n    } else {\n        documentType = \"חשבונית רגילה עם פירוט\";\n    }\n\n    // בניית overview דינמי לפי מבנה התבנית שנבחרה\n    let overview = `חשבונית מספק ${supplierName}.`;\n\n    if (structure.has_import && structure.has_doc) {\n        overview += \" תבנית: יבוא + תעודות. הספק מספק מוצרי מצאי ויבוא.\";\n    } else if (structure.has_import) {\n        overview += \" תבנית: יבוא. הספק מספק מוצרים מיובאים.\";\n    } else if (structure.has_doc) {\n        overview += \" תבנית: תעודות. הספק מספק מוצרים על בסיס תעודות אספקה.\";\n    } else if (vehicleRules && Object.keys(vehicleRules.vehicle_account_mapping || {}).length > 0) {\n        overview += \" תבנית: שירותי רכב ומוסך.\";\n    } else {\n        overview += \" תבנית: חשבונית רגילה עם פירוט.\";\n    }\n\n    // בניית processing_steps דינמי לפי מבנה התבנית\n    const processingSteps = [];\n    processingSteps.push(\"1. זהה את מספר החשבונית (BOOKNUM) מתוך InvoiceId\");\n    processingSteps.push(\"2. חלץ תאריך חשבונית (IVDATE) מתוך InvoiceDate\");\n\n    if (structure.has_import) {\n        processingSteps.push(\"3. זהה מספר יבוא (IMPFNUM) מתוך import_files\");\n    }\n\n    if (structure.has_doc) {\n        processingSteps.push(`${processingSteps.length + 1}. זהה תעודות (DOCNO/BOOKNUM) - חפש מספרים בפורמט 25XXXXXX או 108XXXXXX`);\n    }\n\n    if (structure.has_purchase_orders) {\n        processingSteps.push(`${processingSteps.length + 1}. זהה הזמנת רכש (ORDNAME) אם קיימת`);\n    }\n\n    if (vehicleRules && Object.keys(vehicleRules.vehicle_account_mapping || {}).length > 0) {\n        processingSteps.push(`${processingSteps.length + 1}. חלץ מספרי רכבים מ-UnidentifiedNumbers (פורמט XXX-XX-XXX)`);\n        processingSteps.push(`${processingSteps.length + 1}. מפה כל רכב לחשבון הנכון לפי vehicle_mapping`);\n        processingSteps.push(`${processingSteps.length + 1}. צור תיאור קצר של השירות מהפריט הראשון`);\n    } else {\n        processingSteps.push(`${processingSteps.length + 1}. חשב את המחיר הכולל לפני מע\"מ: InvoiceTotal - TotalTax`);\n    }\n\n    return {\n        supplier_code: supplierCode,\n        supplier_name: supplierName,\n        document_type: documentType,\n        instructions: {\n            overview: overview,\n            processing_steps: processingSteps,\n            fields: fieldInstructions,\n            vehicle_mapping: vehicleMapping\n        }\n    };\n}\n\nfunction generateTechnicalConfig(config, ocrFields, searchResults, executionReport, templateIndex, structure) {\n    const supplierCode = config.supplier_config.supplier_code;\n    const supplierName = config.supplier_config.supplier_name;\n\n    // extraction rules מפורטים\n    const extractionRules = {};\n\n    // BOOKNUM\n    extractionRules.booknum = {\n        source: \"ocrFields.InvoiceId\",\n        transformations: [\n            {\n                action: \"remove_prefix\",\n                pattern: \"^SI\",\n                case_insensitive: true,\n                description: \"הסר קידומת SI אם קיימת\"\n            },\n            {\n                action: \"take_last_n_chars\",\n                count: 7,\n                description: \"קח 7 תווים אחרונים\"\n            }\n        ],\n        validation: {\n            length: 7,\n            pattern: \"^\\\\d{7}$\",\n            required: true\n        },\n        example: searchResults.booknum || \"1015938\"\n    };\n\n    // IVDATE\n    extractionRules.ivdate = {\n        source: \"ocrFields.InvoiceDate\",\n        format: \"DD/MM/YY\",\n        transformation: {\n            from: \"ISO8601\",\n            to: \"DD/MM/YY\",\n            description: \"המר מפורמט ISO (YYYY-MM-DD) לפורמט DD/MM/YY\"\n        },\n        validation: {\n            pattern: \"^\\\\d{2}/\\\\d{2}/\\\\d{2}$\",\n            required: true\n        },\n        example: searchResults.ivdate || \"10/09/25\"\n    };\n\n    // PRICE - החישוב החשוב!\n    extractionRules.price = {\n        calculation: {\n            method: \"subtract\",\n            primary: {\n                formula: \"ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount\",\n                fields_required: [\"InvoiceTotal_amount\", \"TotalTax_amount\"],\n                description: \"סה\\\"כ לפני מע\\\"מ = סה\\\"כ כולל מע\\\"מ - מע\\\"מ\"\n            },\n            fallback: {\n                formula: \"ocrFields.SubTotal_amount || ocrFields.InvoiceTotal_amount\",\n                fields_required: [\"SubTotal_amount\"],\n                description: \"אם אין TotalTax_amount, קח SubTotal_amount\"\n            },\n            division_by_vehicles: {\n                enabled: true,\n                formula: \"totalPrice / vehicles.length\",\n                description: \"אם יש מספר רכבים, חלק את המחיר הכולל באופן שווה\"\n            }\n        },\n        description: \"מחיר לפני מע\\\"מ (עבודות + חלקים)\",\n        example_calculation: ocrFields.InvoiceTotal_amount && ocrFields.TotalTax_amount\n            ? {\n                invoice_total: ocrFields.InvoiceTotal_amount,\n                total_tax: ocrFields.TotalTax_amount,\n                calculated_price: ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount,\n                formula_used: \"InvoiceTotal_amount - TotalTax_amount\"\n            }\n            : {\n                invoice_total: 2524,\n                total_tax: 385.02,\n                calculated_price: 2138.98,\n                formula_used: \"2524 - 385.02\"\n            }\n    };\n\n    // VEHICLES\n    const vehicleRules = config.rules?.critical_patterns?.vehicle_rules;\n    if (vehicleRules) {\n        extractionRules.vehicles = {\n            search_locations: [\n                {\n                    field: \"ocrFields.UnidentifiedNumbers\",\n                    priority: 1,\n                    filter: {\n                        label: \"רכב\",\n                        description: \"רק פריטים עם תווית 'רכב'\"\n                    },\n                    pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\",\n                    validation: {\n                        must_match_pattern: true,\n                        exclude_if_context_contains: [\"כרטיס\"],\n                        description: \"בדוק שזה לא מספר כרטיס\"\n                    }\n                },\n                {\n                    field: \"ocrFields.VehicleNumbers\",\n                    priority: 2,\n                    pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\"\n                },\n                {\n                    field: \"ocrFields.Items[].Description\",\n                    priority: 3,\n                    pattern: \"\\\\d{3}-\\\\d{2}-\\\\d{3}\",\n                    description: \"חפש בתיאור הפריטים\"\n                }\n            ],\n            example: searchResults.vehicles || [\"459-06-303\"]\n        };\n    }\n\n    // DOCUMENTS (DOCNO + BOOKNUM) - רק אם התבנית שנבחרה דורשת תעודות\n    if (structure.has_doc) {\n        extractionRules.documents = {\n            search_in: [\n                {\n                    location: \"ocrFields.UnidentifiedNumbers\",\n                    priority: 1,\n                    filter: {\n                        label: \"מס׳ הקצאה (BOOKNUM)\",\n                        description: \"חפש במערך UnidentifiedNumbers עם תווית BOOKNUM\"\n                    },\n                    pattern: \"\\\\b(108\\\\d{6})\\\\b\",\n                    description: \"BOOKNUM - 9 ספרות מתחיל ב-108\"\n                },\n                {\n                    location: \"AZURE_TEXT\",\n                    priority: 2,\n                    fallback: true,\n                    pattern: \"\\\\b(108\\\\d{6})\\\\b\",\n                    description: \"חיפוש fallback ב-AZURE_TEXT אם לא נמצא ב-UnidentifiedNumbers\"\n                }\n            ],\n            matching: {\n                match_field: \"BOOKNUM\",\n                lookup_source: \"docs_list.list_of_docs\",\n                output_fields: [\"DOCNO\", \"BOOKNUM\"],\n                description: \"התאם את BOOKNUM שנמצא ב-OCR עם docs_list כדי לקבל DOCNO\"\n            },\n            output_format: {\n                field_name: \"PIVDOC_SUBFORM\",\n                structure: [\n                    {\n                        DOCNO: \"string - מספר תעודה פנימי ב-Priority (25XXXXXX)\",\n                        BOOKNUM: \"string - מספר הקצאה חיצוני (108XXXXXX)\"\n                    }\n                ]\n            },\n            error_handling: {\n                if_none_found: {\n                    action: \"return_partial_json\",\n                    include_empty_array: true,\n                    add_to_report: \"errors\",\n                    message: \"תבנית דורשת תעודות אך לא נמצאו ב-OCR\"\n                },\n                if_partial_found: {\n                    action: \"return_partial_json\",\n                    include_found_items: true,\n                    add_to_report: \"warnings\",\n                    message: \"נמצאו רק {found_count} מתוך {expected_count} תעודות\"\n                }\n            },\n            example: searchResults.documents || [\n                { DOCNO: \"25026849\", BOOKNUM: \"108379736\" },\n                { DOCNO: \"25026850\", BOOKNUM: \"108379734\" }\n            ]\n        };\n    }\n\n    // DESCRIPTION\n    extractionRules.description = {\n        source: \"ocrFields.Items[0].Description\",\n        extraction: {\n            method: \"pattern_match\",\n            patterns: [\n                {\n                    name: \"service_with_km\",\n                    pattern: \"טיפול\\\\s+[\\\\d,]+\\\\s*ק[״\\\"]?מ\",\n                    priority: 1,\n                    description: \"טיפול XXX ק\\\"מ\"\n                },\n                {\n                    name: \"general_service\",\n                    pattern: \"(החלפת|תיקון|בדיקת)\\\\s+[\\\\u0590-\\\\u05FF\\\\s]+\",\n                    priority: 2,\n                    description: \"תיאור כללי של שירות\"\n                }\n            ],\n            max_words: 4,\n            max_length: 50,\n            append_mileage: {\n                enabled: true,\n                source: \"ocrFields.CustomerId\",\n                format: \"{description}-{mileage}\",\n                description: \"אם יש ק\\\"מ נוכחי, הוסף בפורמט: 'תיאור-XXXXXק\\\"מ'\"\n            }\n        },\n        fallback: \"טיפול\",\n        example: \"טיפול 75000 ק\\\"מ\"\n    };\n\n    // Vehicle mapping\n    const vehicleMapping = {};\n    if (vehicleRules && vehicleRules.vehicle_account_mapping) {\n        Object.keys(vehicleRules.vehicle_account_mapping).forEach(vNum => {\n            const mapping = vehicleRules.vehicle_account_mapping[vNum];\n            vehicleMapping[vNum] = {\n                accname: mapping.accname,\n                accdes: mapping.accdes,\n                budcode: mapping.budcode,\n                vat_pattern: {\n                    VATFLAG: mapping.vat_pattern?.VATFLAG || \"Y\",\n                    SPECIALVATFLAG: mapping.vat_pattern?.SPECIALVATFLAG\n                },\n                date_range_pattern: mapping.date_range_pattern || \"never\",\n                pdaccname_pattern: mapping.pdaccname_pattern || \"never\"\n            };\n        });\n    }\n\n    // Template structure\n    const template = {\n        SUPNAME: supplierCode,\n        CODE: \"ש\\\"ח\",\n        DEBIT: \"D\",\n        TUNITNAME: \"יח'\",\n        TQUANT: 1,\n        PINVOICESCONT_SUBFORM: [\n            { FNCPATNAME: \"2323\" }\n        ]\n    };\n\n    // קביעת document_type דינמי לפי התבנית שנבחרה\n    let documentTypeKey = \"regular_invoice\";\n    if (structure.has_import && structure.has_doc) {\n        documentTypeKey = \"import_with_docs_invoice\";\n    } else if (structure.has_import) {\n        documentTypeKey = \"import_invoice\";\n    } else if (structure.has_doc) {\n        documentTypeKey = \"docs_invoice\";\n    } else if (structure.debit_type === \"C\") {\n        documentTypeKey = \"credit_note\";\n    } else if (config.rules?.critical_patterns?.vehicle_rules?.vehicle_account_mapping &&\n               Object.keys(config.rules.critical_patterns.vehicle_rules.vehicle_account_mapping).length > 0) {\n        documentTypeKey = \"vehicle_service_invoice\";\n    }\n\n    return {\n        supplier_code: supplierCode,\n        supplier_name: supplierName,\n        version: \"4.2\",\n        document_type: documentTypeKey,\n        extraction_rules: extractionRules,\n        vehicle_mapping: vehicleMapping,\n        template: template,\n        validation_rules: {\n            required_fields: [\"SUPNAME\", \"CODE\", \"DEBIT\", \"IVDATE\", \"BOOKNUM\"],\n            booknum_length: 7,\n            totquant_check: {\n                enabled: true,\n                compare_with_docs: true,\n                learned_reference: config.rules.validation_data.TOTQUANT || 1\n            }\n        }\n    };\n}\n\n// ============================================================================\n// נקודת כניסה - רק אם input מוגדר (סביבת Azure Functions)\n// ============================================================================\n\nif (typeof input !== 'undefined') {\n    const processInput = {\n        learned_config: input.learned_config,\n        docs_list: input.docs_list,\n        import_files: input.import_files,\n        AZURE_RESULT: input.AZURE_RESULT,\n        AZURE_TEXT: input.AZURE_TEXT\n    };\n\n    const result = processInvoiceComplete(processInput);\n\n    console.log(JSON.stringify(result));\n    return result;\n}\n\n// ============================================================================\n// ייצוא פונקציות למודול\n// ============================================================================\nmodule.exports = {\n    processInvoiceComplete\n};\n"
    }
]
