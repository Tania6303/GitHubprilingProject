'{"status":"success","llm_prompt":{"supplier_code":"2511","supplier_name":"פלסאון בע\"מ","all_templates":[{"document_type":"חשבונית עם תעודות","instructions":{"overview":"חשבונית מספק פלסאון בע\"מ. תבנית: תעודות. הספק מספק מוצרים על בסיס תעודות אספקה.","processing_steps":["1. זהה את מספר החשבונית (BOOKNUM) מתוך InvoiceId","2. חלץ תאריך חשבונית (IVDATE) מתוך InvoiceDate","3. זהה תעודות (DOCNO/BOOKNUM) - זוהו 1 מספרי BOOKNUM בפורמט 107XXXXXX (דוגמאות: 107763233). חפש מספרים אלו בטקסט והתאם עם docs_list","4. חשב את המחיר הכולל לפני מע\"מ: InvoiceTotal - TotalTax"],"fields":{"booknum":{"field_name":"BOOKNUM","description":"מספר חשבונית","how_to_find":"חפש בשדה InvoiceId ב-OCR. הסר קידומת SI אם קיימת. קח את מספר התווים האחרונים לפי הדפוס הנלמד.","example":"258001213","ocr_source":"ocrFields.InvoiceId"},"ivdate":{"field_name":"IVDATE","description":"תאריך חשבונית","how_to_find":"קח את InvoiceDate מה-OCR והמר לפורמט DD/MM/YY","example":"12/08/25","ocr_source":"ocrFields.InvoiceDate"},"price":{"field_name":"PRICE","description":"מחיר לפני מע\"מ (עבודות + חלקים)","how_to_calculate":"חשב: InvoiceTotal_amount - TotalTax_amount. זה נותן את סה\"כ החשבונית לפני מע\"מ.","formula":"InvoiceTotal_amount - TotalTax_amount","example":"43766.77 - 6676.29 = 37090.479999999996","fallback":"אם אין TotalTax_amount, קח SubTotal_amount. אם גם זה לא קיים, קח InvoiceTotal_amount.","ocr_source":"ocrFields.InvoiceTotal_amount, ocrFields.TotalTax_amount"},"vehicles":{"field_name":"VEHICLES","description":"מספרי רכבים","how_to_find":"חפש פורמט XXX-XX-XXX ב-UnidentifiedNumbers עם label='רכב'. בדוק שזה לא מספר כרטיס (context לא מכיל 'כרטיס').","pattern":"d{3}-d{2}-d{3}","example":"459-06-303","ocr_source":"ocrFields.UnidentifiedNumbers (with label filter)"},"details":{"field_name":"DETAILS","description":"תיאור החשבונית","how_to_find":"אם יש רכבים: חלץ תיאור קצר של השירות (3-4 מילים, מקסימום 50 תווים) מהפריט הראשון ב-Items. אם יש גם ק\"מ נוכחי (CustomerId), הוסף אותו בפורמט: 'תיאור-XXXXXק\"מ'","example":"טיפול 75000 ק\"מ-76256","ocr_source":"ocrFields.Items[0].Description, ocrFields.CustomerId"}},"vehicle_mapping":{}},"invoice_data":{"PINVOICES":[{"SUPNAME":"2511","CODE":"ש\"ח","DEBIT":"D","IVDATE":"12/08/25","BOOKNUM":"258001213","DETAILS":"על ידי גורם מאשר","PINVOICEITEMS_SUBFORM":[{"PARTNAME":"","TUNITNAME":"יח'","VATFLAG":"Y","ACCNAME":"","PDES":"מיכל קלסאון צמוד לבן מורכב","TQUANT":168,"PRICE":0},{"PARTNAME":"","TUNITNAME":"יח'","VATFLAG":"Y","ACCNAME":"","PDES":"מיכל שיאון פרגמון מורכב","TQUANT":56,"PRICE":0},{"PARTNAME":"","TUNITNAME":"יח'","VATFLAG":"Y","ACCNAME":"","PDES":"מיכל שיאון לבן מורכב","TQUANT":56,"PRICE":0}]}]}}]},"technical_config":{"supplier_code":"2511","supplier_name":"פלסאון בע\"מ","all_templates":[{"version":"4.2","document_type":"docs_invoice","extraction_rules":{"booknum":{"source":"ocrFields.InvoiceId","transformations":[{"action":"remove_prefix","pattern":"^SI","case_insensitive":true,"description":"הסר קידומת SI אם קיימת"},{"action":"take_last_n_chars","count":7,"description":"קח 7 תווים אחרונים"}],"validation":{"length":7,"pattern":"^d{7}$","required":true},"example":"258001213"},"ivdate":{"source":"ocrFields.InvoiceDate","format":"DD/MM/YY","transformation":{"from":"ISO8601","to":"DD/MM/YY","description":"המר מפורמט ISO (YYYY-MM-DD) לפורמט DD/MM/YY"},"validation":{"pattern":"^d{2}/d{2}/d{2}$","required":true},"example":"12/08/25"},"price":{"calculation":{"method":"subtract","primary":{"formula":"ocrFields.InvoiceTotal_amount - ocrFields.TotalTax_amount","fields_required":["InvoiceTotal_amount","TotalTax_amount"],"description":"סה\"כ לפני מע\"מ = סה\"כ כולל מע\"מ - מע\"מ"},"fallback":{"formula":"ocrFields.SubTotal_amount || ocrFields.InvoiceTotal_amount","fields_required":["SubTotal_amount"],"description":"אם אין TotalTax_amount, קח SubTotal_amount"},"division_by_vehicles":{"enabled":true,"formula":"totalPrice / vehicles.length","description":"אם יש מספר רכבים, חלק את המחיר הכולל באופן שווה"}},"description":"מחיר לפני מע\"מ (עבודות + חלקים)","example_calculation":{"invoice_total":43766.77,"total_tax":6676.29,"calculated_price":37090.479999999996,"formula_used":"InvoiceTotal_amount - TotalTax_amount"}},"vehicles":{"search_locations":[{"field":"ocrFields.UnidentifiedNumbers","priority":1,"filter":{"label":"רכב","description":"רק פריטים עם תווית 'רכב'"},"pattern":"d{3}-d{2}-d{3}","validation":{"must_match_pattern":true,"exclude_if_context_contains":["כרטיס"],"description":"בדוק שזה לא מספר כרטיס"}},{"field":"ocrFields.VehicleNumbers","priority":2,"pattern":"d{3}-d{2}-d{3}"},{"field":"ocrFields.Items[].Description","priority":3,"pattern":"d{3}-d{2}-d{3}","description":"חפש בתיאור הפריטים"}],"example":[]},"documents":{"search_in":[{"location":"ocrFields.UnidentifiedNumbers","priority":1,"filter":{"label":"מס׳ הקצאה (BOOKNUM)","description":"חפש במערך UnidentifiedNumbers עם תווית BOOKNUM"},"pattern":"\\b(107d{6})\\b","description":"BOOKNUM - זוהה 107XXXXXX (1 דוגמאות מה-OCR)","detected_examples":["107763233"]},{"location":"AZURE_TEXT","priority":2,"fallback":true,"pattern":"\\b(107d{6})\\b","description":"חיפוש fallback ב-AZURE_TEXT אם לא נמצא ב-UnidentifiedNumbers"}],"matching":{"match_field":"BOOKNUM","lookup_source":"docs_list.list_of_docs","output_fields":["DOCNO","BOOKNUM"],"description":"התאם את BOOKNUM שנמצא ב-OCR עם docs_list כדי לקבל DOCNO"},"output_format":{"field_name":"PIVDOC_SUBFORM","structure":[{"DOCNO":"string - מספר תעודה פנימי ב-Priority (25XXXXXX)","BOOKNUM":"string - מספר הקצאה חיצוני (108XXXXXX)"}]},"error_handling":{"if_none_found":{"action":"return_partial_json","include_empty_array":true,"add_to_report":"errors","message":"תבנית דורשת תעודות אך לא נמצאו ב-OCR"},"if_partial_found":{"action":"return_partial_json","include_found_items":true,"add_to_report":"warnings","message":"נמצאו רק {found_count} מתוך {expected_count} תעודות"}},"example":[]},"description":{"source":"ocrFields.Items[0].Description","extraction":{"method":"pattern_match","patterns":[{"name":"service_with_km","pattern":"טיפולs+[d,]+s*ק[״\"]?מ","priority":1,"description":"טיפול XXX ק\"מ"},{"name":"general_service","pattern":"(החלפת|תיקון|בדיקת)s+[\\u0590-\\u05FFs]+","priority":2,"description":"תיאור כללי של שירות"}],"max_words":4,"max_length":50,"append_mileage":{"enabled":true,"source":"ocrFields.CustomerId","format":"{description}-{mileage}","description":"אם יש ק\"מ נוכחי, הוסף בפורמט: 'תיאור-XXXXXק\"מ'"}},"fallback":"טיפול","example":"טיפול 75000 ק\"מ"}},"vehicle_mapping":{},"template":{"SUPNAME":"2511","CODE":"ש\"ח","DEBIT":"D","TUNITNAME":"יח'","TQUANT":1,"PINVOICESCONT_SUBFORM":[{"FNCPATNAME":"2323"}]},"validation_rules":{"required_fields":["SUPNAME","CODE","DEBIT","IVDATE","BOOKNUM"],"booknum_length":7,"totquant_check":{"enabled":true,"compare_with_docs":true,"learned_reference":280}}}]},"processing_scenario":{"supplier_code":"2511","supplier_name":"פלסאון בע\"מ","all_templates":[{"document_type":"docs_invoice","check_docs":true,"check_import":false,"check_vehicles":false}]}}'